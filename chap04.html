

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Chapter 4: Query a Web Resource &#8212; Computational Thinking and Problem Solving</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/myfile.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chap04';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Chapter 5: Play Guess-a-number" href="chap05.html" />
    <link rel="prev" title="Chapter 3: Replace Text With Emoji" href="chap03.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="ctps.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/mike_flat.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/mike_flat.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="ctps.html">
                    <no title>
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="welcome.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap01.html">Chapter 1: Read a Children’s Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap02.html">Chapter 2: Grab the Dialogue</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap03.html">Chapter 3: Replace Text With Emoji</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapter 4: Query a Web Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap05.html">Chapter 5: Play Guess-a-number</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap06.html">Chapter 6: Do You See My Dog?</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap07.html">Chapter 7: Many But Not Any Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap08.html">Chapter 8: What Is My Problem?</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap09.html">Chapter 9: Find a Phrase</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap10.html">Chapter 10: Build an Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap11.html">Chapter 11: Discover Driving Directions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap12.html">Chapter 12: Divide and Conquer</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap13.html">Chapter 13: Rewrite the Error Message</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap14.html">Chapter 14: The Dream of Bug Fixing</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap15.html">Chapter 15: Embrace Runtime Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap16.html">Chapter 16: Catch Them Early</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap17.html">Chapter 17: Build Prediction Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap18.html">Chapter 18: Use Generative AI</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="ales.html">Active-Learning Exercises</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="ales-c01.html">Chapter 1</a></li>





<li class="toctree-l2"><a class="reference internal" href="ales-c02.html">Chapter 2</a></li>







<li class="toctree-l2"><a class="reference internal" href="ales-c03.html">Chapter 3</a></li>










<li class="toctree-l2"><a class="reference internal" href="ales-c04.html">Chapter 4</a></li>





<li class="toctree-l2"><a class="reference internal" href="ales-c05.html">Chapter 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c06.html">Chapter 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c07.html">Chapter 7</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c08.html">Chapter 8</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c09.html">Chapter 9</a></li>



<li class="toctree-l2"><a class="reference internal" href="ales-c10.html">Chapter 10</a></li>


<li class="toctree-l2"><a class="reference internal" href="ales-c12.html">Chapter 12</a></li>



</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/chap04.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 4: Query a Web Resource</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#packages-and-libraries">Packages and libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#apis">APIs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-new-problem">A new problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#searching-wikipedia">Searching Wikipedia</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-client-server-programming-model">The client-server programming model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resources-transactions-and-protocols">Resources, transactions, and protocols</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-url">The URL</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-programmable-web">The Programmable Web</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-dictionaries">Python dictionaries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-http-response">An HTTP response</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-response-header">The response header</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#json-and-the-response-body">JSON and the response body</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#enumerating-answers-from-hollis">Enumerating answers from HOLLIS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beyond-printing">Beyond printing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#blocking-and-non-blocking-function-calls">Blocking and non-blocking function calls</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chapter-4-query-a-web-resource">
<h1>Chapter 4: Query a Web Resource<a class="headerlink" href="#chapter-4-query-a-web-resource" title="Permalink to this heading">#</a></h1>
<p>Now that we know the basics about functions and modules, we can use them as our ticket into the worldwide community of software developers. While we might begin by building our own reusable components (i.e., functions) and sharing them with the Python community, in this chapter we’ll learn how to write a script using functions others have built and shared. In particular, we’ll use functions to access information available on the Internet. It’s time to use what we know to interact with the world!</p>
<div class="admonition-learning-outcomes admonition">
<p class="admonition-title">Learning Outcomes</p>
<p>In this chapter, you will learn how to query networked resources through their application programming interface and the use libraries built by others. The scripts we’ll write will give us access to the collective knowledge of the world. In particular, by the end of the chapter, you will be able to:</p>
<ul class="simple">
<li><p>Find and use powerful Python packages and libraries [design];</p></li>
<li><p>Describe the purpose and importance of an application programming interface (API) and know where to go to find published APIs [CS concepts and programming skills];</p></li>
<li><p>Write a script that requests information from an online resource like Wikipedia [programming skills];</p></li>
<li><p>Split apart a URL into its main components and explain purpose of each component [CS concepts];</p></li>
<li><p>Sketch the major components of the client-server programming model and interprocess communication [CS concepts];</p></li>
<li><p>Understand a basic protocol between two communicating processes, that network messages often consist of a header and a body, and what you can find in each [CS concepts];</p></li>
<li><p>Discuss the different ways a network request might fail and what HTTP status codes you’d receive [CS concepts and programming skills];</p></li>
<li><p>Create and use Python dictionaries [programming skills];</p></li>
<li><p>Use Python’s multiple-assignment, the enumerate function, and the for-else statement to make your scripts easier to understand [design and programming skills];</p></li>
<li><p>Manipulate messages and files that use the JSON data-interchange standard [programming skills];</p></li>
<li><p>Explain the difference between blocking and non-blocking function calls [CS concepts].</p></li>
</ul>
</div>
<section id="packages-and-libraries">
<p><strong>Packages and libraries.</strong> To access information out on the Internet, we will use the <code class="docutils literal notranslate"><span class="pre">requests</span></code> package. A <em>package</em> is simply a set of modules that a Python programmer distributes all together. The <code class="docutils literal notranslate"><span class="pre">requests</span></code> package is one of many available through the <a class="reference external" href="https://pypi.org/">Python Package Index</a>, which is an online repository of software for the Python programming language.</p>
<p>Another name you’ll often hear programmers use for a collection of modules is <em>library</em>. Programming languages like Python are typically distributed with what is called a <em>standard library</em>, which you can think of as the modules and packages available by default wherever the programming language is installed. The <a class="reference external" href="https://docs.python.org/3/library/">Python standard library</a> includes built-in constants (e.g., <code class="docutils literal notranslate"><span class="pre">True</span></code>), data types (e.g., <code class="docutils literal notranslate"><span class="pre">str</span></code>), and functions (e.g., the file I/O facilities) that we have repeatedly used in our scripts.</p>
</section>
<section id="apis">
<p><strong>APIs.</strong> How do we use the functions and data structures in published packages and libraries to accelerate the development of our own scripts? We use their <em>application programming interface (API)</em>.</p>
<p>An API begins with the functions and data structures defined in the package or library, but it doesn’t stop there. As we discussed in the previous chapter, the public interface for a function is often not enough to fully understand how to use it, and so an API isn’t complete without well-written documentation, like the information we discussed putting in the docstring of the functions we write. To emphasize, an API refers to both the function interfaces and data structure definitions we can <code class="docutils literal notranslate"><span class="pre">import</span></code> into our scripts as well as the documentation for these interface and definitions that tell us how we can properly use them. You have already been using an API when you used Python’s built-in types (like strings), their methods (like string-find), and Python’s documentation (like the documentation on Python’s sequence types).</p>
<p>As you’ve experienced, a module and its API simplifies the work we need to do in building solutions to the problems that interest us because we can use a module’s functions and data structures without having to write this functionality ourselves or even understand exactly how the functions and data structures operate. Because Python has a treasure trove of existing libraries, our scripts are now no longer limited by what’s built in the Python language or what we know how to build ourselves. This is incredibly powerful for it expands the limits of our dramatic stage and permits us to reach beyond our own laptops to take advantage of everything on the Internet. Let’s start doing that now.</p>
</section>
<section id="a-new-problem">
<p><strong>A new problem.</strong> To date, we’ve affirmatively answered some simple questions: Can I write a program that converts a book into a theatrical script? Can I write a function that replaces a subsequence of a string with a different subsequence? Here’s another seemingly simple question: Can I write a program to check if a book exists in my local library? Maybe I want to know if there’s a copy of Dr. Seuss’s <em>The Cat in the Hat</em> somewhere in Harvard Library’s miles of bookshelves.</p>
<p>We all know how to do this work ourselves. We’d simply look up the book’s title in the library’s card catalog. At Harvard, what used to be a physically imposing room full of cabinets with drawers of index cards<a class="footnote-reference brackets" href="#fn1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> is now an online resource called <a class="reference external" href="https://library.harvard.edu/services-tools/hollis">HOLLIS</a>. So, my question really is: Can I write a script that sends a query from my computer to some computer running HOLLIS? And I had better know how to craft a query that the computer running HOLLIS will understand, and my program had better be able to interpret whatever response it gets back.</p>
<p>Notice that we have started to decompose the question into smaller problems that we need to accomplish. Here’s some pseudocode that enumerates the steps we’ve discussed so far:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Craft a request HOLLIS will understand about The Cat in the Hat</span>
<span class="linenos">2</span><span class="c1"># Send that request from our computer to the one running HOLLIS</span>
<span class="linenos">3</span><span class="c1"># Read the response from the HOLLIS computer</span>
<span class="linenos">4</span><span class="c1"># Print the answer to our question</span>
</pre></div>
</div>
<p>This looks simple enough, as long as we can find libraries with APIs that make, for example, sending a request from one computer to another as simple as a function call. Think about this. There is almost certainly a boatload of work that needs to be done to send a message from our computer to some other computer, and we’d love it if someone else had figured out how that exactly works and has hidden that work behind the interface of a simple function call. Luckily, there is such an API, and we’ll use it to do something pretty amazing.<a class="footnote-reference brackets" href="#fn2" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p>
</section>
<section id="searching-wikipedia">
<p><strong>Searching Wikipedia.</strong> HOLLIS is programmed to provide its users with lots of information in response to their queries. You’d learn a book’s catalogue number, publisher, and publication date. You’d find a short description of its subject matter and any notes that a librarian attached to the entry. You’d also know exactly where you could find the book on Harvard’s shelves.</p>
<p>Since we’ve learned that it’s best to start problem solving with a simple instance, let’s write most of what we need in our script while targeting a simple web resource. In particular, let’s ask whether Wikipedia has an entry for <em>The Cat in the Hat</em>. The pseudocode for this problem is the same as above, except we replace HOLLIS with <a class="reference external" href="http://wikipedia.org">wikipedia.org</a>.</p>
<p>Here is one translation of that pseudocode into Python code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap04/qweb1.py</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos"> 5</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Searching wikipedia for &quot;The Cat in the Hat&quot;&#39;</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>    <span class="c1"># Craft a request wikipedia will understand about The Cat in the Hat</span>
<span class="linenos"> 8</span>    <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;The Cat in the Hat&#39;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
<span class="linenos"> 9</span>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://en.wikipedia.org/w/api.php?action=query&amp;list=search&amp;srsearch=</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&amp;srlimit=1&amp;format=json&quot;</span>
<span class="linenos">10</span>
<span class="linenos">11</span>    <span class="c1"># Send that request from our computer to the one running wikipedia</span>
<span class="linenos">12</span>    <span class="c1"># Read the response from the wikipedia computer</span>
<span class="linenos">13</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span>    <span class="c1"># Print the answer to our question ... sorta </span>
<span class="linenos">16</span>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<span class="linenos">17</span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Our request to Wikipedia succeeded!&quot;</span><span class="p">)</span>
<span class="linenos">18</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">19</span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hmmm, something might have gone wrong.&quot;</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">22</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>This script uses Python’s <code class="docutils literal notranslate"><span class="pre">requests</span></code> library, which is described as “<a class="reference external" href="https://requests.readthedocs.io/en/master/">an elegant and simple HTTP library for Python, built for human beings.”</a> This library is not part of Python’s standard library, and you may have to follow a few steps explained in the library’s documentation to get it installed for your use. Once installed, the API provided by this library makes it very simple to complete the middle two steps of our pseudocode, as illustrated by the single <code class="docutils literal notranslate"><span class="pre">requests.get</span></code> call on line 13.</p>
<p>This call and its returned result hide all the hard and confusing parts of communicating across whatever network is connected to your computer. Lines 8-9 do a small amount of string-processing work to set up the parameter to this call.<a class="footnote-reference brackets" href="#fn3" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> Lines 16-19 inspect the object returned by <code class="docutils literal notranslate"><span class="pre">requests.get</span></code> to determine whether Wikipedia understood our question.</p>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>Run the <code class="docutils literal notranslate"><span class="pre">qweb1.py</span></code> and it will respond that it successfully talked to a Wikipedia server. You may need to install the <code class="docutils literal notranslate"><span class="pre">requests</span></code> package.</p>
</div>
</section>
<section id="the-client-server-programming-model">
<p><strong>The client-server programming model.</strong> Congratulations! You have successfully executed and generally understood your first network program. We all use network programs every day, from the web browsers running on our laptops to the bank apps running on our cell phones. Nearly every one of these network applications follows the same, straightforward programming model illustrated in <code class="docutils literal notranslate"><span class="pre">qweb1.py</span></code>. Before we dive deeper into its code, let’s take a moment and understand the basics of this client-server programming model.</p>
<p>We have written a script that acts as a <em>client</em> in this client-server model. To complete its task, it makes a <em>request</em> of some other computational entity called a <em>server</em>. Typically, this server runs on some other computer, and the machines on which the client and server run are connected by a <em>computer network</em>. It is, however, possible that the client and the server are in fact running on the same machine, and we will take advantage of this ability in some of our upcoming examples.</p>
<figure class="align-default" id="c04-fig1-ref">
<img alt="_images/c04_fig1.png" src="_images/c04_fig1.png" />
<figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text">Two examples of the client-server programming model. The left-hand picture shows the client and server processes on two separate computers, which perform interprocess communication over a network. The right-hand picture shows the client and server processes on the same machine; later chapters will discuss how we can perform interprocess communication in this configuration. The model abstracts aways this distinction, which means the same script handles both cases.</span><a class="headerlink" href="#c04-fig1-ref" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#c04-fig1-ref"><span class="std std-numref">Figure 7</span></a> illustrates both of these cases. It is important to keep in mind that we’re talking about a script that becomes a running program when we talk about clients and (in next chapter) servers. While you might hear someone point to a computer and say that it is their server, they probably mean that they have reserved this computer to run one or more server programs that respond to the requests of one or more client programs.</p>
<p>The computer science term for a running program (or more precisely a running instance of a script) is a <em>process</em>, and when the client and server processes exchange information, it is called <em>interprocess communication</em>. Two processes sending data across a computer network is one form of interprocess communication.</p>
<p>Whether the client and server are running on two separate, networked computers or both on the same computer is a detail hidden by the abstraction of the client-server programming model. And when networks are involved, the model hides the details of whether it is a wired network, a wireless network, or some combination of networks using lots of different transport mechanisms and data exchange protocols!</p>
</section>
<section id="resources-transactions-and-protocols">
<p><strong>Resources, transactions, and protocols.</strong> Getting back to the structure of the client-server programming model, a server program is responsible for managing some <em>resource</em> that client programs find useful. A web server, like <a class="reference external" href="http://wikipedia.org">wikipedia.org</a>, manages access to the files that comprise the articles in that online encyclopedia. An email server manages the transfer of email messages between email clients. A gaming server manages the shared state of the game and keeps each clients’ view of the game globally consistent.</p>
<p>The signature operation that takes place repeatedly in the client-server programming model is a <em>transaction</em>. The Python <code class="docutils literal notranslate"><span class="pre">requests</span></code> library hides the four fundamental steps of a transaction between a client and a server behind the <code class="docutils literal notranslate"><span class="pre">requests.request</span></code> function interface, of which we have used a specific type of request in our network program. The four steps are: (1) the client sends a request to the server; (2) the server receives the request, interprets it, and manipulates the resource it controls in the requested manner (assuming it is a valid request); (3) the server sends a response to the client; and (4) the client receives the response and interprets it.</p>
<figure class="align-default" id="c04-fig2-ref">
<img alt="_images/c04_fig2.png" src="_images/c04_fig2.png" />
<figcaption>
<p><span class="caption-number">Fig. 8 </span><span class="caption-text">Graphical illustration of a transaction between a client and a server, where time moves down the page and the bold vertical lines below the client and server labels represent what is taking place at each instance in time on each machine.</span><a class="headerlink" href="#c04-fig2-ref" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>When we make a <code class="docutils literal notranslate"><span class="pre">requests.get</span></code> function call, our script (the client) sends a request (part of the value of <code class="docutils literal notranslate"><span class="pre">url</span></code>) to the server (another part of the value of <code class="docutils literal notranslate"><span class="pre">url</span></code>). Steps (2) and (3) are hidden from our client in the execution of the <code class="docutils literal notranslate"><span class="pre">requests.get</span></code> function. Step (4) is the value that’s returned by the <code class="docutils literal notranslate"><span class="pre">requests.get</span></code> function.</p>
<p>It’s now time to own up to something I mentioned when I introduced the Python <code class="docutils literal notranslate"><span class="pre">requests</span></code> library, but have ignored throughout our discussion of the client-server programming model. The <code class="docutils literal notranslate"><span class="pre">requests</span></code> API does not allow us to do <em>any</em> type of client-server communication, but client-server communication using one specific <em>protocol</em> (i.e., the HTTP protocol).</p>
<p>What is a protocol? It is a fancy way of saying that two communicating processes can’t communicate unless they use the same language. Sound familiar? Encoding standards and communication protocols are related concepts. Clients and servers cannot communicate unless they agree to use the same method and meanings for the packing and unpacking of the data that they exchange.</p>
<p>In the Worldwide Web, browsers (i.e., clients) and web servers interact using a text-based protocol known as the <em>hypertext transfer protocol (HTTP)</em>. We see pieces of this protocol in the <code class="docutils literal notranslate"><span class="pre">url</span></code> string. In fact, HTTP defines a handful of methods that are the only ways that clients can ask servers to perform actions on their resources. One of these methods is GET, which simply asks the server to return a representation of the specified resource. The other popular HTTP method is POST, which essentially asks the server to accept the data accompanying the request as a new piece of the specified resource. Our script invokes the simpler GET method. That’s why the function name we use from the <code class="docutils literal notranslate"><span class="pre">requests</span></code> library is <code class="docutils literal notranslate"><span class="pre">get</span></code>!</p>
</section>
<section id="the-url">
<p><strong>The URL.</strong> When we “get” content from a web server, the data we receive comes in part from some file that the server manages, and as you might expect, each file on the server has a unique name. When we type a <em>URL (a universal resource locator)</em> in the address bar of a browser, this URL includes a <em>path</em> in the server’s file system to the file (i.e., resource) that interests us. The script <code class="docutils literal notranslate"><span class="pre">qweb2.py</span></code> rewrites the setup work we did in <code class="docutils literal notranslate"><span class="pre">qweb1.py</span></code> so that we can see the four main components of the URLs used in the HTTP protocol.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap04/qweb2.py</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos"> 5</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Searching wikipedia for &quot;The Cat in the Hat&quot;&#39;</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>    <span class="c1"># Highlight the 4 components of a URL for HTTP</span>
<span class="linenos"> 8</span>    <span class="n">protocol</span> <span class="o">=</span> <span class="s1">&#39;https&#39;</span>
<span class="linenos"> 9</span>    <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;en.wikipedia.org&#39;</span>
<span class="linenos">10</span>    <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/w/api.php&#39;</span>
<span class="linenos">11</span>    <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;?action=query&amp;list=search&amp;srsearch=The+Cat+in+the+Hat&amp;srlimit=1&amp;format=json&#39;</span>
<span class="linenos">12</span>
<span class="linenos">13</span>    <span class="c1"># Build the URL and launch a `get` request</span>
<span class="linenos">14</span>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">hostname</span><span class="si">}{</span><span class="n">path</span><span class="si">}{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="linenos">15</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="linenos">16</span>
<span class="linenos">17</span>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<span class="linenos">18</span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Our request to Wikipedia succeeded!&quot;</span><span class="p">)</span>
<span class="linenos">19</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">20</span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hmmm, something might have gone wrong.&quot;</span><span class="p">)</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">23</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>The first piece of a URL indicates the protocol we are using, which in our case is HTTPS. HTTPS is an extension of the HTTP protocol that encrypts the request and response data that’s sent back and forth across the network.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Whenever possible, you should use HTTPS rather than HTTP to thwart someone snooping on your network traffic.</p>
</div>
<p>The next major piece of a URL is the <em>hostname</em> specified as an Internet Domain Name. If we want to communicate with a process on another machine, we have to be able to name that machine, and Internet Domain Names are a standardized way of doing just that. There’s a whole interesting question of, given a valid hostname, how do you actually route messages through computer networks to the computer with that hostname, especially when that computer might be a mobile device that connects to different parts of a computer network at different times. We don’t have to concern ourselves with this problem because it is hidden from us below the abstraction barrier, but you should realize that this is more complicated than putting a home address on an envelope, since most houses aren’t mobile homes.</p>
<p>The third piece of a URL for the HTTP protocol is the path to the specific resource on the host computer that we’d like. This path is specified in a form very similar to the filesystem paths we’ll discuss in detail in Chapter 13. This is not surprising since we are, in fact, specifying a file in the host’s filesystem.</p>
<p>Finally, HTTP allows us to specify an optional query at the end of our URL. The question mark (<code class="docutils literal notranslate"><span class="pre">?</span></code>) separates the path from the query. The query itself is a string comprised of name and value pairs, with each pair separated by an ampersand (<code class="docutils literal notranslate"><span class="pre">&amp;</span></code>) character.</p>
</section>
<section id="the-programmable-web">
<p><strong>The Programmable Web.</strong> You might wonder, how did I know to create this specific URL? If we point our browser to <a class="reference external" href="http://en.wikipedia.org">en.wikipedia.org</a> and type “The Cat in the Hat” in the search box there, the URL to which we’re directed is <a class="reference external" href="https://en.wikipedia.org/wiki/The_Cat_in_the_Hat">https://en.wikipedia.org/wiki/The_Cat_in_the_Hat</a> and not the one in <code class="docutils literal notranslate"><span class="pre">qweb2.py</span></code>. That’s because we want to use the Web as a programmable platform, and to do that, we need to access the parts of the Web with published APIs.</p>
<p>To learn what Internet-based APIs exist, I visited the <a class="reference external" href="https://en.wikipedia.org/wiki/ProgrammableWeb">ProgrammableWeb</a>, which maintained a directory of these things until it shut down in early 2023.<a class="footnote-reference brackets" href="#fn4" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a> That site pointed me to <a class="reference external" href="https://www.mediawiki.org/wiki/API:Main_page">MediaWiki’s API</a>, on which Wikipedia’s API is built. There I learned that the API endpoint for Wikipedia in English is <a class="reference external" href="https://en.wikipedia.org/w/api.php">https://en.wikipedia.org/w/api.php</a>.</p>
<p>To converse with the server at this endpoint, we have to craft a <em>query string</em>. In this string, the MediaWiki site explained that we should set the parameter named <code class="docutils literal notranslate"><span class="pre">action</span></code> to the value <code class="docutils literal notranslate"><span class="pre">query</span></code> when we want to fetch data. If then we set the <code class="docutils literal notranslate"><span class="pre">list</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">search</span></code>, we can perform a full text search. Since we’re doing a search, we set the parameter <code class="docutils literal notranslate"><span class="pre">srsearch</span></code> with the value of our search string and the parameter <code class="docutils literal notranslate"><span class="pre">srlimt</span></code> to the number of page matches that we’d like returned. Finally, we set the parameter <code class="docutils literal notranslate"><span class="pre">format</span></code> to <code class="docutils literal notranslate"><span class="pre">json</span></code> so that the Wikipedia API knew that we want our response in JSON format, a text-based format that we’ll discuss in a moment.</p>
</section>
<section id="python-dictionaries">
<p><strong>Python dictionaries.</strong> It’s ugly and error prone to write out these cryptic query strings ourselves. You’ve undoubtedly noticed that we can’t use spaces in a query string and must replace each space character with a plus sign (<code class="docutils literal notranslate"><span class="pre">+</span></code>), as we did on line 11 in <code class="docutils literal notranslate"><span class="pre">qweb2.py</span></code>. But what if you wanted a search for a string containing a <code class="docutils literal notranslate"><span class="pre">+</span></code> character? We probably don’t want to become an expert in URL encoding to simply ask our question to Wikipedia. Luckily, we don’t have to because the author of the <code class="docutils literal notranslate"><span class="pre">requests</span></code> library realized this too!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap04/qweb3.py</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos"> 5</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Searching wikipedia for &quot;The Cat in the Hat&quot;&#39;</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>    <span class="c1"># Concatenate the first 3 components of a URL for HTTP</span>
<span class="linenos"> 8</span>    <span class="n">protocol</span> <span class="o">=</span> <span class="s1">&#39;https&#39;</span>
<span class="linenos"> 9</span>    <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;en.wikipedia.org&#39;</span>
<span class="linenos">10</span>    <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/w/api.php&#39;</span>
<span class="linenos">11</span>    <span class="n">url</span> <span class="o">=</span> <span class="n">protocol</span> <span class="o">+</span> <span class="s1">&#39;://&#39;</span> <span class="o">+</span> <span class="n">hostname</span> <span class="o">+</span> <span class="n">path</span>
<span class="linenos">12</span>
<span class="linenos">13</span>    <span class="c1"># Describe the query string as a Python dictionary</span>
<span class="linenos">14</span>    <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;query&#39;</span><span class="p">,</span>
<span class="linenos">15</span>             <span class="s1">&#39;list&#39;</span><span class="p">:</span> <span class="s1">&#39;search&#39;</span><span class="p">,</span>
<span class="linenos">16</span>             <span class="s1">&#39;srsearch&#39;</span><span class="p">:</span> <span class="s1">&#39;The Cat in the Hat&#39;</span><span class="p">,</span>
<span class="linenos">17</span>             <span class="s1">&#39;srlimit&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="linenos">18</span>             <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span>
<span class="linenos">19</span>    <span class="p">}</span>
<span class="linenos">20</span>
<span class="linenos">21</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
<span class="linenos">22</span>
<span class="linenos">23</span>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
<span class="linenos">24</span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Our request to Wikipedia succeeded!&quot;</span><span class="p">)</span>
<span class="linenos">25</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">26</span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hmmm, something might have gone wrong.&quot;</span><span class="p">)</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">29</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>This third version of our script employs a simpler way to specify the query. It pulls the <code class="docutils literal notranslate"><span class="pre">query</span></code> string out of <code class="docutils literal notranslate"><span class="pre">url</span></code> (line 11 of <code class="docutils literal notranslate"><span class="pre">qweb3.py</span></code>) and passes it in another form to the <code class="docutils literal notranslate"><span class="pre">params</span></code> parameter of the <code class="docutils literal notranslate"><span class="pre">requests.get</span></code> function (see line 21 of <code class="docutils literal notranslate"><span class="pre">qweb3.py</span></code>). This parameter expects a specific kind of data structure that we haven’t yet encountered. It expects a Python <a class="reference external" href="https://docs.python.org/3/tutorial/datastructures.html#dictionaries">dictionary</a>.</p>
<p>Don’t confuse Python dictionaries with Python’s sequence data types. Both use the index operator (i.e., <code class="docutils literal notranslate"><span class="pre">[]</span></code>) to access a particular entry, but the dictionary abstraction doesn’t enforce an ordering on its elements as the sequence abstraction does.<a class="footnote-reference brackets" href="#fn5" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a> Since we cannot specify which entry we want in a dictionary by specifying its position in the data structure, dictionaries associate each entry with a <em>key</em>, which Python requires to be of an immutable type. Recall that strings are immutable, and so we can use them as keys in our dictionary. We can also use numbers as keys, since they too are immutable objects in Python, which means you could make a dictionary object look like a list object, but let’s get back to our example.</p>
<p>Python dictionaries create a mapping from keys to values, and we initialize a dictionary with a set of <code class="docutils literal notranslate"><span class="pre">key:value</span></code> pairs such as <code class="docutils literal notranslate"><span class="pre">'action':'query'</span></code> and <code class="docutils literal notranslate"><span class="pre">'srlimit':1</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">13</span><span class="c1"># Describe the query string as a Python dictionary</span>
<span class="linenos">14</span><span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;query&#39;</span><span class="p">,</span>
<span class="linenos">15</span>         <span class="s1">&#39;list&#39;</span><span class="p">:</span> <span class="s1">&#39;search&#39;</span><span class="p">,</span>
<span class="linenos">16</span>         <span class="s1">&#39;srsearch&#39;</span><span class="p">:</span> <span class="s1">&#39;The Cat in the Hat&#39;</span><span class="p">,</span>
<span class="linenos">17</span>         <span class="s1">&#39;srlimit&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="linenos">18</span>         <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span>
<span class="linenos">19</span><span class="p">}</span>
<span class="linenos">20</span><span class="n">query</span>    <span class="c1"># Not in qweb3.py</span>
</pre></div>
</div>
<p>Run the code block above in the interactive interpreter. Once we’ve initialized <code class="docutils literal notranslate"><span class="pre">query</span></code>, we can ask for the value associated with the key <code class="docutils literal notranslate"><span class="pre">action</span></code> by typing <code class="docutils literal notranslate"><span class="pre">query['action']</span></code>, which would return <code class="docutils literal notranslate"><span class="pre">'query'</span></code>. Make sure you recognize the difference between <code class="docutils literal notranslate"><span class="pre">query</span></code>, which is the name of our dictionary object, and <code class="docutils literal notranslate"><span class="pre">'query'</span></code>, which is a string literal!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>As another example, <code class="docutils literal notranslate"><span class="pre">query['srlimit']</span></code> would return <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">[</span><span class="s1">&#39;srlimit&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>In initializing a dictionary, we enclose all the <code class="docutils literal notranslate"><span class="pre">key:value</span></code> pairs in a pair of curly braces (<code class="docutils literal notranslate"><span class="pre">{}</span></code>) and separate the <code class="docutils literal notranslate"><span class="pre">key:value</span></code> pairs with commas. A pair of curly braces without any <code class="docutils literal notranslate"><span class="pre">key:value</span></code> pairs creates an empty dictionary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">an_empty_dictionary</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
<p>Many of Python’s built-in functions work as well on dictionaries as they did with Python’s other data structures. For example, <code class="docutils literal notranslate"><span class="pre">len(query)</span></code> would return <code class="docutils literal notranslate"><span class="pre">5</span></code> for our example, since there are 5 key-value pairs in <code class="docutils literal notranslate"><span class="pre">query</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">an_empty_dictionary</span><span class="p">)</span>
</pre></div>
</div>
<p>Typing <code class="docutils literal notranslate"><span class="pre">query['srsearch']</span> <span class="pre">=</span> <span class="pre">&quot;Oh,</span> <span class="pre">the</span> <span class="pre">Places</span> <span class="pre">You'll</span> <span class="pre">Go!&quot;</span></code> replaces one Dr. Seuss book title with another, and this functionality means dictionaries are mutable objects in Python.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="n">query</span><span class="p">[</span><span class="s1">&#39;srsearch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Oh, the Places You&#39;ll Go!&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</pre></div>
</div>
<p>And <code class="docutils literal notranslate"><span class="pre">'rlimit'</span> <span class="pre">in</span> <span class="pre">query</span></code> returns <code class="docutils literal notranslate"><span class="pre">False</span></code> because our dictionary doesn’t contain that misspelled key.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;rlimit&#39;</span> <span class="ow">in</span> <span class="n">query</span>
</pre></div>
</div>
<p>If we want to remove a key and its value from a Python dictionary, we type <code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">d[key]</span></code> where <code class="docutils literal notranslate"><span class="pre">d</span></code> is our dictionary and <code class="docutils literal notranslate"><span class="pre">key</span></code> is the key to be removed. If you specify a key that isn’t in the specified dictionary when indexing or using <code class="docutils literal notranslate"><span class="pre">del</span></code>, the Python interpreter will raise a <code class="docutils literal notranslate"><span class="pre">KeyError</span></code> exception.</p>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>Go ahead and create a code block in which you can experiment with these Python dictionary commands for yourself. Feel free to take a look at <a class="reference external" href="https://docs.python.org/3/tutorial/datastructures.html#dictionaries">the Python tutorial on dictionaries</a> for more examples.</p>
<p>Another thing you might try is to print the actual URL used in our <code class="docutils literal notranslate"><span class="pre">requests.get</span></code> call. You can see this string if you print <code class="docutils literal notranslate"><span class="pre">response.url</span></code>, which is the URL that produced the response we received.</p>
</div>
</section>
<section id="an-http-response">
<p><strong>An HTTP response.</strong> So far we have spoken to a Web API, but we haven’t done much with the HTTP response. In fact, our current script simply looks at something called the <em>status code</em> on the response and checks to see if this code is equal to <code class="docutils literal notranslate"><span class="pre">200</span></code>. While surfing around the Internet, you may have seen the phrase <code class="docutils literal notranslate"><span class="pre">200</span> <span class="pre">OK</span></code> or <code class="docutils literal notranslate"><span class="pre">404</span> <span class="pre">Not</span> <span class="pre">Found</span></code>. In general, the first is something good and the second isn’t. Unfortunately, the first, while good in some ways, may not mean we were completely successful in accomplishing what we hoped to do.</p>
<p>Instead of acting upon the value of the <code class="docutils literal notranslate"><span class="pre">status_code</span></code> in our received response, let’s change our script for a moment and have it simply print the value of <code class="docutils literal notranslate"><span class="pre">status_code</span></code>. We will then manipulate the parameters to <code class="docutils literal notranslate"><span class="pre">requests.get</span></code> and see which affect the status code. We’ll modify <code class="docutils literal notranslate"><span class="pre">qweb4.py</span></code> in our experiments.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap04/qweb4.py</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos"> 5</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Searching wikipedia: changed &quot;&lt;nothing&gt;&quot;&#39;</span><span class="p">)</span>
<span class="linenos"> 6</span>    <span class="c1"># print(&#39;Searching wikipedia: changed &quot;path&quot;&#39;)</span>
<span class="linenos"> 7</span>    <span class="c1"># print(&#39;Searching wikipedia: changed &quot;hostname&quot;&#39;)</span>
<span class="linenos"> 8</span>    <span class="c1"># print(&#39;Searching wikipedia: changed &quot;srsearch&quot;&#39;)</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>    <span class="c1"># Concatenate the first 3 components of a URL for HTTP</span>
<span class="linenos">11</span>    <span class="n">protocol</span> <span class="o">=</span> <span class="s1">&#39;https&#39;</span>
<span class="linenos">12</span>    <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;en.wikipedia.org&#39;</span>
<span class="linenos">13</span>    <span class="c1"># hostname = &#39;en.wikipediaasdfghjasdfghj.org&#39;</span>
<span class="linenos">14</span>    <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/w/api.php&#39;</span>
<span class="linenos">15</span>    <span class="c1"># path = &#39;/asdfghjasdfghj/api.php&#39;</span>
<span class="linenos">16</span>    <span class="n">url</span> <span class="o">=</span> <span class="n">protocol</span> <span class="o">+</span> <span class="s1">&#39;://&#39;</span> <span class="o">+</span> <span class="n">hostname</span> <span class="o">+</span> <span class="n">path</span>
<span class="linenos">17</span>
<span class="linenos">18</span>    <span class="c1"># Describe the query string as a Python dictionary</span>
<span class="linenos">19</span>    <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;query&#39;</span><span class="p">,</span>
<span class="linenos">20</span>             <span class="s1">&#39;list&#39;</span><span class="p">:</span> <span class="s1">&#39;search&#39;</span><span class="p">,</span>
<span class="linenos">21</span>             <span class="s1">&#39;srsearch&#39;</span><span class="p">:</span> <span class="s1">&#39;The Cat in the Hat&#39;</span><span class="p">,</span>
<span class="linenos">22</span>             <span class="c1"># &#39;srsearch&#39;: &#39;asdfghjasdfghj&#39;,</span>
<span class="linenos">23</span>             <span class="s1">&#39;srlimit&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="linenos">24</span>             <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span>
<span class="linenos">25</span>    <span class="p">}</span>
<span class="linenos">26</span>
<span class="linenos">27</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
<span class="linenos">28</span>
<span class="linenos">29</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;response.status_code =&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">32</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>If you run the script as is, it reports a status code of 200. How can we make it generate a 404 status code?</p>
<p>If we search the Internet for “HTTP status 404 Not Found” we learn that it is a shorthand for “<a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status">the server cannot find the requested resource</a>.” Recall that “requested resource” in this context refers to the path portion of our URL, which was supposed to take us to a resource controlled by this server. Ok, let’s test that. What happens if we put garbage in the path? In particular, let’s change this value from <code class="docutils literal notranslate"><span class="pre">'/w/api.php'</span></code> to <code class="docutils literal notranslate"><span class="pre">'/asdfghjasdfghj/api.php'</span></code> and rerun <code class="docutils literal notranslate"><span class="pre">qweb4.py</span></code>.</p>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>Switch which assignment to <code class="docutils literal notranslate"><span class="pre">path</span></code> is commented out in <code class="docutils literal notranslate"><span class="pre">qweb4.py</span></code> and run it.</p>
</div>
<p>Bingo! We got a 404 status code. This means that we were able to talk to a server with the hostname we specified and the server knew how to interpret an HTTP GET request, but this server didn’t have any resource at the path <code class="docutils literal notranslate"><span class="pre">'/asdfghjasdfghj/api.php'</span></code>.</p>
<p>What if we mistype the hostname of the server?<a class="footnote-reference brackets" href="#fn6" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a></p>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>Restore the good assignment to <code class="docutils literal notranslate"><span class="pre">path</span></code>. Now change the assignment to <code class="docutils literal notranslate"><span class="pre">hostname</span></code> from <code class="docutils literal notranslate"><span class="pre">'en.wikipedia.org'</span></code> to <code class="docutils literal notranslate"><span class="pre">'en.wikipediaasdfghjasdfghj.org'</span></code>. Run this version of <code class="docutils literal notranslate"><span class="pre">qweb4.py</span></code>.</p>
</div>
<p>Our modified script dies with a large number of error messages. In this mess, you’ll find “Failed to establish a new connection” meaning that the <code class="docutils literal notranslate"><span class="pre">requests</span></code> library tried a number of times to connect to the server, but failed each time. Ideally, we would write our script so that it caught this error condition and handled it gracefully. Obviously, we cannot check the status code of a response if we never make a connection in the first place!</p>
<p>As a last experiment, what do you think the status code will be if we use a good hostname, a valid path, but ask to search for a term that doesn’t exist in Wikipedia?</p>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>Restore the good assignment to <code class="docutils literal notranslate"><span class="pre">hostname</span></code>. Now change the value for key <code class="docutils literal notranslate"><span class="pre">'srsearch'</span></code> in the definition for <code class="docutils literal notranslate"><span class="pre">query</span></code> from <code class="docutils literal notranslate"><span class="pre">'The</span> <span class="pre">Cat</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">Hat'</span></code> to <code class="docutils literal notranslate"><span class="pre">'asdfghjasdfghj'</span></code>. Run this final version of <code class="docutils literal notranslate"><span class="pre">qweb4.py</span></code>.</p>
</div>
<p>It’s <code class="docutils literal notranslate"><span class="pre">200</span></code>. The same status code we got when we searched for <code class="docutils literal notranslate"><span class="pre">'The</span> <span class="pre">Cat</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">Hat'</span></code>. Why is that? You can verify for yourself that Wikipedia will tell you that it doesn’t contain a page with this particular string.</p>
</section>
<section id="the-response-header">
<p><strong>The response header.</strong> To figure this out, we need to look at more than the response’s status code. Fortunately, HTTP request and response messages were designed to be human readable. Printing them can be instructional.</p>
<p>Roughly speaking, these messages consist of a <em>header</em> and a <em>body</em>. We can think of the header as containing the information we might see on the outside of an envelope (e.g., who the letter is meant for and the date it was posted at the post office). The body is the contents of the letter sealed in the envelope. Or if you prefer email, the header contains information like the “from” and “subject” fields, while the body is what is written below the subject line in most email clients.</p>
<p>The status code that we’ve been printing is just one part of the response header. We can inspect the other parts by printing <code class="docutils literal notranslate"><span class="pre">response.headers</span></code>, which consists of what looks like a dictionary of key-value pairs. The <code class="docutils literal notranslate"><span class="pre">qweb5.py</span></code> script uses a for-loop to print each key-value pair in <code class="docutils literal notranslate"><span class="pre">response.headers</span></code>. When we write this for-loop statement, we specify two iteration variables (i.e., <code class="docutils literal notranslate"><span class="pre">key</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code>) separated by a comma so that the interpreter knows that we want each pair pulled apart. This is called <em>multiple assignment</em>.<a class="footnote-reference brackets" href="#fn7" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap04/qweb5.py</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos"> 5</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Searching wikipedia for &quot;The Cat in the Hat&quot;&#39;</span><span class="p">)</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>    <span class="c1"># Concatenate the first 3 components of a URL for HTTP</span>
<span class="linenos"> 8</span>    <span class="n">protocol</span> <span class="o">=</span> <span class="s1">&#39;https&#39;</span>
<span class="linenos"> 9</span>    <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;en.wikipedia.org&#39;</span>
<span class="linenos">10</span>    <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/w/api.php&#39;</span>
<span class="linenos">11</span>    <span class="n">url</span> <span class="o">=</span> <span class="n">protocol</span> <span class="o">+</span> <span class="s1">&#39;://&#39;</span> <span class="o">+</span> <span class="n">hostname</span> <span class="o">+</span> <span class="n">path</span>
<span class="linenos">12</span>
<span class="linenos">13</span>    <span class="c1"># Describe the query string as a Python dictionary</span>
<span class="linenos">14</span>    <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;query&#39;</span><span class="p">,</span>
<span class="linenos">15</span>             <span class="s1">&#39;list&#39;</span><span class="p">:</span> <span class="s1">&#39;search&#39;</span><span class="p">,</span>
<span class="linenos">16</span>             <span class="s1">&#39;srsearch&#39;</span><span class="p">:</span> <span class="s1">&#39;The Cat in the Hat&#39;</span><span class="p">,</span>
<span class="linenos">17</span>             <span class="s1">&#39;srlimit&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="linenos">18</span>             <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span>
<span class="linenos">19</span>    <span class="p">}</span>
<span class="linenos">20</span>
<span class="linenos">21</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
<span class="linenos">22</span>
<span class="linenos">23</span>    <span class="c1"># Print the response headers with a line per key</span>
<span class="linenos">24</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;response.headers =&quot;</span><span class="p">)</span>
<span class="linenos">25</span>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">26</span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">27</span>
<span class="linenos">28</span>    <span class="c1"># This is how we can access one of the keys</span>
<span class="linenos">29</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Content-Type:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">])</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">32</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>We’re not too concerned with most of the header, but we are interested in the value of the key <code class="docutils literal notranslate"><span class="pre">'Content-Type'</span></code> for this indicates how the server has encoded the body of the response. The value of this key is <code class="docutils literal notranslate"><span class="pre">'application/json;</span> <span class="pre">charset=utf-8'</span></code>. As we learned in the last chapter, the Python interpreter we’re using defaults to <code class="docutils literal notranslate"><span class="pre">utf-8</span></code> for character encodings and having the Wikipedia server return a response in this encoding format makes our lives easy. Beyond the encoding of the individual characters in the response’s body, this value tells us that the body is organized using the JSON data-interchange standard, which is what we asked it to do when we specified <code class="docutils literal notranslate"><span class="pre">'format':</span> <span class="pre">'json'</span></code> as one of our <code class="docutils literal notranslate"><span class="pre">query</span></code> parameters.</p>
</section>
<section id="json-and-the-response-body">
<p><strong>JSON and the response body.</strong> JSON stands for <a class="reference external" href="http://json.org">JavaScript Object Notation</a>, and it is meant to be a standard for exchanging structured data that is easy for machines to generate and parse, while also being relatively easy for humans to read and write.</p>
<p>As we saw when we looked at the body of our <code class="docutils literal notranslate"><span class="pre">response</span></code>, JSON-structured data resembles a dictionary of key-value pairs. Some of the values might be singleton values like a string or an integer, and other values might themselves be lists (i.e., enclosed in square brackets) or dictionaries (i.e., enclosed in curly braces).</p>
<p>By importing the <code class="docutils literal notranslate"><span class="pre">json</span></code> module, we can take advantage of someone else’s work to make it straightforward for us to read and write message bodies in JSON format.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap04/qweb6.py</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="linenos"> 3</span><span class="kn">import</span> <span class="nn">json</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos"> 6</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Searching wikipedia for &quot;The Cat in the Hat&quot;&#39;</span><span class="p">)</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>    <span class="c1"># Concatenate the first 3 components of a URL for HTTP</span>
<span class="linenos"> 9</span>    <span class="n">protocol</span> <span class="o">=</span> <span class="s1">&#39;https&#39;</span>
<span class="linenos">10</span>    <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;en.wikipedia.org&#39;</span>
<span class="linenos">11</span>    <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/w/api.php&#39;</span>
<span class="linenos">12</span>    <span class="n">url</span> <span class="o">=</span> <span class="n">protocol</span> <span class="o">+</span> <span class="s1">&#39;://&#39;</span> <span class="o">+</span> <span class="n">hostname</span> <span class="o">+</span> <span class="n">path</span>
<span class="linenos">13</span>
<span class="linenos">14</span>    <span class="c1"># Describe the query string as a Python dictionary</span>
<span class="linenos">15</span>    <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;query&#39;</span><span class="p">,</span>
<span class="linenos">16</span>             <span class="s1">&#39;list&#39;</span><span class="p">:</span> <span class="s1">&#39;search&#39;</span><span class="p">,</span>
<span class="linenos">17</span>             <span class="s1">&#39;srsearch&#39;</span><span class="p">:</span> <span class="s1">&#39;The Cat in the Hat&#39;</span><span class="p">,</span>
<span class="linenos">18</span>             <span class="s1">&#39;srlimit&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="linenos">19</span>             <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span>
<span class="linenos">20</span>    <span class="p">}</span>
<span class="linenos">21</span>
<span class="linenos">22</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span>    <span class="c1"># Print the response body directly</span>
<span class="linenos">25</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;response.text =&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="linenos">26</span>
<span class="linenos">27</span>    <span class="nb">print</span><span class="p">()</span>
<span class="linenos">28</span>
<span class="linenos">29</span>    <span class="c1"># Read the response body in JSON format and print it</span>
<span class="linenos">30</span>    <span class="n">j</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="linenos">31</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;response.json() =&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
<span class="linenos">32</span>
<span class="linenos">33</span>    <span class="nb">print</span><span class="p">()</span>
<span class="linenos">34</span>
<span class="linenos">35</span>    <span class="c1"># Print just the title from the JSON-structured response</span>
<span class="linenos">36</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Title =&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;search&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>
<span class="linenos">37</span>
<span class="linenos">38</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">39</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">json</span></code> module defines a function called <code class="docutils literal notranslate"><span class="pre">dumps</span></code> that we use to convert JSON data into a string. Printing this string, we can see the structure of the data. In particular, we see that the value for the key <code class="docutils literal notranslate"><span class="pre">'query'</span></code> in our JSON-structured data is itself a dictionary. This dictionary tells us things about the search (i.e., the total number of hits that the server got when performing the search), and a list of <code class="docutils literal notranslate"><span class="pre">'search'</span></code> results. Since we limited the server to returning only the top hit (i.e., <code class="docutils literal notranslate"><span class="pre">'srlimit':</span> <span class="pre">1</span></code> in our <code class="docutils literal notranslate"><span class="pre">query</span></code> parameters), this list contains only a single element, which itself is a dictionary describing some characteristics of the article it found. Reading the JSON, we can see that this is the book we were hoping to find in Wikipedia!</p>
<p>How would we access the title of the article returned in the JSON body? Well, following our description in the previous paragraph, we’d simply type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;search&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>And how would we change this to access the fifth character of the title string? We would add a <code class="docutils literal notranslate"><span class="pre">[4]</span></code> to the end of what we just typed, because the result of the previous expression is a string and a string is a sequence!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;query&#39;</span><span class="p">][</span><span class="s1">&#39;search&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>While we will continue to play with JSON-structured response bodies, you may see (or desire) other types of responses. For instance, the default response format for the Harvard Library API is something that looks like JSON, but is actually another standard called XML. As we’ll see in our next script (<code class="docutils literal notranslate"><span class="pre">qweb7.py</span></code>), we can indicate that we’d like a particular response encoding by changing the <code class="docutils literal notranslate"><span class="pre">Accept</span></code> value in the request header.</p>
</section>
<section id="enumerating-answers-from-hollis">
<p><strong>Enumerating answers from HOLLIS.</strong> The <code class="docutils literal notranslate"><span class="pre">qweb7.py</span></code> script below communicates not with Wikipedia, but (finally!) Harvard Library.<a class="footnote-reference brackets" href="#fn8" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a> You should recognize and understand every statement except for the details of the for-loop that processes the returned response.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap04/qweb7.py</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="linenos"> 3</span><span class="kn">import</span> <span class="nn">json</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos"> 6</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Searching HOLLIS for &quot;The Cat in the Hat&quot;&#39;</span><span class="p">)</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>    <span class="c1"># Concatenate the first 3 components of a URL for HTTP</span>
<span class="linenos"> 9</span>    <span class="n">protocol</span> <span class="o">=</span> <span class="s1">&#39;https&#39;</span>
<span class="linenos">10</span>    <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;api.lib.harvard.edu&#39;</span>
<span class="linenos">11</span>    <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/v2/items.json&#39;</span>
<span class="linenos">12</span>    <span class="n">url</span> <span class="o">=</span> <span class="n">protocol</span> <span class="o">+</span> <span class="s1">&#39;://&#39;</span> <span class="o">+</span> <span class="n">hostname</span> <span class="o">+</span> <span class="n">path</span>
<span class="linenos">13</span>
<span class="linenos">14</span>    <span class="c1"># Describe the query string as a Python dictionary</span>
<span class="linenos">15</span>    <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="s1">&#39;The Cat in the Hat&#39;</span><span class="p">,</span>
<span class="linenos">16</span>             <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="mi">2</span>
<span class="linenos">17</span>    <span class="p">}</span>
<span class="linenos">18</span>
<span class="linenos">19</span>    <span class="c1"># Add a field to the request header saying what we accept</span>
<span class="linenos">20</span>    <span class="n">accept</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
<span class="linenos">21</span>
<span class="linenos">22</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">accept</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span>    <span class="c1"># Read the response body in JSON format and print it</span>
<span class="linenos">25</span>    <span class="n">j</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="linenos">26</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;response.json() =&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
<span class="linenos">27</span>
<span class="linenos">28</span>    <span class="nb">print</span><span class="p">()</span>
<span class="linenos">29</span>
<span class="linenos">30</span>    <span class="k">if</span> <span class="n">j</span><span class="p">[</span><span class="s1">&#39;pagination&#39;</span><span class="p">][</span><span class="s1">&#39;numFound&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">31</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Zero results&#39;</span><span class="p">)</span>
<span class="linenos">32</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">33</span>        <span class="c1"># Process each returned response</span>
<span class="linenos">34</span>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">][</span><span class="s1">&#39;mods&#39;</span><span class="p">]):</span>
<span class="linenos">35</span>            <span class="c1"># Print title info</span>
<span class="linenos">36</span>            <span class="n">ti</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;titleInfo&#39;</span><span class="p">]</span>
<span class="linenos">37</span>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
<span class="linenos">38</span>                <span class="c1"># Lots of title info; just print the first</span>
<span class="linenos">39</span>                <span class="n">ti</span> <span class="o">=</span> <span class="n">ti</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">40</span>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Title #</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos">41</span>            <span class="k">if</span> <span class="s1">&#39;nonSort&#39;</span> <span class="ow">in</span> <span class="n">ti</span><span class="p">:</span>
<span class="linenos">42</span>                <span class="nb">print</span><span class="p">(</span><span class="n">ti</span><span class="p">[</span><span class="s1">&#39;nonSort&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos">43</span>            <span class="nb">print</span><span class="p">(</span><span class="n">ti</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>
<span class="linenos">44</span>
<span class="linenos">45</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">46</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>In this script, we have asked HOLLIS to return not just the top search result, but the top two results. The script’s final lines dig down into the JSON-structured data to grab the Python list of results, and they pass that list to the Python built-in function <code class="docutils literal notranslate"><span class="pre">enumerate</span></code>. This is a very useful little function when what you need is not just each value in a list, but each value paired with its list index. We pull this returned <em>tuple</em><a class="footnote-reference brackets" href="#fn9" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a> apart (using multiple assignment) in the for-loop, placing the index in <code class="docutils literal notranslate"><span class="pre">i</span></code> and the dictionary that is the next value from the list in <code class="docutils literal notranslate"><span class="pre">item</span></code>. From this dictionary, we grab the information associated with the key <code class="docutils literal notranslate"><span class="pre">'titleInfo'</span></code> and print it.</p>
</section>
<section id="beyond-printing">
<p><strong>Beyond printing.</strong> Now that we understand the basics of grabbing data off the Internet, we can start having some real fun. Printing pieces of the data we’ve collected has helped us see what we’ve been getting back from these Web APIs, but why should we recreate what the software engineers at Wikipedia and Harvard Library have already spent years thinking about how to display? Imagine that we wanted to develop a script that searched multiple different libraries for a particular book. When it finds the book we’re interested in, we instruct this script to open the result in a browser window. We can see how this might be done using the HOLLIS URL in the response we just received.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap04/qweb8.py</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="linenos"> 3</span><span class="kn">import</span> <span class="nn">webbrowser</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">def</span> <span class="nf">h_lib</span><span class="p">(</span><span class="n">book</span><span class="p">):</span>
<span class="linenos"> 6</span>    <span class="c1"># Concatenate the first 3 components of a URL for HTTP</span>
<span class="linenos"> 7</span>    <span class="n">protocol</span> <span class="o">=</span> <span class="s1">&#39;http&#39;</span>
<span class="linenos"> 8</span>    <span class="n">hostname</span> <span class="o">=</span> <span class="s1">&#39;api.lib.harvard.edu&#39;</span>
<span class="linenos"> 9</span>    <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/v2/items.json&#39;</span>
<span class="linenos">10</span>    <span class="n">url</span> <span class="o">=</span> <span class="n">protocol</span> <span class="o">+</span> <span class="s1">&#39;://&#39;</span> <span class="o">+</span> <span class="n">hostname</span> <span class="o">+</span> <span class="n">path</span>
<span class="linenos">11</span>
<span class="linenos">12</span>    <span class="c1"># Describe the query string as a Python dictionary</span>
<span class="linenos">13</span>    <span class="n">query</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="n">book</span><span class="p">,</span> <span class="s1">&#39;limit&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="linenos">14</span>
<span class="linenos">15</span>    <span class="c1"># Add a field to the request header saying what we accept</span>
<span class="linenos">16</span>    <span class="n">accept</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
<span class="linenos">17</span>
<span class="linenos">18</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">accept</span><span class="p">)</span>
<span class="linenos">19</span>
<span class="linenos">20</span>    <span class="c1"># Return a list of matching items from the received response</span>
<span class="linenos">21</span>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;pagination&#39;</span><span class="p">][</span><span class="s1">&#39;numFound&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">22</span>        <span class="k">return</span> <span class="p">[]</span>
<span class="linenos">23</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">24</span>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;items&#39;</span><span class="p">][</span><span class="s1">&#39;mods&#39;</span><span class="p">]</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">desired_book</span><span class="p">):</span>
<span class="linenos">27</span>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;titleInfo&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
<span class="linenos">28</span>        <span class="n">ti</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;titleInfo&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">29</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">30</span>        <span class="n">ti</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;titleInfo&#39;</span><span class="p">]</span>
<span class="linenos">31</span>    <span class="k">return</span> <span class="n">ti</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">desired_book</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="k">def</span> <span class="nf">get_url</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
<span class="linenos">34</span>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
<span class="linenos">35</span>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
<span class="linenos">36</span>            <span class="k">if</span> <span class="s1">&#39;@otherType&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">or</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;@otherType&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;HOLLIS record&#39;</span><span class="p">:</span>
<span class="linenos">37</span>                <span class="k">continue</span>
<span class="linenos">38</span>            <span class="k">return</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
<span class="linenos">39</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">40</span>        <span class="k">return</span> <span class="n">items</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
<span class="linenos">41</span>
<span class="linenos">42</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos">43</span>    <span class="n">desired_book</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;What&#39;s the title of your desired book? &quot;</span><span class="p">)</span>
<span class="linenos">44</span>
<span class="linenos">45</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Searching HOLLIS for &quot;</span><span class="si">{</span><span class="n">desired_book</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
<span class="linenos">46</span>    <span class="n">items</span> <span class="o">=</span> <span class="n">h_lib</span><span class="p">(</span><span class="n">desired_book</span><span class="p">)</span>
<span class="linenos">47</span>
<span class="linenos">48</span>    <span class="c1"># Launch a browser window if we find the desired book</span>
<span class="linenos">49</span>    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
<span class="linenos">50</span>        <span class="k">if</span> <span class="n">match</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">desired_book</span><span class="p">):</span>
<span class="linenos">51</span>            <span class="c1"># Grab this book&#39;s HOLLIS url</span>
<span class="linenos">52</span>            <span class="n">hollis_url</span> <span class="o">=</span> <span class="n">get_url</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;relatedItem&#39;</span><span class="p">])</span>
<span class="linenos">53</span>
<span class="linenos">54</span>            <span class="c1"># Open a browser window to the appropriate HOLLIS page</span>
<span class="linenos">55</span>            <span class="n">browser</span> <span class="o">=</span> <span class="n">webbrowser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;safari&#39;</span><span class="p">)</span>
<span class="linenos">56</span>            <span class="n">browser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">hollis_url</span><span class="p">)</span>
<span class="linenos">57</span>            <span class="k">break</span>
<span class="linenos">58</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">59</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Your desired book isn&#39;t in HOLLIS.&quot;</span><span class="p">)</span>
<span class="linenos">60</span>
<span class="linenos">61</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">62</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>To run <code class="docutils literal notranslate"><span class="pre">qweb8.py</span></code>, you’ll need an IDE that is running locally on your machine (i.e., not in the cloud) so that you can launch a window running a web browser. To run <code class="docutils literal notranslate"><span class="pre">qweb8.py</span></code>, you should replace <code class="docutils literal notranslate"><span class="pre">safari</span></code> on line 55 with the appropriate name for the web browser on your machine. Also, be aware that the script only checks the title you input against what HOLLIS considers the interesting part of the title. To match “The Cat in the Hat” you input “cat in the hat”. You could extend <code class="docutils literal notranslate"><span class="pre">qweb8.py</span></code> with the title-printing logic in <code class="docutils literal notranslate"><span class="pre">qweb7.py</span></code>.</p>
</div>
<p>The script <code class="docutils literal notranslate"><span class="pre">qweb8.py</span></code> creates a function <code class="docutils literal notranslate"><span class="pre">h_lib</span></code> to hide the details of making a search query on HOLLIS. This should all look familiar except for the very end of the function, where we check for a response that contains no matches.</p>
<p>The more interesting new code is in <code class="docutils literal notranslate"><span class="pre">main</span></code>, which uses the for-else-statement introduced in Chapter 3’s active-learning exercises. In this script, we receive back a list from <code class="docutils literal notranslate"><span class="pre">h_lib</span></code> in which we hope to find a matching item. If we iterate through this entire list and never find our desired item, we’d like to note this for the script’s user. This is the purpose the else-clause indented at the same level as the for-statement.<a class="footnote-reference brackets" href="#fn10" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></a></p>
<p>Think about how we’d do that using just a for-statement. We’d probably set a boolean flag (e.g., <code class="docutils literal notranslate"><span class="pre">found</span> <span class="pre">=</span> <span class="pre">False</span></code>) before we began the loop. In the loop, we’d set that flag to <code class="docutils literal notranslate"><span class="pre">True</span></code> if we found our desired item. And then check the flag at the completion of the loop to see if we checked the entire list and didn’t find our desired item. If you found that description confusing, you’re not alone. If you write out that code, you’ll see it isn’t any easier to understand.</p>
<p>The for-else-statement does away with this flag in this exact use case. The if-statement in the for-loop contains the condition we’d like to find <code class="docutils literal notranslate"><span class="pre">True</span></code>, and when the if-statement’s condition is <code class="docutils literal notranslate"><span class="pre">True</span></code>, we break out of the for-loop. This is exactly what we’d like to think about this loop doing. But what if this loop iterates all the way through because we never found our desired item. Here’s where the else-clause of the for-statement executes, alerting us that we failed in our search. Now that, my friends, how you create a programming language feature for a common construct.</p>
<p>And what did the script do when it found our desired book? It grabbed the HOLLIS URL for the book out of the matching record and launched a web browser to display the resource at that URL. Did I have to know anything specific about the operation of web browsers? No! A wonderfully helpful individual created the <code class="docutils literal notranslate"><span class="pre">webbrowser</span></code> library; I simply imported and used this library after spending only a few minutes with its API description.</p>
</section>
<section id="blocking-and-non-blocking-function-calls">
<p><strong>Blocking and non-blocking function calls.</strong> Let’s pause for a moment and look at two of the powerful function calls we made in <code class="docutils literal notranslate"><span class="pre">qweb8.py</span></code>. The <code class="docutils literal notranslate"><span class="pre">requests.get</span></code> call on line 18 and the <code class="docutils literal notranslate"><span class="pre">browser.open</span></code> call on line 56 are different in a fundamentally interesting way. I don’t mean that one returns a Python list and the other returns the special Python object <code class="docutils literal notranslate"><span class="pre">None</span></code>. No, I want you to think about when lines 21 and 57 execute.</p>
<p>Line 21 can’t execute until we have completed the <code class="docutils literal notranslate"><span class="pre">requests.get</span></code> call and have a <code class="docutils literal notranslate"><span class="pre">response</span></code> object. This call <em>blocks</em> the further execution of our script until it completes. In particular, our script has to wait for some server process to do some work before the process running our script can continue. On the other hand, our script doesn’t care how long a process that runs the web browser takes to display the URL we asked it to render. Our script can merrily move on to the work in line 57 and beyond. The call to <code class="docutils literal notranslate"><span class="pre">webbrowser.open</span></code> is an example of a <em>non-blocking</em> call.<a class="footnote-reference brackets" href="#fn11" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>11<span class="fn-bracket">]</span></a></p>
<p>This is your first taste of <em>concurrency</em> (also called <em>parallelism</em>), and it is a fascinating and tricky subject. For now, be aware whether the library call you’re making will block and think about the implications of that action on the rest of what you write in your script.</p>
<p>[Version 20240813]</p>
<hr class="footnotes docutils" />
<aside class="footnote brackets" id="fn1" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>In case you’re interested, here’s an article titled <a class="reference external" href="https://americanlibrariesmagazine.org/2016/01/04/cataloging-evolves/">“The Evolving Card Catalog” by Karen Coyle</a> (January 4, 2016).</p>
</aside>
<aside class="footnote brackets" id="fn2" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>In the next chapter, we will peek under the covers of this API, just as we did with string-replace. We’ll also start solving problems that require more general communication between two networked computers. We won’t, however, go too deep, and if you want to know exactly how computers communicate over wired and wireless networks, find yourself a book or course on computing networking.</p>
</aside>
<aside class="footnote brackets" id="fn3" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>Line 9 uses Python’s <em>formatted string literals</em>, which are called <em>f-strings</em> for short. By placing the letter `f` (or `F` if you prefer) before your string literal, you can embed one or more Python expressions in the string literal by surrounding them with curly braces (i.e., `{ }`). The string literal is built with the value of the expression at that location. See <a class="reference external" href="https://docs.python.org/3/tutorial/inputoutput.html#tut-f-strings">Formatted String Literals in the Python documentation</a> for additional information.</p>
</aside>
<aside class="footnote brackets" id="fn4" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p>Some other online API directories include: <a class="reference external" href="https://rapidapi.com/hub">Rapid API Hub</a>; <a class="reference external" href="https://apilist.fun/">API list</a>; and <a class="reference external" href="https://github.com/public-apis/public-apis">Public APIs</a>.</p>
</aside>
<aside class="footnote brackets" id="fn5" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">5</a><span class="fn-bracket">]</span></span>
<p>While the dictionary <em>abstraction</em> doesn’t force an ordering on its elements, Python’s <em>implementation</em> of the dictionary data type does guarantee the elements to be in insertion order, as of version 3.7. Personally, I would suggest you forget this “feature.”  This implementation detail might change in a later release, as it doesn’t flow from the dictionary abstraction. Plus, what is the insertion order after you’ve updated some elements and deleted a few? I don’t know and don’t care to figure it out since it isn’t core to the dictionary abstraction. Of course, this is just my personal opinion.</p>
</aside>
<aside class="footnote brackets" id="fn6" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">6</a><span class="fn-bracket">]</span></span>
<p>Be careful! I badly mistype the hostname because you should always be careful with slightly mistyped hostnames in Internet URLs. Sometimes these sites are put up by nefarious people who want you to think you are at the correctly typed location, where they might (for example) encourage you to type in your bank account information.</p>
</aside>
<aside class="footnote brackets" id="fn7" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">7</a><span class="fn-bracket">]</span></span>
<p>You can learn more about multiple assignment in this chapter’s active-learning exercises.</p>
</aside>
<aside class="footnote brackets" id="fn8" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">8</a><span class="fn-bracket">]</span></span>
<p>To communicate with the Harvard Library system, `qweb7.py` uses <a class="reference external" href="https://wiki.harvard.edu/confluence/display/LibraryStaffDoc/LibraryCloud+APIs">the LibraryCloud API</a>. At the time of this book’s writing, `qweb7.py` successfully runs on Replit, but fails in the PythonAnywhere’s environment (i.e., fails with a “403 Forbidden” HTTP status code, which means that the server understood the request but refused it). It isn’t always easy to understand why a request fails.</p>
</aside>
<aside class="footnote brackets" id="fn9" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">9</a><span class="fn-bracket">]</span></span>
<p>You can learn more about tuples in this chapter’s active-learning exercises.</p>
</aside>
<aside class="footnote brackets" id="fn10" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">10</a><span class="fn-bracket">]</span></span>
<p>Note that this else-statement is not paired with the if-statement in the for-loop. We don’t print if any one item doesn’t match our desired book, but only if all items don’t match.</p>
</aside>
<aside class="footnote brackets" id="fn11" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">11</a><span class="fn-bracket">]</span></span>
<p>For those paying close attention, `webbrowser.open` is non-blocking if you call a graphical browser. As <a class="reference external" href="https://docs.python.org/2/library/webbrowser.html">the documentation</a> says, text-mode browsers, which presumably use the same terminal window as the executing script, will block.</p>
</aside>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="chap03.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapter 3: Replace Text With Emoji</p>
      </div>
    </a>
    <a class="right-next"
       href="chap05.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 5: Play Guess-a-number</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#packages-and-libraries">Packages and libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#apis">APIs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-new-problem">A new problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#searching-wikipedia">Searching Wikipedia</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-client-server-programming-model">The client-server programming model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resources-transactions-and-protocols">Resources, transactions, and protocols</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-url">The URL</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-programmable-web">The Programmable Web</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-dictionaries">Python dictionaries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#an-http-response">An HTTP response</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-response-header">The response header</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#json-and-the-response-body">JSON and the response body</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#enumerating-answers-from-hollis">Enumerating answers from HOLLIS</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beyond-printing">Beyond printing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#blocking-and-non-blocking-function-calls">Blocking and non-blocking function calls</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mike Smith
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023 by Michael D. Smith. All rights reserved.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>