

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Chapter 15: Embrace Runtime Debugging &#8212; Computational Thinking and Problem Solving</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/myfile.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chap15';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Chapter 16: Catch Them Early" href="chap16.html" />
    <link rel="prev" title="Chapter 14: The Dream of Bug Fixing" href="chap14.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="ctps.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/mike_flat.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/mike_flat.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="ctps.html">
                    <no title>
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="welcome.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap01.html">Chapter 1: Read a Children’s Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap02.html">Chapter 2: Grab the Dialogue</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap03.html">Chapter 3: Replace Text With Emoji</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap04.html">Chapter 4: Query a Web Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap05.html">Chapter 5: Play Guess-a-number</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap06.html">Chapter 6: Do You See My Dog?</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap07.html">Chapter 7: Many But Not Any Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap08.html">Chapter 8: What Is My Problem?</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap09.html">Chapter 9: Find a Phrase</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap10.html">Chapter 10: Build an Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap11.html">Chapter 11: Discover Driving Directions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap12.html">Chapter 12: Divide and Conquer</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap13.html">Chapter 13: Rewrite the Error Message</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap14.html">Chapter 14: The Dream of Bug Fixing</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapter 15: Embrace Runtime Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap16.html">Chapter 16: Catch Them Early</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap17.html">Chapter 17: Build Prediction Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap18.html">Chapter 18: Use Generative AI</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="ales.html">Active-Learning Exercises</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="ales-c01.html">Chapter 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c02.html">Chapter 2</a></li>







<li class="toctree-l2"><a class="reference internal" href="ales-c03.html">Chapter 3</a></li>








<li class="toctree-l2"><a class="reference internal" href="ales-c04.html">Chapter 4</a></li>





<li class="toctree-l2"><a class="reference internal" href="ales-c05.html">Chapter 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c06.html">Chapter 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c08.html">Chapter 8</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c09.html">Chapter 9</a></li>



<li class="toctree-l2"><a class="reference internal" href="ales-c10.html">Chapter 10</a></li>


<li class="toctree-l2"><a class="reference internal" href="ales-c12.html">Chapter 12</a></li>



</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/chap15.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 15: Embrace Runtime Debugging</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-duality-of-code-and-data">The duality of code and data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#breakpoints-and-runtime-state">Breakpoints and runtime state</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inserting-a-breakpoint">Inserting a breakpoint</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inserting-a-new-statement">Inserting a new statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#indenting-that-statement">Indenting that statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#launching-a-script-from-within-a-script">Launching a script from within a script</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#instrumenting-a-script">Instrumenting a script</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#repl">REPL</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chapter-15-embrace-runtime-debugging">
<h1>Chapter 15: Embrace Runtime Debugging<a class="headerlink" href="#chapter-15-embrace-runtime-debugging" title="Permalink to this heading">#</a></h1>
<p>Does this quote by Brian Kernighan and P.J. Plauger resonate with you?</p>
<aside class="margin sidebar">
<p class="sidebar-title">Citation</p>
<p>Brian W. Kernighan and P.J. Plauger [1978]. <em>The Elements of Programming Style (2nd edition)</em>, McGraw-Hill, page 10.</p>
</aside>
<p><em>“Everyone knows that debugging is twice as hard as writing a program in the first place.”</em></p>
<p>Or based on your experience, perhaps you think this underestimates the difficulty of debugging. It does when I consider how I typically spend my time. Nonetheless, Kernighan and Plauger follow up this general truth with a biting insight:</p>
<p><em>“So if you’re as clever as you can be when you write it, how will you ever debug it?”</em></p>
<p>Design and subtle coding errors are a fact of life, and these two influential figures remind us that programming is hard enough without the added challenge of a “too-clever program.” But what do you do when you’ve written your script as simply and directly as you can, and it still fails with some difficult to discern error?</p>
<p>You could employ the ever-reliable debugging print-statement, but this tool is a blunt instrument. It tells you facts about your script’s execution every time the execution comes across it, but the fact that helps you debug your program might be buried in a mound of uninteresting ones. You undoubtedly experienced this when you stuck a debugging print-statement into the body of a loop. Unless your script died immediately after the debugging print that uncovers your error, you’re left searching for that proverbial needle in a haystack of debugging outputs. What you need is for your program to pause its execution at each debugging print-statement so that you can check if everything looks ok before allowing it to proceed. In other words, debugging is best done when we slow down the program’s execution to match the speed of human thought.</p>
<p>To achieve this, you could couple each of your debugging print-statements with an input-statement that pauses the script until you’re ready to proceed, but even this isn’t quite enough. A debugging print-statement provides you with the current values of the variables you thought were important <em>before</em> you started the debugging run. When a debugging print illuminates a problematic variable, this can immediately raise other questions in your mind, but the only way you can interrogate the rest of the runtime state is by stopping this execution, updating your debugging print-statement, and rerunning your script. Wouldn’t it be nice if you had a debugging tool that allowed you to poke around in your program’s state at any point in its execution to answer any question you had? With such a tool, you could fix your script twice as fast.</p>
<aside class="margin sidebar">
<p class="sidebar-title">Some Debuggers</p>
<p>The <a class="reference external" href="https://code.visualstudio.com/docs/editor/debugging">Microsoft Visual Studio Code</a> and <a class="reference external" href="https://docs.replit.com/programming-ide/debugging">Replit</a> IDEs have built-in support for debugging. Python ships with a standalone interactive debugging tool called <a class="reference external" href="https://docs.python.org/3/library/pdb.html">pdb</a>. <a class="reference external" href="https://colab.research.google.com/github/jakevdp/PythonDataScienceHandbook/blob/master/notebooks/01.06-Errors-and-Debugging.ipynb">Google Colab</a> uses an IPython-enhanced version of pdb, although the interface is not very user-friendly, in my humble opinion.</p>
</aside>
<p>Debuggers are programs that do exactly this. By learning how to use a debugger, you can:</p>
<ol class="arabic simple">
<li><p>Start, stop, continue, and restart the execution of your script at any point in its execution; and</p></li>
<li><p>Inspect your script’s runtime state without inserting print-statements into its source code.</p></li>
</ol>
<p>In my experience, too many of us (myself included) wait too long to move from debugging print-statements to a debugger. A good part of the reason is that debuggers seem mysterious. How is it that the debugger can stop and then restart a script? How does it regain control at the point where we wanted our script to stop? What allows the debugger to answer our questions about our script’s runtime state? What exactly is this runtime state I keep mentioning?</p>
<p>To solve these mysteries, we’ll build pieces of a debugger in Python, and along the way, you’ll learn a fundamental fact about computing systems and the basic structure of the Python interpreter. I hope that this knowledge encourages you to try using a debugger the next time your script falls into an infinite loop or fails in some cryptic manner. You’ll be amazed at how you can use this powerful tool to quickly find your typos and fix your design errors.</p>
<div class="admonition-learning-outcomes admonition">
<p class="admonition-title">Learning Outcomes</p>
<p>Learn about the duality of code and data in modern computing machines, which allows us to build tools that help us to debug and instrument our scripts. You will build your own simple debugger and an instrumentation tool. You’ll also learn the meaning and importance of the acronym REPL, which describes the Python interactive interpreter environment. After completing this chapter, you will be able to:</p>
<ul class="simple">
<li><p>Describe the basic operation of debuggers and code instrumentation tools, which are invaluable for finding and fixing design and subtle coding errors in your scripts [design and CS concepts];</p></li>
<li><p>Discuss the meaning and importance of the duality of code and data [CS concepts];</p></li>
<li><p>Explain the connections between breakpoints and runtime state [CS concepts];</p></li>
<li><p>Raise your own exceptions and pass information from the point of the exception to the exception handler [CS concepts and programming skills];</p></li>
<li><p>Use Python’s built-in function <code class="docutils literal notranslate"><span class="pre">exec</span></code> to launch a script from within a script and explain how the two scripts interact [CS concepts and programming skills];</p></li>
<li><p>Use Python’s built-in function <code class="docutils literal notranslate"><span class="pre">eval</span></code> to mimic the read-eval-print loop (REPL) at the heart of Python’s interactive interpreter [CS concepts and programming skills].</p></li>
</ul>
</div>
<section id="the-duality-of-code-and-data">
<h2>The duality of code and data<a class="headerlink" href="#the-duality-of-code-and-data" title="Permalink to this heading">#</a></h2>
<p>The first problem we solved in this book had us write a Python script that we eventually called <code class="docutils literal notranslate"><span class="pre">read32.py</span></code> and with which we read the data file <code class="docutils literal notranslate"><span class="pre">CatInTheHat.txt</span></code>. <a class="reference internal" href="#c15-fig1-ref"><span class="std std-numref">Figure 29</span></a> is a screenshot of both these files. Besides their contents, what’s the difference between them? Take a moment to ponder this question, and then read on.</p>
<figure class="align-default" id="c15-fig1-ref">
<img alt="_images/c15_fig1.png" src="_images/c15_fig1.png" />
<figcaption>
<p><span class="caption-number">Fig. 29 </span><span class="caption-text">Screenshot of an editor with the open files <code class="docutils literal notranslate"><span class="pre">read32.py</span></code> and <code class="docutils literal notranslate"><span class="pre">CatInTheHat.txt</span></code>.</span><a class="headerlink" href="#c15-fig1-ref" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Both are files containing text. Both sit in the memories of our computing systems. However, we think of one as a script, or code, and the other as data. But what exactly is code? What distinguishes it from data?</p>
<p>In plain English, code is a set of instructions we expect the computer to follow, while data is what we tell, through our instructions, the computer to manipulate. But inside the machine, when we strip away these interpretations, both code and data are just sequences of bits stored somewhere in our computer’s memory. The only difference between these bit sequences is in how we tell the machine to treat them.</p>
<p>This highlights the key insight to understanding debuggers: Because code and data are both just sequences of bits, <em>the same sequence of bits can sometimes be treated as code and other times as data</em>. This is called the <em>duality of code and data</em> in modern computing systems.</p>
<p>For example, sometimes we use a Python script as a set of instructions to direct our computer to complete some task for us, with help from the Python interpreter. Other times, we tell a program (e.g., the editor in our IDE) to read and write our Python script as data. A debugger plays both these roles.</p>
</section>
<section id="breakpoints-and-runtime-state">
<h2>Breakpoints and runtime state<a class="headerlink" href="#breakpoints-and-runtime-state" title="Permalink to this heading">#</a></h2>
<p>The following is a typical way to use a debugger:</p>
<ol class="arabic simple">
<li><p>Start the debugger and ask it to open your script. Your script is being treated as data.</p></li>
<li><p>Tell the debugger where you want to place a <em>breakpoint</em>, which is a point (e.g., a file line) in your script where you’d like to pause its execution. The debugger is still treating your script like data, and I’ll explain in a moment what exactly a breakpoint is and how the debugger modifies your script.</p></li>
<li><p>Tell the debugger to start the execution of (possibly its modified version of) your script under its control. You’re now telling the debugger to stop treating your script as data and instead treat it like code. But you’re also indicating that you’d like the debugger to regain control when your script completes, encounters an error, throws an exception, or hits a breakpoint.</p></li>
<li><p>Interact with your executing script as you normally would. Your computer is treating your script as code.</p></li>
<li><p>Upon encountering a runtime error, exception, or breakpoint in your script, the debugger’s prompt returns. Importantly, your script’s execution has not terminated, but <em>paused</em> at the point of the error, exception, or breakpoint. At this point, the debugger has access to your script and its <em>runtime state</em>, which includes the active stack frames and any variables (including their current values) <em>in scope</em> at that point. “In scope” is a technical term in computer science: a variable is in scope if it’s valid to use it at that point in the program. Pulling back from the details, the debugger is again treating your script as data, but it also has access to your script’s runtime state as data.</p></li>
<li><p>Tell the debugger to do something else. This might have you asking the debugger to print the value of some variable or to add a new breakpoint. Some debuggers even allow you to change portions of the script’s runtime state. Eventually, you’ll decide to either continue the script’s execution (returning to step 4) or terminate it.</p></li>
<li><p>When your script’s execution terminates, the debugger is still running and it continues to have access to your script’s source code (as data). You can set new breakpoints and restart your script’s execution, which allows you to test new theories about what’s wrong with it.</p></li>
</ol>
</section>
<section id="inserting-a-breakpoint">
<h2>Inserting a breakpoint<a class="headerlink" href="#inserting-a-breakpoint" title="Permalink to this heading">#</a></h2>
<p>Let’s drive home these concepts by building our own minimal debugger using nothing but Python statements. As we’ve practiced throughout this book, we’ll start simply: the first version of our debugger will read the script we want debugged, insert a breakpoint, and write out the edited script. The following is some pseudocode to get us started:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1">### Pseudocode for our Python script debugger</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="c1"># Ask for the name of the script to be debugged</span>
<span class="linenos">4</span><span class="c1"># Call our debugging routine with this script name</span>
<span class="linenos">5</span><span class="c1"># .. Read in the original script</span>
<span class="linenos">6</span><span class="c1"># .. Ask for the line on which to place a breakpoint</span>
<span class="linenos">7</span><span class="c1"># .. Edit it to add the breakpoint</span>
<span class="linenos">8</span><span class="c1"># .. Return the edited script</span>
<span class="linenos">9</span><span class="c1"># Write out the edited script</span>
</pre></div>
</div>
<p>Notice that our script’s pseudocode separates the prompting of the user for the script-to-be-debugged from the function that will implement the debugger’s functionality. The indented pseudocode statements represent the tasks done by the debugging function, and instead of running the modified script with the inserted breakpoint, we’ll write it out so that we can examine it.</p>
<p>We can steal from prior scripts the work described in all but line 7, which adds the breakpoint to the script we want debugged. The next code block implements all the pseudocode except this line. Notice that the code encapsulates a number of our pseudocode tasks in functions and provides an ability to print the edited script as well as write it to a file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap15/pdb1.py</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">my_pdb</span><span class="p">(</span><span class="n">script_fname</span><span class="p">):</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="sd">&#39;&#39;&#39; First attempt at our debugger</span>
<span class="linenos"> 6</span><span class="sd">        Input:   filename of script to be debugged</span>
<span class="linenos"> 7</span><span class="sd">        Returns: edited script as list of lines</span>
<span class="linenos"> 8</span><span class="sd">    &#39;&#39;&#39;</span>
<span class="linenos"> 9</span>    <span class="n">edited_script</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">10</span>
<span class="linenos">11</span>    <span class="c1"># Read in the original script (as a list of file lines)</span>
<span class="linenos">12</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">script_fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
<span class="linenos">13</span>        <span class="n">edited_script</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="linenos">14</span>
<span class="linenos">15</span>    <span class="c1"># Grab line number where we&#39;ll place the breakpoint</span>
<span class="linenos">16</span>    <span class="n">breakpt</span> <span class="o">=</span> <span class="n">get_lineno</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edited_script</span><span class="p">))</span>
<span class="linenos">17</span>
<span class="linenos">18</span>    <span class="c1"># Convert breakpoint number into a list index</span>
<span class="linenos">19</span>    <span class="n">breakpt_index</span> <span class="o">=</span> <span class="n">breakpt</span> <span class="o">-</span> <span class="mi">1</span>
<span class="linenos">20</span>
<span class="linenos">21</span>    <span class="c1"># Add the breakpoint</span>
<span class="linenos">22</span>    <span class="c1"># TO BE WRITTEN</span>
<span class="linenos">23</span>
<span class="linenos">24</span>    <span class="k">return</span> <span class="n">edited_script</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="k">def</span> <span class="nf">get_lineno</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
<span class="linenos">27</span><span class="w">    </span><span class="sd">&#39;&#39;&#39; Asks for the user for a line number</span>
<span class="linenos">28</span><span class="sd">        Input:   number of lines in script</span>
<span class="linenos">29</span><span class="sd">        Returns: user&#39;s line number</span>
<span class="linenos">30</span><span class="sd">    &#39;&#39;&#39;</span>
<span class="linenos">31</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">32</span>        <span class="k">try</span><span class="p">:</span>
<span class="linenos">33</span>            <span class="n">lineno</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Line number in script? &#39;</span><span class="p">))</span>
<span class="linenos">34</span>            <span class="k">if</span> <span class="n">lineno</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">lineno</span> <span class="o">&gt;=</span> <span class="n">lines</span><span class="p">:</span>
<span class="linenos">35</span>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The number must be in the interval [1,</span><span class="si">{</span><span class="n">lines</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
<span class="linenos">36</span>                <span class="k">continue</span>
<span class="linenos">37</span>            <span class="k">return</span> <span class="n">lineno</span>
<span class="linenos">38</span>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<span class="linenos">39</span>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The line number must be an integer&#39;</span><span class="p">)</span>
<span class="linenos">40</span>
<span class="linenos">41</span><span class="k">def</span> <span class="nf">print_it</span><span class="p">(</span><span class="n">edited_script</span><span class="p">):</span>
<span class="linenos">42</span><span class="w">    </span><span class="sd">&#39;&#39;&#39; Print out edited script with line numbers &#39;&#39;&#39;</span>
<span class="linenos">43</span>    <span class="n">cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edited_script</span><span class="p">)))</span>
<span class="linenos">44</span>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edited_script</span><span class="p">):</span>
<span class="linenos">45</span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">:</span><span class="s1">&gt;</span><span class="si">{</span><span class="n">cols</span><span class="si">}}</span><span class="s1"> </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos">46</span>
<span class="linenos">47</span><span class="k">def</span> <span class="nf">write_it</span><span class="p">(</span><span class="n">edited_script</span><span class="p">,</span> <span class="n">orig_fname</span><span class="p">):</span>
<span class="linenos">48</span><span class="w">    </span><span class="sd">&#39;&#39;&#39; Write edited script to a file with a `-db.py` suffix &#39;&#39;&#39;</span>
<span class="linenos">49</span>    <span class="n">output_fname</span> <span class="o">=</span> <span class="n">orig_fname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">,</span> <span class="s1">&#39;-db.py&#39;</span><span class="p">)</span>
<span class="linenos">50</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
<span class="linenos">51</span>        <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edited_script</span><span class="p">))</span>
<span class="linenos">52</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrote </span><span class="si">{</span><span class="n">output_fname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">53</span>
<span class="linenos">54</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos">55</span>    <span class="c1"># Ask for the name of the script to be debugged, unless already provided</span>
<span class="linenos">56</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">57</span>        <span class="n">fname</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;What script would you like to debug? &#39;</span><span class="p">)</span>
<span class="linenos">58</span>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="linenos">59</span>        <span class="n">fname</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">60</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">61</span>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Usage: python3 pdb0-soln.py [script_to_be_debugged]&#39;</span><span class="p">)</span>
<span class="linenos">62</span>
<span class="linenos">63</span>    <span class="n">edited_script</span> <span class="o">=</span> <span class="n">my_pdb</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="linenos">64</span>
<span class="linenos">65</span>    <span class="n">print_it</span><span class="p">(</span><span class="n">edited_script</span><span class="p">)</span>
<span class="linenos">66</span>    <span class="c1"># write_it(edited_script, fname)</span>
<span class="linenos">67</span>
<span class="linenos">68</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">69</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>If you run <code class="docutils literal notranslate"><span class="pre">pdb1.py</span></code>, giving it a script-to-be-debugged either on the command line or through the prompt, you’ll see that it asks for a line on which to place a breakpoint, but it doesn’t actually edit the script. Let’s change the function <code class="docutils literal notranslate"><span class="pre">my_pdb</span></code> to insert a breakpoint.</p>
</section>
<section id="inserting-a-new-statement">
<h2>Inserting a new statement<a class="headerlink" href="#inserting-a-new-statement" title="Permalink to this heading">#</a></h2>
<p>A breakpoint is nothing more than the raising of a Python exception, which will give control back to our debugger if it catches all exceptions raised by the script-to-be-debugged. We can create our own Python exception and raise it as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">raise</span> <span class="pre">Exception(&quot;My</span> <span class="pre">breakpoint&quot;)</span></code></p>
<p>Let’s assume our script-to-be-debugged is <code class="docutils literal notranslate"><span class="pre">guess32.py</span></code> from Chapter 5, and we’d like to put this breakpoint before line 24 in this script. This line compares the user’s guess against the secret. Notice that I said “before line 24.” I don’t mean any point before line 24, but the point immediately before this line. In other words, line 23 (and everything before it at runtime) should have executed, but line 24 (and everything after it at runtime) should not have.</p>
<p>How we insert the raise-statement into <code class="docutils literal notranslate"><span class="pre">guess32.py</span></code> between lines 23 and 24 depends on whether we are able to <em>stretch the script without breaking it</em>. In other words, is the script that we give the debugger more like:</p>
<ul class="simple">
<li><p>a Python list, which is a data structure that makes it easy to stretch and then insert a new element; or</p></li>
<li><p>an image file, which is a data structure in which we can change some of the image bits, but not add or remove bits?</p></li>
</ul>
<p>Neither case is hard, but you have to know which kind of data structure is holding the script’s statements (or more generally instructions). In <code class="docutils literal notranslate"><span class="pre">my_pdb</span></code>, where we’re reading the script from a text file using <code class="docutils literal notranslate"><span class="pre">readlines</span></code>, inserting a new statement is easy, as I’ll illustrate in a moment.</p>
<aside class="margin sidebar">
<p class="sidebar-title">When Instructions Vary in Length</p>
<p>While I made it sound like this operation is a one-for-one replacement, it isn’t always the case. In general, you need to remove and save enough of the original text to fit the encoding of a breakpoint exception.</p>
</aside>
<p>However, some debuggers work with the script’s instructions in a data structure that resembles an image file. Since we cannot easily stretch the bit array in an image file, the debugger instead saves a copy of the statement that will execute after the breakpoint (i.e., line 24 in our example) and then overwrites this statement in the image file with the breakpoint statement. If the user wants to continue the script’s execution, the debugger will first replace the breakpoint statement with the saved statement and then continue execution.</p>
</section>
<section id="indenting-that-statement">
<h2>Indenting that statement<a class="headerlink" href="#indenting-that-statement" title="Permalink to this heading">#</a></h2>
<p>Using <code class="docutils literal notranslate"><span class="pre">list.insert</span></code>, it’s pretty easy to insert our breakpoint statement. We simply have to remember that indexing into <code class="docutils literal notranslate"><span class="pre">edited_script</span></code> starts at <code class="docutils literal notranslate"><span class="pre">0</span></code> while the user’s counting of the lines in the script-to-be-debugged starts at <code class="docutils literal notranslate"><span class="pre">1</span></code>. We took care of this conversion immediately after grabbing the line number from the user (line 19 in <code class="docutils literal notranslate"><span class="pre">pdb1.py</span></code>). No off-by-one errors in our script, please!</p>
<p><code class="docutils literal notranslate"><span class="pre">edited_script.insert(breakpt_index,</span> <span class="pre">'raise</span> <span class="pre">Exception(&quot;My</span> <span class="pre">breakpoint&quot;)\n')</span></code></p>
<p>But there’s a problem with our new breakpoint statement. Do you see it? What indentation did we give this new statement? Remember that indentation in a Python script holds meaning. What indentation do we want for this new statement?</p>
<aside class="margin sidebar">
<p class="sidebar-title">Multiple Arguments</p>
<p>You’ll notice that I added an additional argument to the <code class="docutils literal notranslate"><span class="pre">Exception</span></code> object created on line 32, which we’ll use in a moment. The first argument is our name for the exception and the second is the line number where we placed the breakpoint. You can add as many arguments as you’d like when you create an <code class="docutils literal notranslate"><span class="pre">Exception</span></code> object. We could also create our own exception class that derives from <code class="docutils literal notranslate"><span class="pre">Exception</span></code>, but the current approach is good enough for learning about debugging.</p>
</aside>
<p>If you think about this, you’ll realize that it is the indentation of the line we’re replacing (i.e., line 24 in our example). We need to grab the whitespace at the start of this line and add it to the start of our new statement. We could do this using a regular expression, but this work is simple enough that we could also just build a loop with an if-else-statement. The next code block is an updated version of  the function <code class="docutils literal notranslate"><span class="pre">my_pdb</span></code> that calculates the whitespace we need and then inserts the correctly-indented breakpoint statement.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap15/pdb2.py</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos"> 3</span><span class="kn">import</span> <span class="nn">string</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">def</span> <span class="nf">my_pdb</span><span class="p">(</span><span class="n">script_fname</span><span class="p">):</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="sd">&#39;&#39;&#39; First attempt at our debugger</span>
<span class="linenos"> 7</span><span class="sd">        Input:   filename of script to be debugged</span>
<span class="linenos"> 8</span><span class="sd">        Returns: edited script as list of lines</span>
<span class="linenos"> 9</span><span class="sd">    &#39;&#39;&#39;</span>
<span class="linenos">10</span>    <span class="n">edited_script</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">11</span>
<span class="linenos">12</span>    <span class="c1"># Read in the original script (as a list of file lines)</span>
<span class="linenos">13</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">script_fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
<span class="linenos">14</span>        <span class="n">edited_script</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="linenos">15</span>
<span class="linenos">16</span>    <span class="c1"># Grab line number where we&#39;ll place the breakpoint</span>
<span class="linenos">17</span>    <span class="n">breakpt</span> <span class="o">=</span> <span class="n">get_lineno</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edited_script</span><span class="p">))</span>
<span class="linenos">18</span>
<span class="linenos">19</span>    <span class="c1"># Convert breakpoint number into a list index</span>
<span class="linenos">20</span>    <span class="n">breakpt_index</span> <span class="o">=</span> <span class="n">breakpt</span> <span class="o">-</span> <span class="mi">1</span>
<span class="linenos">21</span>
<span class="linenos">22</span>    <span class="c1"># Add the breakpoint</span>
<span class="linenos">23</span>    <span class="c1"># .. grab the whitespace so we get the right indentation</span>
<span class="linenos">24</span>    <span class="n">my_whitespace</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="linenos">25</span>    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">edited_script</span><span class="p">[</span><span class="n">breakpt_index</span><span class="p">]:</span>
<span class="linenos">26</span>        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">whitespace</span><span class="p">:</span>
<span class="linenos">27</span>            <span class="n">my_whitespace</span> <span class="o">+=</span> <span class="n">c</span>
<span class="linenos">28</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">29</span>            <span class="k">break</span>
<span class="linenos">30</span>
<span class="linenos">31</span>    <span class="n">breakpt_statement</span> <span class="o">=</span> <span class="n">my_whitespace</span> <span class="o">+</span> \
<span class="linenos">32</span>        <span class="sa">f</span><span class="s1">&#39;raise Exception(&quot;My breakpoint&quot;, </span><span class="si">{</span><span class="n">breakpt</span><span class="si">}</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="linenos">33</span>
<span class="linenos">34</span>    <span class="c1"># .. insert a raise statement as our breakpoint</span>
<span class="linenos">35</span>    <span class="n">edited_script</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">breakpt_index</span><span class="p">,</span> <span class="n">breakpt_statement</span><span class="p">)</span>
<span class="linenos">36</span>
<span class="linenos">37</span>    <span class="k">return</span> <span class="n">edited_script</span>
<span class="linenos">38</span>
<span class="linenos">39</span><span class="c1"># the other functions and main are unchanged from pdb1.py</span>
</pre></div>
</div>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">pdb2.py</span></code> on <code class="docutils literal notranslate"><span class="pre">guess32.py</span></code> adding a breakpoint at line 24. Take a look at the output file (<code class="docutils literal notranslate"><span class="pre">guess32-db.py</span></code>) and make sure that we inserted the breakpoint statement correctly. Go ahead and run <code class="docutils literal notranslate"><span class="pre">guess32-db.py</span></code>.</p>
<p>You might even try commenting out lines 24-29, which calculates the correct amount of whitespace needed at the start of the breakpoint statement, rebuild <code class="docutils literal notranslate"><span class="pre">guess32-db.py</span></code> using this changed version of <code class="docutils literal notranslate"><span class="pre">pdb2.py</span></code>, and run this new <code class="docutils literal notranslate"><span class="pre">guess32-db.py</span></code> to see how the error message changes.</p>
<p>Don’t forget to restore lines 24-29 before reading on!</p>
</div>
</section>
<section id="launching-a-script-from-within-a-script">
<h2>Launching a script from within a script<a class="headerlink" href="#launching-a-script-from-within-a-script" title="Permalink to this heading">#</a></h2>
<p>We have edited our script-to-be-debugged, and we’ve seen its behavior has changed (i.e., it now raises our breakpoint exception). Our next task is to launch this edited script under the control of our debugger and have it catch the breakpoint exception. We know how to catch exceptions using a try-except-statement, but how do we start the execution of the edited script from within our debugger?</p>
<p>It’s actually quite simple. Python includes a built-in function that allows you to execute a string as if it were a Python script. It’s called <code class="docutils literal notranslate"><span class="pre">exec</span></code>, and we can experiment with it using the function strings from Chapter 14.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">hello_world</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;world = &quot;world&quot;</span>
<span class="linenos">2</span><span class="s1">print(&quot;Hello&quot;, world)</span>
<span class="linenos">3</span><span class="s1">&#39;&#39;&#39;</span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="n">exec</span><span class="p">(</span><span class="n">hello_world</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">hello_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;def hello(s):</span>
<span class="linenos">2</span><span class="s1">    print(&quot;Hello&quot;, s)</span>
<span class="linenos">3</span><span class="s1">&#39;&#39;&#39;</span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="n">exec</span><span class="p">(</span><span class="n">hello_str</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>Run the first of the two code blocks above in the Python interpreter. In the string named <code class="docutils literal notranslate"><span class="pre">hello_world</span></code>, we put two Python statements, which we call <code class="docutils literal notranslate"><span class="pre">exec</span></code> to run.</p>
<p>If you then type <code class="docutils literal notranslate"><span class="pre">world</span></code> at the interpreter prompt and hit return, you’ll see that the definition of this name is in the global namespace, just as if we had written <code class="docutils literal notranslate"><span class="pre">world</span> <span class="pre">=</span> <span class="pre">&quot;world&quot;</span></code> at the interpreter’s prompt!</p>
<p>Now run the second of the code blocks. It prints nothing because we only defined the function <code class="docutils literal notranslate"><span class="pre">hello</span></code>. To verify this, type <code class="docutils literal notranslate"><span class="pre">hello(&quot;world&quot;)</span></code> at the interpreter’s prompt. It runs because <code class="docutils literal notranslate"><span class="pre">hello</span></code> is in the global namespace.</p>
<p>Continue experimenting with other examples.</p>
</div>
<p>Let’s use this new knowledge to launch an edited script within our debugger. This requires us to call <code class="docutils literal notranslate"><span class="pre">exec</span></code> with an argument that is the string that represents the edited script. The next code block rewrites <code class="docutils literal notranslate"><span class="pre">main</span></code> in <code class="docutils literal notranslate"><span class="pre">pdb2.py</span></code> (the function <code class="docutils literal notranslate"><span class="pre">my_pdb</span></code> is unchanged) to remove the writing of <code class="docutils literal notranslate"><span class="pre">edited_script</span></code> to a file and instead to call <code class="docutils literal notranslate"><span class="pre">exec</span></code> within a try-except-statement.</p>
<aside class="margin sidebar">
<p class="sidebar-title">Joining Strings</p>
<p>I use the <code class="docutils literal notranslate"><span class="pre">join</span></code> method on an empty string to convert the many strings in <code class="docutils literal notranslate"><span class="pre">edited_script</span></code> into one continuous string; this is an often-used trick in Python scripts.</p>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">62</span><span class="c1">### chap15/pdb3.py</span>
<span class="linenos">63</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos">64</span>
<span class="linenos">65</span><span class="c1"># my_pdb is unchanged from pdb2.py</span>
<span class="linenos">66</span>
<span class="linenos">67</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos">68</span>    <span class="c1"># Ask for the name of the script to be debugged, unless already provided</span>
<span class="linenos">69</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">70</span>        <span class="n">fname</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;What script would you like to debug? &#39;</span><span class="p">)</span>
<span class="linenos">71</span>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="linenos">72</span>        <span class="n">fname</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">73</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">74</span>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Usage: python3 pdb3.py [script_to_be_debugged]&#39;</span><span class="p">)</span>
<span class="linenos">75</span>
<span class="linenos">76</span>    <span class="n">edited_script</span> <span class="o">=</span> <span class="n">my_pdb</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="linenos">77</span>
<span class="linenos">78</span>    <span class="c1"># print_it(edited_script)</span>
<span class="linenos">79</span>    <span class="c1"># write_it(edited_script, fname)</span>
<span class="linenos">80</span>
<span class="linenos">81</span>    <span class="c1"># Run the edited script and catch our breakpoint exception.</span>
<span class="linenos">82</span>    <span class="c1"># Remember to turn the list of strings into one big string.</span>
<span class="linenos">83</span>    <span class="k">try</span><span class="p">:</span>
<span class="linenos">84</span>        <span class="n">exec</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edited_script</span><span class="p">),</span> <span class="nb">globals</span><span class="p">())</span>
<span class="linenos">85</span>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
<span class="linenos">86</span>        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;My breakpoint&#39;</span><span class="p">:</span>
<span class="linenos">87</span>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pdb3: Breakpoint at line </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">88</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">89</span>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pdb3: script died with non-breakpoint exception&#39;</span><span class="p">)</span>
<span class="linenos">90</span>            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
<p>It’s worth pointing out two other interesting aspects of the try-except-statement and the <code class="docutils literal notranslate"><span class="pre">exec</span></code> call used in this code block:</p>
<ol class="arabic simple">
<li><p>In an except clause, we can declare a variable after the exception name (inserting the keyword <code class="docutils literal notranslate"><span class="pre">as</span></code> in-between). This variable (<code class="docutils literal notranslate"><span class="pre">msg</span></code> in the code block) is another name for the <code class="docutils literal notranslate"><span class="pre">Exception</span></code> object that was caught, and with it, we can access the arguments we specified when creating the <code class="docutils literal notranslate"><span class="pre">Exception</span></code> object. We access them using the <code class="docutils literal notranslate"><span class="pre">Exception</span></code> object’s <code class="docutils literal notranslate"><span class="pre">args</span></code> attribute, which acts like a list.</p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">exec</span></code> call on line 84, we explicitly defined one of its optional parameters, which is the dictionary where global names should be placed. We want this to be the same dictionary as our current global namespace, which we can access with the built-in function <code class="docutils literal notranslate"><span class="pre">globals</span></code>. We need this extra argument here and not in our earlier examples because there’s an import-statement in <code class="docutils literal notranslate"><span class="pre">edited_script</span></code>. If you remove this argument from the <code class="docutils literal notranslate"><span class="pre">exec</span></code> call, you’ll see that the debugging run of <code class="docutils literal notranslate"><span class="pre">guess32</span></code> dies saying that the name <code class="docutils literal notranslate"><span class="pre">random</span></code> is not defined (i.e., this module was imported into the wrong namespace).</p></li>
</ol>
<p>These details make our debugger into a useful and well-structured tool. More importantly, I hope that you see how we can build a debugger, which is nothing more than a program that reads a script as data, modifies it as it would any other data file, and then tells the machine to treat this data as code. By launching the script within a try-except-statement, the debugger can regain control of the machine on a breakpoint or any other error inside the script. First mystery solved!</p>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>You’re now ready to read the documentation about <a class="reference external" href="https://docs.python.org/3/library/pdb.html">the actual Python Debugger</a> called <code class="docutils literal notranslate"><span class="pre">pdb</span></code>. I recommend invoking it from the command line as in <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">pdb</span> <span class="pre">guess32.py</span></code>, which starts the debugger and loads <code class="docutils literal notranslate"><span class="pre">guess32.py</span></code> into it. At the first four <code class="docutils literal notranslate"><span class="pre">pdb</span></code> prompts, type the following four commands in order: <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">14</span></code>; <code class="docutils literal notranslate"><span class="pre">r</span></code>; <code class="docutils literal notranslate"><span class="pre">p</span> <span class="pre">secret</span></code>; and <code class="docutils literal notranslate"><span class="pre">r</span></code>. This will help get you started with <code class="docutils literal notranslate"><span class="pre">pdb</span></code> and its commands, and it’ll give you a preview of what follows! Oh, and <code class="docutils literal notranslate"><span class="pre">q</span></code> quits <code class="docutils literal notranslate"><span class="pre">pdb</span></code>.</p>
</div>
</section>
<section id="instrumenting-a-script">
<h2>Instrumenting a script<a class="headerlink" href="#instrumenting-a-script" title="Permalink to this heading">#</a></h2>
<p>We could go on and implement what needs to be done to look at the state of the running script, but then we’d just be reimplementing what we already have in the Python debugger <code class="docutils literal notranslate"><span class="pre">pdb</span></code>. Instead, let’s get a feel for accessing another script’s runtime state by modifying <code class="docutils literal notranslate"><span class="pre">pdb3.py</span></code> so that it <em>instruments</em> this other script. What does this mean? Basically, we’ll build a script that allows us to specify:</p>
<ol class="arabic simple">
<li><p>Where to put print statements in a script; and</p></li>
<li><p>What we want those print statements to say.</p></li>
</ol>
<p>We’ve been doing this by hand and messing up our scripts along the way. An instrumentation tool could be a much cleaner approach. And it is trivial to do that now that we have <code class="docutils literal notranslate"><span class="pre">pdb3.py</span></code>! We simply have to:</p>
<ol class="arabic simple">
<li><p>Replace our breakpoint statement with a print statement; and</p></li>
<li><p>Have the user specify what they’d like printed.</p></li>
</ol>
<p>The code in <code class="docutils literal notranslate"><span class="pre">pin32.py</span></code> below should look very similar to the code in <code class="docutils literal notranslate"><span class="pre">pdb3.py</span></code>. I’ve renamed the function <code class="docutils literal notranslate"><span class="pre">my_pdb</span></code> to be <code class="docutils literal notranslate"><span class="pre">my_pin</span></code>, and I’ve added a parameter to it, which I’ll explain in a moment. I’ve also stripped away the try-except-statement that was surrounding the <code class="docutils literal notranslate"><span class="pre">exec</span></code> call in <code class="docutils literal notranslate"><span class="pre">main</span></code>. Since we’re adding a print-statement rather than raise-statement, there’s no longer any need to catch exceptions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap15/pin32.py</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos"> 3</span><span class="kn">import</span> <span class="nn">string</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">def</span> <span class="nf">insert_print</span><span class="p">(</span><span class="n">edited_script</span><span class="p">,</span> <span class="n">breakpt_index</span><span class="p">,</span> <span class="n">ws</span><span class="p">):</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="sd">&#39;&#39;&#39;Inserts a user-defined print statement in `edited_script`,</span>
<span class="linenos"> 7</span><span class="sd">       which is a list of Python statements, at the index</span>
<span class="linenos"> 8</span><span class="sd">       specified, and with the indentation from `ws`.</span>
<span class="linenos"> 9</span><span class="sd">    &#39;&#39;&#39;</span>
<span class="linenos">10</span>    <span class="c1"># Ask for the print-statement argument</span>
<span class="linenos">11</span>    <span class="n">printarg</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;What is print&#39;s argument? &quot;</span><span class="p">)</span>
<span class="linenos">12</span>
<span class="linenos">13</span>    <span class="n">print_statement</span> <span class="o">=</span> <span class="n">ws</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;print(f&quot;</span><span class="si">{</span><span class="n">printarg</span><span class="si">}</span><span class="s1">&quot;)</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="linenos">14</span>
<span class="linenos">15</span>    <span class="c1"># Insert our print statement</span>
<span class="linenos">16</span>    <span class="n">edited_script</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">breakpt_index</span><span class="p">,</span> <span class="n">print_statement</span><span class="p">)</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="k">def</span> <span class="nf">my_pin</span><span class="p">(</span><span class="n">script_fname</span><span class="p">,</span> <span class="n">insert_code</span><span class="p">):</span>
<span class="linenos">19</span><span class="w">    </span><span class="sd">&#39;&#39;&#39;Adds code at a user-specified line number.</span>
<span class="linenos">20</span><span class="sd">        Inputs:  filename of script to be debugged</span>
<span class="linenos">21</span><span class="sd">                 function responsible for inserted code</span>
<span class="linenos">22</span><span class="sd">        Returns: edited script as list of lines</span>
<span class="linenos">23</span><span class="sd">    &#39;&#39;&#39;</span>
<span class="linenos">24</span>    <span class="n">edited_script</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">25</span>
<span class="linenos">26</span>    <span class="c1"># Read in the original script (as a list of file lines)</span>
<span class="linenos">27</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">script_fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
<span class="linenos">28</span>        <span class="n">edited_script</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="linenos">29</span>
<span class="linenos">30</span>    <span class="c1"># Grab line number where we&#39;ll place some new code</span>
<span class="linenos">31</span>    <span class="n">breakpt</span> <span class="o">=</span> <span class="n">get_lineno</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edited_script</span><span class="p">))</span>
<span class="linenos">32</span>
<span class="linenos">33</span>    <span class="c1"># Convert breakpoint number into a list index</span>
<span class="linenos">34</span>    <span class="n">breakpt_index</span> <span class="o">=</span> <span class="n">breakpt</span> <span class="o">-</span> <span class="mi">1</span>
<span class="linenos">35</span>
<span class="linenos">36</span>    <span class="c1"># Compute the leading whitespace at `breakpt_index`</span>
<span class="linenos">37</span>    <span class="n">my_whitespace</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="linenos">38</span>    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">edited_script</span><span class="p">[</span><span class="n">breakpt_index</span><span class="p">]:</span>
<span class="linenos">39</span>        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">whitespace</span><span class="p">:</span>
<span class="linenos">40</span>            <span class="n">my_whitespace</span> <span class="o">+=</span> <span class="n">c</span>
<span class="linenos">41</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">42</span>            <span class="k">break</span>
<span class="linenos">43</span>
<span class="linenos">44</span>    <span class="n">insert_code</span><span class="p">(</span><span class="n">edited_script</span><span class="p">,</span> <span class="n">breakpt_index</span><span class="p">,</span> <span class="n">my_whitespace</span><span class="p">)</span>
<span class="linenos">45</span>
<span class="linenos">46</span>    <span class="k">return</span> <span class="n">edited_script</span>
<span class="linenos">47</span>
<span class="linenos">48</span><span class="c1"># get_lineno, print_it, and write_it are unchanged from pdb3.py</span>
<span class="linenos">49</span>
<span class="linenos">50</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos">51</span>    <span class="c1"># Ask for the name of the script to be debugged, unless already provided</span>
<span class="linenos">52</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">53</span>        <span class="n">fname</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;What script would you like to instrument? &#39;</span><span class="p">)</span>
<span class="linenos">54</span>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="linenos">55</span>        <span class="n">fname</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">56</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">57</span>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Usage: python3 pin32.py [script_to_be_instrumented]&#39;</span><span class="p">)</span>
<span class="linenos">58</span>
<span class="linenos">59</span>    <span class="n">edited_script</span> <span class="o">=</span> <span class="n">my_pin</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">insert_print</span><span class="p">)</span>
<span class="linenos">60</span>
<span class="linenos">61</span>    <span class="c1"># Run the instrumented script</span>
<span class="linenos">62</span>    <span class="n">exec</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">edited_script</span><span class="p">),</span> <span class="nb">globals</span><span class="p">())</span>
<span class="linenos">63</span>    
<span class="linenos">64</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pin32: All done!&#39;</span><span class="p">)</span>
<span class="linenos">65</span>
<span class="linenos">66</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">67</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">my_pin</span></code> is nearly an exact duplicate of <code class="docutils literal notranslate"><span class="pre">my_pdb</span></code>; the only two differences between them are: (1) the extra parameter <code class="docutils literal notranslate"><span class="pre">insert_code</span></code>; and (2) the lines 31-35 in <code class="docutils literal notranslate"><span class="pre">pdb3.py</span></code> that became a call to <code class="docutils literal notranslate"><span class="pre">insert_code</span></code> on line 44 in <code class="docutils literal notranslate"><span class="pre">pin32.py</span></code>. The point of these two changes is to remove what we want inserted from the work to set up the insertion. The function <code class="docutils literal notranslate"><span class="pre">my_pin</span></code> sets up for an insertion of new Python statements, and the passed-in function <code class="docutils literal notranslate"><span class="pre">insert_code</span></code> is responsible for inserting whatever new statements we want in the edited script.</p>
<p>If you look at the function <code class="docutils literal notranslate"><span class="pre">insert_print</span></code> in <code class="docutils literal notranslate"><span class="pre">pin32.py</span></code>, you’ll see that I no longer insert a statement that raises an exception. This function inserts a print-statement whose argument is defined by the user of our tool. I’ve factored the code like this because an instrumentation function (<code class="docutils literal notranslate"><span class="pre">my_pin</span></code>) is a very useful tool, and we’ll play with a different <code class="docutils literal notranslate"><span class="pre">insert_code</span></code> function in a moment. First, however, try <code class="docutils literal notranslate"><span class="pre">pin32.py</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>### Run the highlighted command in the shell
<span class="hll">Chap15$ python3 pin32.py guess32.py
</span>Line number on which to place the print? 24
What is print&#39;s argument? The secret is {secret}
## Welcome to GUESS THE NUMBER! ##
Please input your guess: 33
The secret is 61
Too small!
Please input your guess: 61
The secret is 61
Exactly! You win!
pin32: All done!
</pre></div>
</div>
<p>To be even more efficient in my cheating, I could have stuck the print-statement right before <code class="docutils literal notranslate"><span class="pre">guess32.py</span></code> asked me for my guess, i.e., line 8. Cheating isn’t our goal, but I hope you see that we could insert a debugging print using <code class="docutils literal notranslate"><span class="pre">pin32.py</span></code> anywhere in any script that wasn’t working right. No longer do we have to edit our scripts to insert debugging prints!</p>
<p>I hope you also noticed that <code class="docutils literal notranslate"><span class="pre">pin32.py</span></code> regained control after the exec-statement (i.e., the transcript includes the “pin32: All done!”). This means that when an <code class="docutils literal notranslate"><span class="pre">exec</span></code> statement completes, execution continues in the script that called <code class="docutils literal notranslate"><span class="pre">exec</span></code>. It is a blocking call.</p>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>If you’re so inspired, you might make your own edits to the <code class="docutils literal notranslate"><span class="pre">main</span></code> function in <code class="docutils literal notranslate"><span class="pre">pin32.py</span></code> to extend this tool’s functionality. Try wrapping lines 69-75 in a loop that has the effect of folding multiple instrumentation-plus-execution sessions into one <code class="docutils literal notranslate"><span class="pre">pin32.py</span></code> run.</p>
</div>
</section>
<section id="repl">
<h2>REPL<a class="headerlink" href="#repl" title="Permalink to this heading">#</a></h2>
<p>Let’s take this line of thought one step farther, which will help you to understand the acronym REPL that you might have heard mentioned when people talk about the interactive Python interpreter. REPL stands for <em>Read-Eval-Print Loop</em>. You should think of this loop as: (1) read a string that represents an expression; (2) evaluate that expression; (3) print the result of the evaluation; and (4) loop back to read the next expression.</p>
<p>This loop is essentially what the Python interpreter does. It reads the first line in your script, which it then evaluates. The evaluation might update the value of some variables in the current namespace, insert some new names, or cause a <em>side effect</em>, which is the technical term for file input/output or printing to the terminal. All together, these constitute the “print” portion of loop. Finally, the interpreter moves on to read the next line in your script, and the loop start all over again.</p>
<p>The “Eval” step in the Python interpreter’s implementation of this loop is exposed to you as a Python programmer through the built-in function <code class="docutils literal notranslate"><span class="pre">eval</span></code>. It differs from <code class="docutils literal notranslate"><span class="pre">exec</span></code> in that it expects its string argument to be an expression. If you pass <code class="docutils literal notranslate"><span class="pre">eval</span></code> a Python statement, it will raise an exception.</p>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>Start the interactive Python interpreter, type <code class="docutils literal notranslate"><span class="pre">eval('3+4')</span></code>, and hit return. It should print <code class="docutils literal notranslate"><span class="pre">7</span></code>. Remember that the parameter to <code class="docutils literal notranslate"><span class="pre">eval</span></code> must be a string!</p>
<p>Next, change the string parameter to <code class="docutils literal notranslate"><span class="pre">'print(3+4)'</span></code> and hit return on this <code class="docutils literal notranslate"><span class="pre">eval</span></code> statement. Again, it should print <code class="docutils literal notranslate"><span class="pre">7</span></code>. Recall that a function call is an expression we can evaluate.</p>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">pin32.py</span></code>, we allowed the user to interrupt a script at some line number and print the value of some part of the script’s runtime state. But if we changed this single, inserted print-statement into a read-eval-print loop, the user of our tool could query as much of the script’s runtime state as they wanted before allowing the program to continue. The function <code class="docutils literal notranslate"><span class="pre">insert_repl</span></code> in <code class="docutils literal notranslate"><span class="pre">repl32.py</span></code> does exactly this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap15/repl32.py</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">pin32</span> <span class="kn">import</span> <span class="n">my_pin</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">def</span> <span class="nf">insert_repl</span><span class="p">(</span><span class="n">edited_script</span><span class="p">,</span> <span class="n">breakpt</span><span class="p">,</span> <span class="n">ws</span><span class="p">):</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="sd">&quot;&quot;&quot; Insert code to create a read-eval-print loop</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="sd">        while True:</span>
<span class="linenos"> 9</span><span class="sd">            p = input(&quot;repl&gt; &quot;)</span>
<span class="linenos">10</span><span class="sd">            if p == &quot;#q&quot;:</span>
<span class="linenos">11</span><span class="sd">                break</span>
<span class="linenos">12</span><span class="sd">            print(eval(p))</span>
<span class="linenos">13</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">14</span>    <span class="n">s</span> <span class="o">=</span> <span class="n">ws</span> <span class="o">+</span> <span class="s1">&#39;while True:</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="linenos">15</span>    <span class="n">edited_script</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">breakpt</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="linenos">16</span>    <span class="n">s</span> <span class="o">=</span> <span class="n">ws</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="s1">&#39;p = input(&quot;repl&gt; &quot;)</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="linenos">17</span>    <span class="n">edited_script</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">breakpt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="linenos">18</span>    <span class="n">s</span> <span class="o">=</span> <span class="n">ws</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="s1">&#39;if p == &quot;#q&quot;:</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="linenos">19</span>    <span class="n">edited_script</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">breakpt</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="linenos">20</span>    <span class="n">s</span> <span class="o">=</span> <span class="n">ws</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">8</span> <span class="o">+</span> <span class="s1">&#39;break</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="linenos">21</span>    <span class="n">edited_script</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">breakpt</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="linenos">22</span>    <span class="n">s</span> <span class="o">=</span> <span class="n">ws</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="s1">&#39;print(eval(p))</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="linenos">23</span>    <span class="n">edited_script</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">breakpt</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">repl32.py</span></code> script uses the <code class="docutils literal notranslate"><span class="pre">my_pin</span></code> function from <code class="docutils literal notranslate"><span class="pre">pin32.py</span></code> to handle the boilerplate work involved in instrumenting a script. It just provides the function (i.e., <code class="docutils literal notranslate"><span class="pre">insert_repl</span></code>) that specializes the work of the <code class="docutils literal notranslate"><span class="pre">my_pin</span></code> instrumentation routine, and <code class="docutils literal notranslate"><span class="pre">repl32.py</span></code> starts all this work with the call:</p>
<p><code class="docutils literal notranslate"><span class="pre">edited_script</span> <span class="pre">=</span> <span class="pre">my_pin(script,</span> <span class="pre">insert_repl)</span></code></p>
<p>We’ve built ourselves a powerful and flexible tool with which we can investigate the state of a running program. We’ve also built ourselves an interpreter than uses a script’s interrupted execution context as its environment.</p>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">repl32.py</span> <span class="pre">guess32.py</span></code> and answer <code class="docutils literal notranslate"><span class="pre">24</span></code> to the line-number question. Input a guess and then at the <code class="docutils literal notranslate"><span class="pre">repl&gt;</span></code> prompt, type <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">+</span> <span class="pre">4</span></code>. At the next prompt, type <code class="docutils literal notranslate"><span class="pre">secret</span></code> or <code class="docutils literal notranslate"><span class="pre">guess</span></code>. You might also type something like <code class="docutils literal notranslate"><span class="pre">secret</span> <span class="pre">==</span> <span class="pre">guess</span></code>. Experiment with your own input script!</p>
</div>
<p>You now have several tools with which you can slow down a program’s execution so that you can better understand its behavior and more quickly fix the bugs within it. Happy bug squashing!</p>
<p>[Version 20240605]</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="chap14.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapter 14: The Dream of Bug Fixing</p>
      </div>
    </a>
    <a class="right-next"
       href="chap16.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 16: Catch Them Early</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-duality-of-code-and-data">The duality of code and data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#breakpoints-and-runtime-state">Breakpoints and runtime state</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inserting-a-breakpoint">Inserting a breakpoint</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inserting-a-new-statement">Inserting a new statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#indenting-that-statement">Indenting that statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#launching-a-script-from-within-a-script">Launching a script from within a script</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#instrumenting-a-script">Instrumenting a script</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#repl">REPL</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mike Smith
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023 by Michael D. Smith. All rights reserved.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>