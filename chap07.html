

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Chapter 7: Many Numbers But Not Any Number &#8212; Computational Thinking and Problem Solving</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chap07';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Chapter 8: What Is My Problem?" href="chap08.html" />
    <link rel="prev" title="Chapter 6: Do You See My Dog?" href="chap06.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="welcome.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/mike_flat.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/mike_flat.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="welcome.html">
                    A Welcome
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chap01.html">Chapter 1: Read a Children’s Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap02.html">Chapter 2: Grab the Dialogue</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap03.html">Chapter 3: Replace Text With Emoji</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap04.html">Chapter 4: Query a Web Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap05.html">Chapter 5: Play Guess-a-number with a Friend</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap06.html">Chapter 6: Do You See My Dog?</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapter 7: Many Numbers But Not Any Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap08.html">Chapter 8: What Is My Problem?</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap09.html">Chapter 9: Find a Phrase</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap10.html">Chapter 10: Build an Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap11.html">Chapter 11: Discover Driving Directions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap12.html">Chapter 12: Divide and Conquer</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap13.html">Chapter 13: Rewrite the Error Messages</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap14.html">Chapter 14: The Dream of Automatic Bug Fixing</a></li>
<li class="toctree-l1"><a class="reference internal" href="ales.html">Active-Learning Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/chap07.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 7: Many Numbers But Not Any Number</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#floating-point-numbers-and-numerical-computing">Floating-point numbers and numerical computing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computers-struggle-with-arithmetic">Computers struggle with arithmetic?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-range-of-a-fp-number">The range of a FP number</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#precision">Precision</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#illustrating-this-issue-of-precision">Illustrating this issue of precision</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#one-bit-at-at-time">One bit at at time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#searching-for-the-smallest-difference">Searching for the smallest difference</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fp-errors-accumulate">FP errors accumulate</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chapter-7-many-numbers-but-not-any-number">
<h1>Chapter 7: Many Numbers But Not Any Number<a class="headerlink" href="#chapter-7-many-numbers-but-not-any-number" title="Permalink to this heading">#</a></h1>
<p>In the last chapter, we heard from Jill Lepore that counting was a key metric in industrialization and measurement a key driver of science, but we looked mostly at the computational data type for counting: the integer.</p>
<p>Clearly, counting isn’t the only thing we do with numbers, and the world isn’t nicely discrete in everything we do. In fact, we perceive the world as mostly <em>continuous</em>. For example, time doesn’t just move forward in discrete seconds, but also in tenths, hundredths, and infinitely small pieces of a second. Similarly, we don’t solely measure distance in an integral number of meters, but also in centimeters, millimeters, and infinitely small pieces of a meter. The same logic applies to measuring volume and weight and force and pretty much anything else we measure.</p>
<p>If we’re going to use computers to help us do creative things and generate new knowledge in our physical world, we’re going to need to represent and manipulate <em>measured values</em>. For instance, we will soon measure the running time of our scripts, and in this, we will look at not just the time in seconds, but also fractions of a second.</p>
<section id="floating-point-numbers-and-numerical-computing">
<p><strong>Floating-point numbers and numerical computing.</strong> Measurements with fractional units, like 6.574 seconds, are described as <em>real numbers</em>, and Python uses a datatype called <code class="docutils literal notranslate"><span class="pre">float</span></code> to represent such numbers. This name is a shorthand for <em>floating point (FP)</em>, <a class="reference external" href="https://standards.ieee.org/standard/754-2019.html">a standardized representation and a type of computational arithmetic.</a></p>
<p>There are many details involved in this standard and peculiarities involved in using FP numbers to solve your problems. There are entire courses that will teach you how to use a computer to accurately solve problems involving continuous variables, like time and distance. This area of computer science comes under many names, including <em>numerical computing</em> and <em>scientific computing</em>, and the techniques taught will help you to use computers to study the range of physical and social phenomena in the world around us.</p>
<div class="admonition-learning-outcomes admonition">
<p class="admonition-title">Learning Outcomes</p>
<p>In this chapter, you will learn how computers represent numbers with fractional components, which is an important datatype if you’re going write script that help you solve problems involving measured values. By the end of the chapter, you will be able to:</p>
<ul class="simple">
<li><p>Understand the floating-point (FP) number standard and how computers use it to represent real numbers [CS concepts];</p></li>
<li><p>Explain the difference between applications that require integers and those that require FP numbers [design and CS concepts];</p></li>
<li><p>Discuss the difficulty computers have representing some real numbers [CS concepts and programming skills].</p></li>
</ul>
</div>
</section>
<section id="computers-struggle-with-arithmetic">
<p><strong>Computers struggle with arithmetic?</strong> We won’t attempt to cover the breadth of numerical algorithms, but answer a fundamental question at the heart of numerical computing and in line with our efforts to understand how computers operate: <em>If computers see everything in the world as a collection of numbers and they’ve been constructed to do computation on numbers, why are some types of computation hard to do on a computer?</em></p>
<p>While this might seem paradoxical, this problem occurs because any compact representation of real numbers needs to make a tradeoff between <em>range</em> (i.e., how large is the difference between the biggest and smallest real numbers that we can represent?) and <em>precision</em> (i.e., how close is a real number we can represent to the real number we want to represent?).</p>
<p>We first thought about the issue of range in an active-learning exercise in Chapter 6, when we investigated whether addition on Python integers would ever overflow the programming language’s physical representation. While Python doesn’t place a limit on the largest and smallest representable integer values (i.e., it has a dynamically expandable representation), most programming languages have a clearly stated limit on these values for each of their defined integer datatypes. And for FP numbers, the same is true in Python.</p>
<p>Python adheres to the FP standard representation IEEE 754. As we’ll see in a moment, the range defined by this standard, while not infinite, is comfortably big. In other words, most of us won’t write scripts involving real numbers that will overflow this FP representation.</p>
<p>Unfortunately, the same cannot be said of precision. You’ll almost certainly write scripts that will have to deal with the issue of FP precision. Precision is, informally, a measure of how close the computer’s representation of a real number is to its mathematical value. Sometimes the two are the same, but too often they’re not.</p>
<p>I’ll demonstrate with a computation we all learned to do when we were around 8 years old: What is the square of 0.1? You and I know the answer to be 0.01, but let’s ask Python to do this computation for us:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">n</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="linenos">2</span><span class="n">n</span> <span class="o">*</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">0.01</span>
</pre></div>
</div>
<p>When you run this code block, it should surprise you that the value you know to be n-squared for <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">0.1</span></code> is not the result of the multiplication of that number with itself. How can our fancy computers get the wrong answer to this simple arithmetic problem?!? Well, let’s find out by writing a script to understand how the FP standard represents real numbers like <code class="docutils literal notranslate"><span class="pre">0.1</span></code>.</p>
</section>
<section id="the-range-of-a-fp-number">
<p><strong>The range of a FP number.</strong> Floating point represents a real number in the form of a <em>significand</em> times a <em>base</em> raised to an <em>exponent</em>, where the significand and the exponent are integers stored directly in the FP representation. The base is an integer greater than or equal to two. This base is defined in the standard and not stored explicitly in the representation. To know what real number is expressed by a particular FP representation, however, you also have to know where the representation assumes that the number’s <em>radix point</em> (more commonly called a decimal point for base-10 numbers) is placed.</p>
<p>For example, we could encode 6.574 as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">6574</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">6574</span></code> is the significand, <code class="docutils literal notranslate"><span class="pre">-3</span></code> is the exponent, <code class="docutils literal notranslate"><span class="pre">10</span></code> is the assumed base, and the radix point is assumed to sit just to the right of the rightmost digit of the significand.</p>
<p>The range of a FP representation depends on the range of integers we can store in that representation’s exponent field. The IEEE 754 standard for <em>single-precision</em> FP numbers, for example, has an 8-bit exponent field, and the exponent field in its <em>double-precision</em> encoding is 11 bits. Clearly 11 is not twice 8, and the term “double precision” comes from the rough doubling of the size of the significand field (from 23 to 52 bits). Each encoding also includes a sign bit, which indicates the sign of the significand (not the exponent), and from this you can compute that double-precision FP numbers require twice as many bits as single-precision ones in the IEEE 754 standard.</p>
<p>The range of these two representations is impressive. While the single-precision representation can’t represent the estimated number of atoms in the known universe, which somewhere between <code class="docutils literal notranslate"><span class="pre">10**78</span></code> and <code class="docutils literal notranslate"><span class="pre">10**82</span></code>, the double-precision representation with a maximum base-10 exponent of 308 easily can. You can also measure things as microscopically small as this maximum number is astronomically large.</p>
</section>
<section id="precision">
<p><strong>Precision.</strong> But what about precision? In base 10, we understand the fractional part of a real number as the group of digits to the right of the decimal point. The value of each of these digits to the total fraction is the digit multiplied by <code class="docutils literal notranslate"><span class="pre">10**-m</span></code>, where <code class="docutils literal notranslate"><span class="pre">m</span></code> is 1 for the digit immediately to the right of the decimal point, 2 for the next digit to the right, and so forth.</p>
<p>This is that expansion for the decimal fraction 0.574:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
</pre></div>
</div>
<p>Run this code block, and you’ll notice something strange. To explain, let’s move from base-10 numbers to binary (base-2) numbers because jump is where things get difficult.</p>
<p>A binary fraction can be expanded in the same way as a decimal fraction, except that we change the base from 10 to 2, and the coefficient of each term is either 0 or 1. Pulling these coefficients together creates the binary string that we’ll use as the significand. And here’s where precision comes into play: The difference between the significand we want in base-10 and the closest one we can represent in base-2 is a measure of precision in our format.</p>
<aside class="margin sidebar">
<p class="sidebar-title">Notation</p>
<p>The leading <code class="docutils literal notranslate"><span class="pre">0b</span></code> mimics the leading <code class="docutils literal notranslate"><span class="pre">0x</span></code> we saw on hexadecimal numbers. Following this prefix, we write a <code class="docutils literal notranslate"><span class="pre">0</span></code>, which indicates that there’s no whole number here, and the radix point, which always proceeds the fractional part.</p>
</aside>
</section>
<section id="illustrating-this-issue-of-precision">
<p><strong>Illustrating this issue of precision.</strong> We can get a sense for precision by writing a Python program that constructs the binary representation for a decimal fraction. Our script will prefix the answer we compute with the string <code class="docutils literal notranslate"><span class="pre">'0b0.'</span></code>, which will help us to remember that this is the binary representation of a fraction between 0 and 1.</p>
<p>Our script will expect two inputs. The first is the decimal fraction we want to represent and the second is the size in bits of our chosen FP representation’s significand. If we wanted to mimic the precision of IEEE 754 single-precision, we’d input 23. The following script gets us started.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&#39;&#39;&#39;Convert a decimal fraction into a binary string&#39;&#39;&#39;</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1"># Grab input values</span>
<span class="linenos"> 5</span><span class="n">n</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Decimal fraction to convert: &quot;</span><span class="p">))</span>
<span class="linenos"> 6</span><span class="n">bits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Size of significand in bits: &quot;</span><span class="p">))</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c1"># Error checking</span>
<span class="linenos"> 9</span><span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mf">1.</span><span class="p">:</span>
<span class="linenos">10</span>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;ValueError: target must be in the range [0., 1.)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that we have to use the Python <code class="docutils literal notranslate"><span class="pre">float</span></code> type to represent the inputted decimal fraction. The <code class="docutils literal notranslate"><span class="pre">float</span></code> function converts a string that looks like a real number into a <code class="docutils literal notranslate"><span class="pre">float</span></code>.</p>
<p>To figure out what we need to do next, let’s think about what we know at the start of our script:</p>
<aside class="margin sidebar">
<p class="sidebar-title">FP Literals</p>
<p>Notice that our error check in the script checks <code class="docutils literal notranslate"><span class="pre">n</span></code> against two FP literals. <code class="docutils literal notranslate"><span class="pre">0</span></code> is a Python integer. <code class="docutils literal notranslate"><span class="pre">0.</span></code> and <code class="docutils literal notranslate"><span class="pre">0.0</span></code> both represent zero as a FP number (and so is any number of zeros after the decimal point).</p>
</aside>
<ol class="arabic simple">
<li><p>We know that the number the user inputted is between 0 and 1, including the value of 0 and excluding the value of 1, as our error check asserts.</p></li>
<li><p>If we think about our best guess at the binary encoding of <code class="docutils literal notranslate"><span class="pre">n</span></code> given these bounds and no significand bits, we would choose 0, since we know that it can’t be 1.</p></li>
</ol>
<p>This answer isn’t precise, unless the user inputs the value <code class="docutils literal notranslate"><span class="pre">0.0</span></code>, but it’s the best guess we have with zero significand bits in our FP representation. Hey, we have started to solve our problem! Let’s write this in Python at the end of our growing script.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">12</span><span class="c1"># Initialize our bounds and our current best estimate</span>
<span class="linenos">13</span><span class="n">upper</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="linenos">14</span><span class="n">lower</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="linenos">15</span><span class="n">best</span> <span class="o">=</span> <span class="n">lower</span>  <span class="c1"># with 0 bits used, our best estimate is 0</span>
<span class="linenos">16</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</pre></div>
</div>
</section>
<section id="one-bit-at-at-time">
<p><strong>One bit at at time.</strong> What would we do next if we wanted to add one bit to our significand? Since we have no bits in our significand, that bit would be the coefficient of the first term in the expansion we discussed earlier. Do we want this coefficient to be <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code>? Well, which of these two values creates a new guess that is closer to the actual number <code class="docutils literal notranslate"><span class="pre">n</span></code> than our current guess? The one that is closer becomes our new best guess.</p>
<p>If we’re updating our best guess as we add bits to our significand, this starts to sound like we’re building a loop. As we know, loops have exit conditions, and the exit condition in this case is when the best guess is exactly <code class="docutils literal notranslate"><span class="pre">n</span></code>. If our current best guess isn’t exactly <code class="docutils literal notranslate"><span class="pre">n</span></code>, then we loop to again add new bit to the significand, which will bring us closer to the input decimal fraction. Of course, we also have to exit this loop if we run out of significand bits.</p>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>Before reading on, practice writing the pseudocode for the loop I just described. What type of loop might you use (i.e., a for- or a while-loop)? What’s the condition we’ll test that protects the break-statement in the loop?</p>
</div>
</section>
<section id="searching-for-the-smallest-difference">
<p><strong>Searching for the smallest difference.</strong> As we slowly add bits to the righthand side of the significand, we increase the precision of our binary encoding by reducing the difference between the input decimal fraction <code class="docutils literal notranslate"><span class="pre">n</span></code> and our current <code class="docutils literal notranslate"><span class="pre">best</span></code> guess, which is a binary fraction that we’ll store in <code class="docutils literal notranslate"><span class="pre">encoding</span></code>. The complete script is below.</p>
<p>I used a for-loop since we know the maximum number of bits in our significand; the loop must end at that maximum and a for-loop makes this easy to do and to understand. You could build an equivalent solution with a while-loop.</p>
<p>Inside the for-loop, I check to see if our best guess (<code class="docutils literal notranslate"><span class="pre">best</span></code>) matches <code class="docutils literal notranslate"><span class="pre">n</span></code>, and break out of the loop early if it is. Besides updating the string encoding of the significand, the loop body adjusts the bounds (i.e., <code class="docutils literal notranslate"><span class="pre">upper</span></code> and <code class="docutils literal notranslate"><span class="pre">lower</span></code>) as it updates <code class="docutils literal notranslate"><span class="pre">guess</span></code>, since every bit we add to the significand tightens one or the other of the two bounds.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap07/fbin.py</span>
<span class="linenos"> 2</span><span class="sd">&#39;&#39;&#39;Convert a decimal fraction into a binary string&#39;&#39;&#39;</span>
<span class="linenos"> 3</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="c1"># Grab input values</span>
<span class="linenos"> 6</span><span class="n">n</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Decimal fraction to convert: &quot;</span><span class="p">))</span>
<span class="linenos"> 7</span><span class="n">bits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Size of significand in bits: &quot;</span><span class="p">))</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="c1"># Error checking</span>
<span class="linenos">10</span><span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mf">1.</span><span class="p">:</span>
<span class="linenos">11</span>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;ValueError: target must be in the range [0., 1.)&quot;</span><span class="p">)</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="c1"># Initialize our bounds and our current best estimate</span>
<span class="linenos">14</span><span class="n">upper</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="linenos">15</span><span class="n">lower</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="linenos">16</span><span class="n">best</span> <span class="o">=</span> <span class="n">lower</span>  <span class="c1"># with 0 bits used, our best estimate is 0</span>
<span class="linenos">17</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bits</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos">20</span>    <span class="c1"># Our new estimate always adds a least-significant one bit to the end</span>
<span class="linenos">21</span>    <span class="c1"># of our current lower bound, i.e., move up the value below the</span>
<span class="linenos">22</span>    <span class="c1"># target number.</span>
<span class="linenos">23</span>    <span class="n">new_guess</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">**</span> <span class="o">-</span><span class="n">i</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span>    <span class="c1"># Update the correct bound, depending upon whether the new estimate</span>
<span class="linenos">26</span>    <span class="c1"># overshot the target or not.</span>
<span class="linenos">27</span>    <span class="k">if</span> <span class="n">new_guess</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
<span class="linenos">28</span>        <span class="n">lower</span> <span class="o">=</span> <span class="n">new_guess</span>
<span class="linenos">29</span>        <span class="n">encoding</span> <span class="o">+=</span> <span class="s1">&#39;1&#39;</span>
<span class="linenos">30</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">31</span>        <span class="n">upper</span> <span class="o">=</span> <span class="n">new_guess</span>
<span class="linenos">32</span>        <span class="n">encoding</span> <span class="o">+=</span> <span class="s1">&#39;0&#39;</span>
<span class="linenos">33</span>
<span class="linenos">34</span>    <span class="c1"># And now update which of these is our current best estimate</span>
<span class="linenos">35</span>    <span class="k">if</span> <span class="n">n</span> <span class="o">-</span> <span class="n">lower</span> <span class="o">&lt;</span> <span class="n">upper</span> <span class="o">-</span> <span class="n">n</span><span class="p">:</span>
<span class="linenos">36</span>        <span class="n">best</span> <span class="o">=</span> <span class="n">lower</span>
<span class="linenos">37</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">38</span>        <span class="n">best</span> <span class="o">=</span> <span class="n">upper</span>
<span class="linenos">39</span>
<span class="linenos">40</span>    <span class="k">if</span> <span class="n">best</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
<span class="linenos">41</span>        <span class="k">break</span>
<span class="linenos">42</span>
<span class="linenos">43</span>    <span class="c1"># Print how we&#39;ve done so far</span>
<span class="linenos">44</span>    <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;bit&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;bits&#39;</span>
<span class="linenos">45</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;With </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> is between </span><span class="si">{</span><span class="n">lower</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">upper</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">46</span>
<span class="linenos">47</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">With maximum </span><span class="si">{</span><span class="n">bits</span><span class="si">}</span><span class="s2"> bits of encoding for n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">,&quot;</span><span class="p">)</span>
<span class="linenos">48</span><span class="k">if</span> <span class="n">best</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
<span class="linenos">49</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  the EXACT encoding is &#39;0b0.</span><span class="si">{</span><span class="n">encoding</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<span class="linenos">50</span><span class="k">else</span><span class="p">:</span>
<span class="linenos">51</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  the closest encoding is &#39;0b0.</span><span class="si">{</span><span class="n">encoding</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<span class="linenos">52</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  which has a decimal value of </span><span class="si">{</span><span class="n">best</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Run this code block with the inputs of <code class="docutils literal notranslate"><span class="pre">0.574</span></code> and <code class="docutils literal notranslate"><span class="pre">23</span></code>, you’ll see that the encoding for the significand is <code class="docutils literal notranslate"><span class="pre">'0b0.10010010111100011010100'</span></code>, which has a decimal value of <code class="docutils literal notranslate"><span class="pre">0.5740000009536743</span></code>. That’s not <code class="docutils literal notranslate"><span class="pre">0.574</span></code>, but pretty close. The difference is the precision error.</p>
<aside class="margin sidebar">
<p class="sidebar-title">Print Rounds</p>
<p>If you set <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">0.1</span></code> and then print <code class="docutils literal notranslate"><span class="pre">n</span></code> in the interactive Python interpreter, it will tell you that <code class="docutils literal notranslate"><span class="pre">n</span></code> is <code class="docutils literal notranslate"><span class="pre">0.1</span></code>. As <a class="reference external" href="https://docs.python.org/3/tutorial/floatingpoint.html">this tutorial page</a> says, Python sometimes rounds what it prints. What it displays and what it stores may be different when dealing with FP numbers!</p>
</aside>
</section>
<section id="fp-errors-accumulate">
<p><strong>FP errors accumulate.</strong> Unfortunately, precision doesn’t just effect our ability to encode a real number as a FP number. FP operations make matters worse by accumulating the inaccuracies in representation. This is why <code class="docutils literal notranslate"><span class="pre">0.1</span> <span class="pre">*</span> <span class="pre">0.1</span></code> doesn’t equal <code class="docutils literal notranslate"><span class="pre">0.01</span></code>. A slightly inaccurate FP representation of <code class="docutils literal notranslate"><span class="pre">0.1</span></code> times itself produces a result with more inaccuracy than the conversion of <code class="docutils literal notranslate"><span class="pre">0.01</span></code> into a FP number. Or stated another way, the computer doesn’t know if you were trying to multiple <code class="docutils literal notranslate"><span class="pre">0.1</span></code> times itself or <code class="docutils literal notranslate"><span class="pre">0.10000002384185791</span></code> times itself, since single-precision FP represents both base-10 numbers with the same string of binary bits.</p>
<p>If your script operates with floating-point numbers and you need the results to be precise, you need to understand what operations you can safely perform and which you cannot. This is what textbooks and courses on numerical computing will teach you. The Wikipedia page on <a class="reference external" href="https://en.wikipedia.org/wiki/Floating-point_arithmetic#Accuracy_problemshttps://en.wikipedia.org/wiki/Floating-point_arithmetic%23Accuracy_problems">accuracy problems in floating-point arithmetic</a> can get you started on this tricky subject.</p>
<p>As if it wasn’t hard enough to write a correct program!</p>
<p>[Version 20230811]</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="chap06.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapter 6: Do You See My Dog?</p>
      </div>
    </a>
    <a class="right-next"
       href="chap08.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 8: What Is My Problem?</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#floating-point-numbers-and-numerical-computing">Floating-point numbers and numerical computing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computers-struggle-with-arithmetic">Computers struggle with arithmetic?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-range-of-a-fp-number">The range of a FP number</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#precision">Precision</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#illustrating-this-issue-of-precision">Illustrating this issue of precision</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#one-bit-at-at-time">One bit at at time</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#searching-for-the-smallest-difference">Searching for the smallest difference</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fp-errors-accumulate">FP errors accumulate</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mike Smith
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023 by Michael D. Smith. All rights reserved.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>