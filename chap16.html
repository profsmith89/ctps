

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Chapter 16: Catch Them Early &#8212; Computational Thinking and Problem Solving</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/myfile.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chap16';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Chapter 17: Build Prediction Models" href="chap17.html" />
    <link rel="prev" title="Chapter 15: Embrace Runtime Debugging" href="chap15.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="ctps.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/mike_flat.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/mike_flat.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="ctps.html">
                    <no title>
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="welcome.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap01.html">Chapter 1: Read a Children’s Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap02.html">Chapter 2: Grab the Dialogue</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap03.html">Chapter 3: Replace Text With Emoji</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap04.html">Chapter 4: Query a Web Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap05.html">Chapter 5: Play Guess-a-number with a Friend</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap06.html">Chapter 6: Do You See My Dog?</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap07.html">Chapter 7: Many Numbers But Not Any Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap08.html">Chapter 8: What Is My Problem?</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap09.html">Chapter 9: Find a Phrase</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap10.html">Chapter 10: Build an Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap11.html">Chapter 11: Discover Driving Directions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap12.html">Chapter 12: Divide and Conquer</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap13.html">Chapter 13: Rewrite the Error Messages</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap14.html">Chapter 14: The Dream of Bug Fixing</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap15.html">Chapter 15: Embrace Runtime Debugging</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapter 16: Catch Them Early</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap17.html">Chapter 17: Build Prediction Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap18.html">Chapter 18: Use Generative AI</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="ales.html">Active-Learning Exercises</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="ales-c01.html">Chapter 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c02.html">Chapter 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c03.html">Chapter 3</a></li>








<li class="toctree-l2"><a class="reference internal" href="ales-c04.html">Chapter 4</a></li>





<li class="toctree-l2"><a class="reference internal" href="ales-c05.html">Chapter 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c06.html">Chapter 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c08.html">Chapter 8</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c09.html">Chapter 9</a></li>



<li class="toctree-l2"><a class="reference internal" href="ales-c10.html">Chapter 10</a></li>


<li class="toctree-l2"><a class="reference internal" href="ales-c12.html">Chapter 12</a></li>



</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/chap16.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 16: Catch Them Early</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#divide-by-zero-bugs">Divide-by-zero bugs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-silly-coding-error">A silly coding error</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-hidden">What’s hidden</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-compile">Why compile?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-type-errors">Finding type errors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#to-squiggle-or-not">To squiggle or not</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-typing">Dynamic typing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-types-are-interesting">Why types are interesting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#types-versus-values">Types versus values</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-type-checking">Dynamic type checking</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#static-type-checking">Static type checking</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#type-hints">Type hints</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#no-free-lunch">No free lunch</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chapter-16-catch-them-early">
<h1>Chapter 16: Catch Them Early<a class="headerlink" href="#chapter-16-catch-them-early" title="Permalink to this heading">#</a></h1>
<p>A debugger helps us to understand and correct runtime errors, but to use it, you must have hit an error while running your script. If you’re lucky, the bug appears during one of your testing runs. If you’re unlucky, none of your tests exercise the execution path containing the bug, and you hit it while using your script to get some important work done. Even worse is when the bug remains hidden until one of your users hits it when they’re trying to get something done. No one likes to hear from angry users.</p>
<aside class="margin sidebar">
<p class="sidebar-title">Static</p>
<p>This term refers to any analysis performed on a program’s code when that program isn’t running.</p>
</aside>
<p>Writing test inputs that cover all the different execution paths in any non-trivial script is effectively impossible. But in Chapter 14, I mentioned that it’s possible to find some coding errors <em>without running</em> your script, which means you don’t need to construct a testing input. This approach to eliminating a whole variant of bugs from your programs involves understanding and employing <em>static analysis</em> tools. While we won’t build such a tool in this chapter, we’ll learn how they work and why they’re powerful.</p>
<div class="admonition-learning-outcomes admonition">
<p class="admonition-title">Learning Outcomes</p>
<p>Learn what it takes to find runtime bugs prior to running your scripts and why it is important to do so. You will understand the purpose of types, type checking, and how to use a type-checking tool. You’ll also learn how data abstraction makes static analyses difficult. After completing this chapter, you will be able to:</p>
<ul class="simple">
<li><p>Explain the basic operation of a static analysis tool that finds runtime errors in your script [design and CS concepts];</p></li>
<li><p>Discuss the similarities and differences between compiled and interpreted languages [CS concepts];</p></li>
<li><p>Describe the purpose of types, the difference between statically- and dynamically-typed languages, and the meaning of type errors [CS concepts and programming skills];</p></li>
<li><p>Illustrate the difference between the value and the type of an object [CS concepts and programming skills];</p></li>
<li><p>Detail the conditions under which it is important to perform static type checking and how it relates to dynamic type checking [CS concepts and programming skills];</p></li>
<li><p>Use Python type hints to aid a tool in static type checking [design and programming skills].</p></li>
</ul>
</div>
<section id="divide-by-zero-bugs">
<p><strong>Divide-by-zero bugs.</strong> Think back to the time when you were learning to divide, and you might remember that you were told to never divide a number by zero. Division by zero is mathematically undefined because allowing it would lead to <a class="reference external" href="https://en.wikipedia.org/wiki/Division_by_zero">absurd results</a>. And yet, you can write the following Python script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1">### chap16/dbzero.py</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>
<span class="linenos">4</span><span class="n">q</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">0</span>
<span class="linenos">5</span><span class="nb">print</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</pre></div>
</div>
<p>While my IDE editor will flag many types of syntax errors (i.e., by placing a red squiggly line under the offending syntax), it doesn’t indicate that there’s anything wrong in this script. However, when I ask the Python interpreter to run it, it raises a <code class="docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code> exception on line 4. This is a runtime error, but why did I have to run the script to discover it?</p>
<aside class="margin sidebar">
<p class="sidebar-title">Generative AI</p>
<p>IDEs have begun to incorporate generative AI, which can also reason about your code. When I ask the AI built into Replit to explain lines 3-4, it tells me that “… dividing a number by 0 is undefined in mathematics, and in programming, it will typically cause an error or exception because the operation is invalid. This would result in a runtime error, potentially crashing the program or causing it to stop executing.” We’ll talk more about generative AI in Chapter 18.</p>
</aside>
<p>You might think that it would be fairly straightforward to perform a string search over the script looking for instances of <code class="docutils literal notranslate"><span class="pre">'/0'</span></code>, or something like it with some flexibility in the whitespace between the characters. And with this thought, you’ve started to design a static analysis for finding divide-by-zero errors.</p>
<div class="admonition-key-idea admonition">
<p class="admonition-title">Key Idea</p>
<p>Static analysis tools reason about the execution of a script without running it on any particular input.</p>
</div>
<p>Division by the constant <code class="docutils literal notranslate"><span class="pre">0</span></code> is a fairly obvious, but how might you catch, without running it, the divide-by-zero error in the next code block?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1">### chap16/dbzero1.py</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">4</span><span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>
<span class="linenos">5</span><span class="n">q</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>
<span class="linenos">6</span><span class="nb">print</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</pre></div>
</div>
<p>After a bit of reasoning, you probably figured out that the value of <code class="docutils literal notranslate"><span class="pre">y</span></code> on line 5 must be <code class="docutils literal notranslate"><span class="pre">0</span></code> because there’s only one assignment of <code class="docutils literal notranslate"><span class="pre">y</span></code> that reaches that line and it’s the one on line 3. Like our last example, we don’t need to run <code class="docutils literal notranslate"><span class="pre">dbzero1.py</span></code> to know that it has a divide-by-zero bug. Great! You just made your static analysis a bit smarter; it’s now capable of catching more variants of this particular runtime error.</p>
<p>Let’s consider one more example with a divide-by-zero bug, which I’ve listed in the next code block. It’s different than the previous two examples in that it doesn’t raise a <code class="docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code> on every execution, but it will if the user responses with a zero.</p>
<aside class="margin sidebar">
<p class="sidebar-title">A Common Bug</p>
<p>Unlike the last two examples, this code block illustrates a divide-by-zero bug that too often occurs in real programs.</p>
</aside>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1">### chap16/dbzero2.py</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Give me a number: &#39;</span><span class="p">))</span>
<span class="linenos">4</span><span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>
<span class="linenos">5</span><span class="n">q</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>
<span class="linenos">6</span><span class="nb">print</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</pre></div>
</div>
<p>In reasoning about this script, we know two facts when we think about the script’s execution reaching line 5:</p>
<ol class="arabic simple">
<li><p>the value of <code class="docutils literal notranslate"><span class="pre">x</span></code> is the constant <code class="docutils literal notranslate"><span class="pre">42</span></code>; and</p></li>
<li><p>the value of <code class="docutils literal notranslate"><span class="pre">y</span></code> is any integer.</p></li>
</ol>
<p>Because these facts allow for the possibility of <code class="docutils literal notranslate"><span class="pre">y</span></code> to be <code class="docutils literal notranslate"><span class="pre">0</span></code>, our static analysis should report that there’s a divide-by-zero bug in this code. To eliminate this bug, the code should check the value of <code class="docutils literal notranslate"><span class="pre">y</span></code> and only allow the division to execute if the value is not zero.</p>
<p>Let’s summarize what we’ve learned from these three simple examples about the basic operation of a static analysis tool:</p>
<ul class="simple">
<li><p>We can reason about a script’s execution by considering each statement’s execution beginning with the first statement in the program.</p></li>
<li><p>As we consider each statement, we consider the facts we know about the script’s current runtime environment and update these facts given what we know about the statement’s semantics.</p></li>
<li><p>Unlike the script’s actual execution, a fact about a variable like <code class="docutils literal notranslate"><span class="pre">y</span></code> might not be a single value, but a set of possible values. This set of values allows the static analysis tool to consider all possible executions at once, which is a very powerful approach. And despite having variables whose exact value we don’t know, we can still uncover runtime errors.</p></li>
</ul>
</section>
<section id="a-silly-coding-error">
<p><strong>A silly coding error.</strong> Now that you’re warmed up, you’re ready to see if you can act like a static analysis tool and find a bug in a bigger script. The script <code class="docutils literal notranslate"><span class="pre">emdash.py</span></code> takes a paragraph of text and allows the user to indicate that they’d like to replace the commas around <a class="reference external" href="https://grammarist.com/grammar/parenthetical-phrases/">a parenthetical phrase</a> with em dashes.</p>
<p>It would, for example, take the sentence:</p>
<blockquote>
<div><p>In Chapter 16, we’ll learn that it is possible, using static analysis tools, to find some of your script’s coding errors without editing or running it.</p>
</div></blockquote>
<p>And with direction from the user, turn it into:</p>
<blockquote>
<div><p>In Chapter 16, we’ll learn that it is possible–using static analysis tools–to find some of your script’s coding errors without editing or running it.</p>
</div></blockquote>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>While I haven’t provided you with a lengthy description of how to run <code class="docutils literal notranslate"><span class="pre">emdash.py</span></code>, you don’t need it to find the bug in the code block below. To find it, you need only to understand how Python operators and methods we’ve used many time before work. Read through the script and see if you can identify the bug. If you don’t immediately see it, don’t fret. Humans are not good at this sort of detailed work. And no cheating by running the script!</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap16/emdash.py</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1"># Terminal colors</span>
<span class="linenos"> 5</span><span class="n">C_RESET</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0m&#39;</span>
<span class="linenos"> 6</span><span class="n">C_BLUE</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[34m&#39;</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos"> 9</span>    <span class="c1"># Check usage</span>
<span class="linenos">10</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
<span class="linenos">11</span>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Usage: python3 emdash.py paragraph.txt&#39;</span><span class="p">)</span>
<span class="linenos">12</span>    
<span class="linenos">13</span>    <span class="c1"># Grab the paragraph and convert any newlines into spaces</span>
<span class="linenos">14</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
<span class="linenos">15</span>        <span class="n">paragraph</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="linenos">16</span>    <span class="n">paragraph</span> <span class="o">=</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="linenos">17</span>
<span class="linenos">18</span>    <span class="c1"># Print out instructions</span>
<span class="linenos">19</span>    <span class="nb">print</span><span class="p">(</span> \
<span class="linenos">20</span><span class="sd">&quot;&quot;&quot;INSTRUCTIONS:</span>
<span class="linenos">21</span><span class="sd">Let&#39;s look at each sentence in this paragraph, and</span>
<span class="linenos">22</span><span class="sd">you tell me if you want me to surround a phrase with</span>
<span class="linenos">23</span><span class="sd">em dashes rather that the existing commas.&quot;&quot;&quot;</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span>    <span class="c1"># Iterate through each candidate sentence in text.</span>
<span class="linenos">26</span>    <span class="c1"># A sentence is a candidate only if it has three</span>
<span class="linenos">27</span>    <span class="c1"># or more phrases in it.</span>
<span class="linenos">28</span>    <span class="n">sentences</span> <span class="o">=</span> <span class="n">paragraph</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="linenos">29</span>    <span class="n">sentences</span> <span class="o">=</span> <span class="n">sentences</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># last item isn&#39;t a sentence</span>
<span class="linenos">30</span>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sentences</span><span class="p">):</span>
<span class="linenos">31</span>        <span class="c1"># Split the sentence into numbered phrases</span>
<span class="linenos">32</span>        <span class="n">phrases</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="linenos">33</span>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">phrases</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">phrases</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="linenos">34</span>            <span class="c1"># Nothing to do</span>
<span class="linenos">35</span>            <span class="k">continue</span>
<span class="linenos">36</span>
<span class="linenos">37</span>        <span class="nb">print</span><span class="p">()</span>
<span class="linenos">38</span>
<span class="linenos">39</span>        <span class="c1"># Print the phrases and ask the user</span>
<span class="linenos">40</span>        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">phrases</span><span class="p">):</span>
<span class="linenos">41</span>            <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phrases</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">42</span>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">C_BLUE</span><span class="si">}{</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">p</span><span class="si">}{</span><span class="n">C_RESET</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">43</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">44</span>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">45</span>        
<span class="linenos">46</span>        <span class="n">ans</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Which </span><span class="si">{</span><span class="n">C_BLUE</span><span class="si">}</span><span class="s1">blue</span><span class="si">{</span><span class="n">C_RESET</span><span class="si">}</span><span class="s1"> phrase, </span><span class="se">\</span>
<span class="linenos">47</span><span class="s1">if any, do you want to set off with em dashes? &#39;</span><span class="p">))</span>
<span class="linenos">48</span>        <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">49</span>            <span class="k">continue</span>     <span class="c1"># Leave the sentence alone</span>
<span class="linenos">50</span>        <span class="k">elif</span> <span class="n">ans</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">ans</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">phrases</span><span class="p">):</span>
<span class="linenos">51</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;That phrase wasn&#39;t blue...skipping on.&quot;</span><span class="p">)</span>
<span class="linenos">52</span>            <span class="k">continue</span>
<span class="linenos">53</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">54</span>            <span class="n">a</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># Turn ans into an index</span>
<span class="linenos">55</span>
<span class="linenos">56</span>        <span class="c1"># Add back the comma on the unaffected phrases while</span>
<span class="linenos">57</span>        <span class="c1"># building the sentence prefix and suffix.</span>
<span class="linenos">58</span>        <span class="n">s_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="linenos">59</span>        <span class="n">s_suffix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="linenos">60</span>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
<span class="linenos">61</span>            <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">62</span>                <span class="n">s_prefix</span> <span class="o">+=</span> <span class="n">phrases</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
<span class="linenos">63</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">64</span>                <span class="n">s_prefix</span> <span class="o">+=</span> <span class="n">phrases</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<span class="linenos">65</span>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">phrases</span><span class="p">)):</span>
<span class="linenos">66</span>            <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phrases</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">67</span>                <span class="n">s_suffix</span> <span class="o">+=</span> <span class="n">phrases</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
<span class="linenos">68</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">69</span>                <span class="n">s_suffix</span> <span class="o">+=</span> <span class="n">phrases</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<span class="linenos">70</span>
<span class="linenos">71</span>        <span class="c1"># Add the em dashes to the affected phrase and remove</span>
<span class="linenos">72</span>        <span class="c1"># the leading spaces in it and the new_suffix.</span>
<span class="linenos">73</span>        <span class="n">new_s</span> <span class="o">=</span> <span class="n">s_prefix</span> <span class="o">+</span> <span class="s1">&#39;--&#39;</span> <span class="o">+</span> <span class="n">phrases</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;--&#39;</span> <span class="o">+</span> <span class="n">s_suffix</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="linenos">74</span>
<span class="linenos">75</span>        <span class="c1"># Put the updated sentence back into the sentences list</span>
<span class="linenos">76</span>        <span class="n">sentences</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_s</span>
<span class="linenos">77</span>
<span class="linenos">78</span>    <span class="c1"># Add back the periods and print out the new paragraph</span>
<span class="linenos">79</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sentences</span><span class="p">)):</span>
<span class="linenos">80</span>        <span class="n">sentences</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;.&#39;</span>
<span class="linenos">81</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">New paragraph:&#39;</span><span class="p">)</span>
<span class="linenos">82</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sentences</span><span class="p">))</span>
<span class="linenos">83</span>
<span class="linenos">84</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">85</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="what-s-hidden">
<p><strong>What’s hidden.</strong> Before I tell you the bug in <code class="docutils literal notranslate"><span class="pre">emdash.py</span></code>, let’s identify where these kinds of static analyses would run in our problem-solving process. It’s clearly after the translation of our pseudocode into Python (Step 7), since static analyses take our Python code as input, and before the execution of the Python we’ve written (Step 8). While we could insert a new step between these two, we don’t have to. There’s already hidden work going on in the tools we use in these steps, and with some understanding of it, we’ll discover where static program analyses can naturally fit.</p>
<p>Python is an <em>interpreted</em> programming language, which means that we write scripts in an IDE’s editor, and when we’re ready to run them, we hand them to the Python interpreter. As we learned in the last chapter, at the heart of the Python interpreter is a REPL (a Read-Eval-Print-Loop), and from the scripts we’ve written, we know what it means to read a line from a file (R), print the result of the line’s evaluation (P), and loop back to start the REPL steps again (L). What I skipped in this description is the E in REPL. What’s involved in the evaluation of a line of Python?</p>
<p>In <code class="docutils literal notranslate"><span class="pre">repl32.py</span></code>, we side-stepped this question and took advantage of the <code class="docutils literal notranslate"><span class="pre">eval</span></code> function, which had the Python interpreter evaluate a given expression. That was fine because, in that case, we accomplished what we wanted by having that evaluation take place in the runtime context of the script we were debugging. The interpreter quietly took care of turning the Python expression (or equivalently a statement) into a sequence of bits.</p>
<p>What’s I’m talking about is the <em>language translation</em> that needs to occur to turn a Python script (i.e., a script written in a high-level programming language) into a file of machine instructions (i.e., a <em>binary</em>), which is a language the computer’s hardware understands. This language translation is hidden in the Python interpreter, but it doesn’t have to be. There are many programming languages that make this translation an explicit step in the development process, and they are called <em>compiled</em> languages.</p>
<p>The C programming language is one example, and we’ll look at some of its syntax in a moment. When you write a C program, you write it in an IDE editor, just like we’ve done with our Python scripts. But when you’re ready to run your C program, you first use a C compiler to translate your C file into an executable file (i.e., that binary again). You can then just type the executable’s filename as if it was a shell command, which is what we did in Chapter 13 with our <code class="docutils literal notranslate"><span class="pre">python32</span></code> tool.</p>
<p>While we skip directly from writing to running in Python, a C programmer writes, then compiles, and then runs. The following code block contains an example C program, which I’ll use to demonstrate how you can compile and run it. You may not understand all the C syntax, but you probably can guess what this program does given what you learned about Python syntax.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cm">/* chap16/fun.c */</span>
<span class="linenos"> 2</span><span class="cm">/* NOT EXECUTABLE since it C code, not Python */</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">;</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;World&quot;</span><span class="p">;</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 9</span><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;The strings are the same.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">10</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">11</span><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;The strings are different.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">12</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">13</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">14</span><span class="p">}</span>
</pre></div>
</div>
<p>The following transcript shows how to compile and execute <code class="docutils literal notranslate"><span class="pre">fun.c</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>### I ran the highlighted commands in the shell
<span class="hll">Chap16$ make -s fun
</span><span class="hll">Chap16$ ./fun
</span>The strings are different.
</pre></div>
</div>
<p>The command <code class="docutils literal notranslate"><span class="pre">make</span></code> invokes the C compiler and hides most all the complicated compilation process, which I further hid with the <code class="docutils literal notranslate"><span class="pre">-s</span></code> flag that tells <code class="docutils literal notranslate"><span class="pre">make</span></code> to be silent while it does its work. This command produces two files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fun.o</span></code>, which is the machine code for the routine we wrote. While it contains machine instructions, you can’t run it because it’s incomplete.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fun</span></code>, which is a binary that will execute when invoked as a command. It includes the binary instructions in <code class="docutils literal notranslate"><span class="pre">fun.o</span></code> and <em>the runtime system</em> that is needed for a program to run on its own. The runtime system includes items like the code for C’s builtin library. In Python, the runtime system is part of the interpreter.</p></li>
</ul>
</section>
<section id="why-compile">
<p><strong>Why compile?</strong> If compiled languages are more complicated to run than interpreted languages, why would you ever use them? There are basically three answers to this question:</p>
<ol class="arabic simple">
<li><p><strong>Historical reasons.</strong> The first computers had little memory and little compute power, and this meant that you couldn’t simultaneously run the compiler while running your program. In fact, in the earliest days of computing, you couldn’t fit the compiler in the computer with anything else.</p></li>
<li><p><strong>Performance reasons.</strong> Interpretation is comparatively slow. It allows you to quickly change your script and run bits of it, as we do in the interactive Python interpreter, but you pay for the language translation that takes place at runtime with slower program executions. In a compiled language, you compile (i.e., translate) your program once. When you go to run it, you’re just handing a bunch of machine instructions written in binary to your computer, which directly executes them. All the overhead of language translation is paid in the development process, not while the user is running your program.</p></li>
<li><p><strong>Full-program analysis reasons.</strong> This the goal of this chapter. If we want to find runtime bugs without running the program, a great time to run our static analyses is at compile time, before we ship the program to any users.</p></li>
</ol>
</section>
<section id="finding-type-errors">
<p><strong>Finding type errors.</strong> We learned that compiled languages naturally have a place for static program analysis (i.e., during language translation), but in an interpreted language like Python, language translation is hidden in the eval phase of the Python interpreter’s REPL, which takes place during program execution. Are we back to inserting a new step in our problem-solving process?</p>
<p>Luckily, no. Most IDEs editors are extensible, which means that you can load and run static analyses while you edit. These act like the spell check and grammar hints that run constantly in modern word processing applications. In an IDE editor, the syntax highlighting, pop-up help, and error and warning reporting (often indicated with squiggly underlining) that you’ve been using in your IDE’s editor are all types of static analyses. So let’s extend our IDE with a static analysis that will uncover the bug in <code class="docutils literal notranslate"><span class="pre">emdash.py</span></code>.</p>
<p>As an example of an extension, I loaded and used <a class="reference external" href="https://mypy-lang.org/">mypy</a> in the Microsoft Visual Studio Code IDE. Mypy is a <em>static type checker</em> for Python. In a moment, we’ll discuss what this means and why it helps find an important category of runtime bugs, but first, <a class="reference internal" href="#c16-fig1-ref"><span class="std std-numref">Figure 28</span></a> illustrates what we can learn from mypy.</p>
<figure class="align-default" id="c16-fig1-ref">
<img alt="_images/c16_fig1.png" src="_images/c16_fig1.png" />
<figcaption>
<p><span class="caption-number">Fig. 28 </span><span class="caption-text">Screenshot of an editor tab in Microsoft Visual Studio Code with the Mypy Type Checker extension loaded (v2023.6.0). I’ve opened the error message associated with the red squiggle on line 73.</span><a class="headerlink" href="#c16-fig1-ref" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>This tool placed a red squiggle under a part of line 73. This line builds a new sentence in which we place em dashes around the parenthetical phrase named <code class="docutils literal notranslate"><span class="pre">phrases[a]</span></code>. As you can read in the comment, the code should have removed the whitespace around this phrase and the text that came after it, which is what this tool’s specification said it should do. However, I mistakenly typed <code class="docutils literal notranslate"><span class="pre">split()</span></code> where I meant to <code class="docutils literal notranslate"><span class="pre">strip()</span></code>—twice in fact. I had invoked the <code class="docutils literal notranslate"><span class="pre">split</span></code> method several times earlier in the script, and my fingers mindlessly typed it again rather than the similar-looking <code class="docutils literal notranslate"><span class="pre">strip</span></code>.</p>
</section>
<section id="to-squiggle-or-not">
<p><strong>To squiggle or not.</strong> Knowing that I typed the wrong method name explains my error, but how did the mypy analysis know to place a red squiggle on line 73? To figure out the answer to this question, we must understand what the mypy error message is telling us. It says that the <code class="docutils literal notranslate"><span class="pre">+</span></code> operator was attempting to act upon a string object and a list object holding string objects, which is how you read <code class="docutils literal notranslate"><span class="pre">list[str]</span></code>. The literal <code class="docutils literal notranslate"><span class="pre">'--'</span></code> is clearly of type <code class="docutils literal notranslate"><span class="pre">str</span></code>, but how did mypy know the type of the object produced by <code class="docutils literal notranslate"><span class="pre">phrase[a].split()</span></code>?</p>
<p>You might say that it’s obvious, but if you did, you assumed that this line was calling <code class="docutils literal notranslate"><span class="pre">str.split</span></code>. This is true only if <code class="docutils literal notranslate"><span class="pre">phrases[a]</span></code> produces a string object, and while it is true in this script, it didn’t have to be true if we were reasoning about line 73 in isolation.</p>
<aside class="margin sidebar">
<p class="sidebar-title">Recalling the magic of magic methods</p>
<p>We defined the <code class="docutils literal notranslate"><span class="pre">__contains__</span></code> magic method in Chapter 11 so that objects of <code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">CitySqGrid</span></code> could use Python’s <code class="docutils literal notranslate"><span class="pre">in</span></code> operator as if they were built into the language. We could do the similar thing here.</p>
</aside>
<p>Python is a <em>dynamically-typed, object-oriented language</em>. As we learned in Chapter 11, we can build objects of any structure we’d like using Python’s <code class="docutils literal notranslate"><span class="pre">class</span></code> syntax. So here’s another perfectly rational way to decide the type of the object between the two + operators on line 73: <code class="docutils literal notranslate"><span class="pre">phrase</span></code> names an object whose class defines the indexing operator (i.e., the <code class="docutils literal notranslate"><span class="pre">[]</span></code> operator, which you can define using the <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> magic method). The object returned by <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> is one that defines a <code class="docutils literal notranslate"><span class="pre">split</span></code> method, and this method returns a string. This isn’t what mypy determined, but my point is that this alternate reasoning follows a perfectly valid set of assumptions given what we know about Python and what we see on line 73.</p>
<p>In summary, whether mypy decides to place a red squiggle under <code class="docutils literal notranslate"><span class="pre">phrases[a].split()</span></code> depends entirely on whether its reasoning determines that the returned object is of type <code class="docutils literal notranslate"><span class="pre">str</span></code> or <code class="docutils literal notranslate"><span class="pre">list[str]</span></code>. And what makes such reasoning hard is not the object-oriented nature of the language, but its dynamic typing.</p>
</section>
<section id="dynamic-typing">
<p><strong>Dynamic typing.</strong> In a dynamically typed language, we know a variable’s type only at runtime, or equivalently, the object’s type currently named by the variable. In Python, variables are simply names, and a name can refer to objects of different types at different points in a script. In other words, the name tells you nothing about the type of the object it names.</p>
<p>For example, consider the name <code class="docutils literal notranslate"><span class="pre">my_variable</span></code> in this code block:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1">### chap16/dyntype.py</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">choice</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Pick an object type: &#39;</span><span class="p">)</span>
<span class="linenos">4</span><span class="n">my_variable</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span>             <span class="c1"># default to str</span>
<span class="linenos">5</span><span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="s1">&#39;int&#39;</span><span class="p">:</span>
<span class="linenos">6</span>    <span class="n">my_variable</span> <span class="o">=</span> <span class="mi">65</span>          <span class="c1"># change to int</span>
<span class="linenos">7</span><span class="k">elif</span> <span class="n">choice</span> <span class="o">==</span> <span class="s1">&#39;list&#39;</span><span class="p">:</span>
<span class="linenos">8</span>    <span class="n">my_variable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">65</span><span class="p">]</span>   <span class="c1"># change to list</span>
<span class="linenos">9</span><span class="nb">print</span><span class="p">(</span><span class="n">my_variable</span><span class="p">,</span> <span class="s1">&#39;is of type&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">my_variable</span><span class="p">))</span>
</pre></div>
</div>
<p>The type of the object named <code class="docutils literal notranslate"><span class="pre">my_variable</span></code> on line 9 is not definitively known until we run the script and learn the value of <code class="docutils literal notranslate"><span class="pre">choice</span></code>. Without this runtime information, the best a static analysis can determine is that it could be of type <code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, or <code class="docutils literal notranslate"><span class="pre">list</span></code>.</p>
<div class="admonition-different-questions-similar-work admonition">
<p class="admonition-title">Different Questions, Similar Work</p>
<p>To dig a bit deeper into the structure of static analyses, notice how the reasoning we did for <code class="docutils literal notranslate"><span class="pre">my_variable</span></code> in <code class="docutils literal notranslate"><span class="pre">dyntype.py</span></code> is similar to and different from that which we did earlier with the variable <code class="docutils literal notranslate"><span class="pre">y</span></code> in <code class="docutils literal notranslate"><span class="pre">bdzero2.py</span></code>: What we asked our analysis to determine on line 9 in <code class="docutils literal notranslate"><span class="pre">dyntype.py</span></code> was the type of <code class="docutils literal notranslate"><span class="pre">my_variable</span></code>, while analyzing line 5 in <code class="docutils literal notranslate"><span class="pre">bdzero2.py</span></code> we were interested in the value of <code class="docutils literal notranslate"><span class="pre">y</span></code>. However, these two different questions didn’t change the way we performed the analysis. In both cases, we looked for statements that defined our variable of interest and then asked which of these definitions reached the line where we wanted to check for a possible runtime error. When multiple definitions reached the line, we combined the possibilities. In general, this combination work is more complicated than I’ve described, but understanding it as a set-union operation is fine for our work in this chapter.</p>
</div>
</section>
<section id="why-types-are-interesting">
<p><strong>Why types are interesting.</strong> To catch divide-by-zero errors, it was obvious that we wanted to know if a variable (or in general an expression) could be <code class="docutils literal notranslate"><span class="pre">0</span></code>, but why is knowing the type of a variable also helpful in finding snippets of code that become runtime errors? Stated simply, it’s because an object’s type tells you what operations you can legally perform on or with the object.</p>
<p>Type checking, therefore, asks if there is ever a place in our script where we’re trying to manipulate an object (i.e., data) in a manner that is:</p>
<ol class="arabic simple">
<li><p>explicitly forbidden (e.g., something equivalent to division by zero); or</p></li>
<li><p>not defined (e.g., we’ve never told the Python interpreter what it means to “add” a string literal to a list of strings).</p></li>
</ol>
<div class="admonition-key-idea admonition">
<p class="admonition-title">Key Idea</p>
<p>A <em>type</em> or more specifically a <em>data type</em> is <em>an attribute of a piece of data</em>, and this attribute tells the compiler or interpreter how it should interpret and how it can legally manipulate the data.</p>
</div>
</section>
<section id="types-versus-values">
<p><strong>Types versus values.</strong> Let’s make this attribute idea concrete. In Chapter 6, we learned that computers encode everything as numbers, which our computers store as bit patterns. In the following code block, we name the string <code class="docutils literal notranslate"><span class="pre">'A'</span></code> and the integer <code class="docutils literal notranslate"><span class="pre">65</span></code>, and then ask the Python interpreter to show us the bit representations of these two objects. It responds that both values are encoded with the bit pattern  <code class="docutils literal notranslate"><span class="pre">0b1000001</span></code>. That’s interesting, since we know that the Python interpreter has treated them differently in our scripts. We can verify this by asking the interpreter whether these two objects are equal (i.e., the same). It responds <code class="docutils literal notranslate"><span class="pre">False</span></code>, which means that they’re not.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap16/equal.py</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="n">a_letter</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span>
<span class="linenos"> 4</span><span class="n">an_int</span> <span class="o">=</span> <span class="mi">65</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="c1"># Show that their bit patterns match</span>
<span class="linenos"> 7</span><span class="n">a_in_bits</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">a_letter</span><span class="p">))</span>
<span class="linenos"> 8</span><span class="n">i_in_bits</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">an_int</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="nb">print</span><span class="p">(</span><span class="n">a_in_bits</span><span class="p">,</span> <span class="n">i_in_bits</span><span class="p">)</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Does Python think these two objects are equal? </span><span class="si">{</span><span class="n">a_letter</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">an_int</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Despite the fact that the bit patterns for the values of the objects named <code class="docutils literal notranslate"><span class="pre">a_letter</span></code> and <code class="docutils literal notranslate"><span class="pre">an_int</span></code> are exactly the same, the interpreter says that these objects are not equal. The reason that they’re not considered equal is because their types differ.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">11</span><span class="c1">### chap16/equal.py</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">a_letter</span><span class="si">}</span><span class="s1"> is of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">a_letter</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">14</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">an_int</span><span class="si">}</span><span class="s1"> is of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">an_int</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The Python interpreter considers two objects equal when:</p>
<ul class="simple">
<li><p>the bit patterns of their values are identical; and</p></li>
<li><p>they’re of the same type.</p></li>
</ul>
<p>You’ve now learned that an object’s type is an important attribute of an object, and this attribute is different than the object’s value. An object’s type informs the interpreter (and us) what operations are legal to perform on or with this object’s value.</p>
</section>
<section id="dynamic-type-checking">
<p><strong>Dynamic type checking.</strong> So where are we? We’ve learned that types are important, but because of dynamic typing, we know that the name of an object doesn’t tell us anything about its type. Yet, the Python interpreter needs to know the types of the objects in a statement when it goes to evaluate that statement. Types tell the interpreter what operations are allowed and legal, and when you try to do something that isn’t, it raises a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code>. Where does the interpreter get this necessary type information if not from the variable name?</p>
<p>The solution to this dilemma is that Python includes type information with every object it creates. We learned through <code class="docutils literal notranslate"><span class="pre">equal.py</span></code> that this information (i.e., this attribute) is kept separate from the value of each object. It is additional overhead (i.e., it causes an object to take up additional space in our computer’s memory), but because of this overhead, the interpreter can perform <em>dynamic type checking</em> (i.e., type checking at runtime). Now you understand how the interpreter is able to raise a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> when executing line 73 in <code class="docutils literal notranslate"><span class="pre">emdash.py</span></code>.</p>
</section>
<section id="static-type-checking">
<p><strong>Static type checking.</strong> And yet, we want to build <em>static</em> analyses that discover the <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> on line 73 in <code class="docutils literal notranslate"><span class="pre">emdash.py</span></code> without having to run it. One way to provide a static analysis with the type information it needs is to attach the type information not to a program’s objects but to its variable names. This is, in fact, what happens in the C programming language. Here is <code class="docutils literal notranslate"><span class="pre">equal.py</span></code> rewritten as a C program:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cm">/* chap16/equal.c */</span>
<span class="linenos"> 2</span><span class="cm">/* NOT EXECUTABLE since it C code, not Python */</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">a_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">;</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">an_int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">65</span><span class="p">;</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Does C think these two objects are equal? %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a_string</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">an_int</span><span class="p">);</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">12</span><span class="p">}</span>
</pre></div>
</div>
<aside class="margin sidebar">
<p class="sidebar-title">Statement Delimiters</p>
<p>In Python, a newline character marks the end of a statement. In C, you must use a semicolon to mark the end of a statement, i.e., newlines are treated as meaningless whitespace in C.</p>
</aside>
<p>Notice that the assignments on lines 6 and 7 not only <em>initialize</em> the value of these two variables, but they also <em>declare</em> the type of each: <code class="docutils literal notranslate"><span class="pre">a_string</span></code> is declared to be of type <code class="docutils literal notranslate"><span class="pre">char</span></code>, which stands for character; and <code class="docutils literal notranslate"><span class="pre">an_int</span></code> is declared to be of type <code class="docutils literal notranslate"><span class="pre">int</span></code>. In other words, the type of every variable in a C program is known at compile time because every variable has its type explicitly declared.</p>
<p>The program <code class="docutils literal notranslate"><span class="pre">equal2.c</span></code> separates the variables’ declarations from their initializations to make this clearer. This helps illustrate the two things you should know about declarations in a language like C:</p>
<ol class="arabic simple">
<li><p>Declarations of a variable must come before any use of that variable.</p></li>
<li><p>Declarations have no runtime behavior; they are only information for the C compiler.</p></li>
</ol>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cm">/* chap16/equal2.c */</span>
<span class="linenos"> 2</span><span class="cm">/* NOT EXECUTABLE since it C code, not Python */</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="cm">/* declaration of two variables of different types */</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">a_string</span><span class="p">;</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">an_int</span><span class="p">;</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="w">    </span><span class="cm">/* initialization of the values of these variables */</span>
<span class="linenos">11</span><span class="w">    </span><span class="n">a_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">;</span>
<span class="linenos">12</span><span class="w">    </span><span class="n">an_int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">65</span><span class="p">;</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Does C think these two objects are equal? %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a_string</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">an_int</span><span class="p">);</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">17</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>You can copy the C programs in this chapter into a Replit C project and run them for yourself. Try this with <code class="docutils literal notranslate"><span class="pre">equal.c</span></code> or <code class="docutils literal notranslate"><span class="pre">equal2.c</span></code>. When the program answers the question about the equality of <code class="docutils literal notranslate"><span class="pre">a_string</span></code> and <code class="docutils literal notranslate"><span class="pre">an_int</span></code>, an answer of <code class="docutils literal notranslate"><span class="pre">0</span></code> means <code class="docutils literal notranslate"><span class="pre">False</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code> means <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>Are you surprised at the answer? To resolve this surprise:</p>
<ul class="simple">
<li><p>Think about the bit patterns and the fact that that’s all that is compared in C at runtime. The type information is used at compile time and then discarded. The print-statement in these two programs really should say, “Does C think these two <em>values</em> are equal?”</p></li>
<li><p>Think about what this tells you about the two types, <code class="docutils literal notranslate"><span class="pre">char</span></code> and <code class="docutils literal notranslate"><span class="pre">int</span></code>, if the C compiler’s static type check succeeded for the expression <code class="docutils literal notranslate"><span class="pre">a_string</span> <span class="pre">==</span> <span class="pre">an_int</span></code>).<a class="footnote-reference brackets" href="#fn1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p></li>
</ul>
</div>
</section>
<section id="type-hints">
<p><strong>Type hints.</strong> We are finally ready to understand how mypy operates and what we (as programmers) need to add into our scripts to enable it to do static type checking. As I mentioned earlier, dynamic typing is what makes static type checking hard. We need to know object types in order to do type checking, and that means we have to jettison Python’s dynamic-typing nature.</p>
<p>Perhaps you were a careful reader and noticed that the file open in <a class="reference internal" href="#c16-fig1-ref"><span class="std std-numref">Figure 28</span></a> is not <code class="docutils literal notranslate"><span class="pre">emdash.py</span></code>, but <code class="docutils literal notranslate"><span class="pre">emdash-anno.py</span></code>. Furthermore, line 73 starts with:</p>
<p><code class="docutils literal notranslate"><span class="pre">new_s:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">...</span></code></p>
<p>rather than</p>
<p><code class="docutils literal notranslate"><span class="pre">new_s</span> <span class="pre">=</span> <span class="pre">...</span></code></p>
<p>This change is just different syntax for the variable declarations we saw in C (i.e., <code class="docutils literal notranslate"><span class="pre">new_s:</span> <span class="pre">str</span></code> declares that any objects named <code class="docutils literal notranslate"><span class="pre">new_s</span></code> are expected to be of type <code class="docutils literal notranslate"><span class="pre">str</span></code>). In Python, these are called a <em>type hints</em>. They’re hints because they’re not necessary for the functioning of the script (i.e., the Python interpreter still performs dynamic type checking and you’re free to ignore the mypy error messages). You can think of these type hints as acting like comments, but unlike a typical comment, they’re meant not only for humans, but also for static type checkers like mypy.</p>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>Read the <a class="reference external" href="https://peps.python.org/pep-0484/">Python Enhancement Proposal (PEP) 484</a> to learn much more about type hints, and then take a look at <code class="docutils literal notranslate"><span class="pre">emdash-anno.py</span></code> to see how I used them to help the mypy with static type checking.</p>
</div>
</section>
<section id="no-free-lunch">
<p><strong>No free lunch.</strong> Adding type hints does require us to be more explicit about what we’re doing when we code (e.g., we need to decide and state that a name will only ever hold objects of the declared type), but the benefit is that we can build tools that help us identify where in our code we violate those declarations, which may help us find many subtle bugs that would otherwise require numerous test inputs and extensive testing time. When the code we write doesn’t take full advantage of dynamic typing, and <code class="docutils literal notranslate"><span class="pre">emdash.py</span></code> is one of them since none of its names ever hold more than one type of object, this is a small cost to pay for the huge benefits of static type checking. However, when we do exploit the benefits of dynamic typing, type hints come with a real cost.</p>
<p>Do you remember the function <code class="docutils literal notranslate"><span class="pre">my_replace</span></code> from Chapter 3?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap03/bookshelf1.py</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">def</span> <span class="nf">my_replace</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a string replacing all occurrences of old with new.&quot;&quot;&quot;</span>
<span class="linenos"> 5</span>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>           <span class="c1"># tracks where we are in the input string</span>
<span class="linenos"> 6</span>    <span class="n">j</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>    <span class="c1"># skip-ahead amount for index calculations</span>
<span class="linenos"> 7</span>    <span class="n">new_s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># the new string we&#39;re building</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="linenos">10</span>        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">old</span><span class="p">:</span>
<span class="linenos">11</span>            <span class="n">new_s</span> <span class="o">=</span> <span class="n">new_s</span> <span class="o">+</span> <span class="n">new</span>
<span class="linenos">12</span>            <span class="n">i</span> <span class="o">+=</span> <span class="n">j</span>
<span class="linenos">13</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">14</span>            <span class="n">new_s</span> <span class="o">=</span> <span class="n">new_s</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">15</span>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">16</span>
<span class="linenos">17</span>    <span class="k">return</span> <span class="n">new_s</span>
<span class="linenos">18</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos">21</span>    <span class="c1"># Create a string object with a line from The Cat in the Hat</span>
<span class="linenos">22</span>    <span class="n">the_line</span> <span class="o">=</span> <span class="s1">&#39;The Cat in the Hat!&#39;</span>
<span class="linenos">23</span>    <span class="nb">print</span><span class="p">(</span><span class="n">the_line</span><span class="p">)</span>
<span class="linenos">24</span>    <span class="n">the_line</span> <span class="o">=</span> <span class="n">my_replace</span><span class="p">(</span><span class="n">the_line</span><span class="p">,</span> <span class="s1">&#39;Hat&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\N{top hat}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">25</span>    <span class="nb">print</span><span class="p">(</span><span class="n">the_line</span><span class="p">)</span>
<span class="linenos">26</span>
<span class="linenos">27</span>    <span class="c1"># Create a representation of the objects on my shelf</span>
<span class="linenos">28</span>    <span class="n">stuffed_lion</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\N{lion face}</span><span class="s1">&#39;</span>
<span class="linenos">29</span>    <span class="n">kids_pic</span> <span class="o">=</span> <span class="s1">&#39;kids.jpg&#39;</span>
<span class="linenos">30</span>    <span class="n">textbook</span> <span class="o">=</span> <span class="s1">&#39;cs32.scriv&#39;</span>
<span class="linenos">31</span>    <span class="n">favorite_cd</span> <span class="o">=</span> <span class="s1">&#39;BornToRun.mp3&#39;</span>
<span class="linenos">32</span>    <span class="n">novel</span> <span class="o">=</span> <span class="s1">&#39;CatInTheHat.txt&#39;</span>
<span class="linenos">33</span>
<span class="linenos">34</span>    <span class="c1"># Create a sequence object that represents my shelf</span>
<span class="linenos">35</span>    <span class="n">shelf</span> <span class="o">=</span> <span class="p">[</span><span class="n">stuffed_lion</span><span class="p">,</span> <span class="n">kids_pic</span><span class="p">,</span> <span class="n">textbook</span><span class="p">,</span> <span class="n">favorite_cd</span><span class="p">,</span> <span class="n">novel</span><span class="p">]</span>
<span class="linenos">36</span>    <span class="nb">print</span><span class="p">(</span><span class="n">shelf</span><span class="p">)</span>
<span class="linenos">37</span>
<span class="linenos">38</span>    <span class="c1"># Make it look like our textbook has been opened on my shelf</span>
<span class="linenos">39</span>    <span class="n">shelf</span> <span class="o">=</span> <span class="n">my_replace</span><span class="p">(</span><span class="n">shelf</span><span class="p">,</span> <span class="p">[</span><span class="n">textbook</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\N{open book}</span><span class="s1">&#39;</span><span class="p">])</span>
<span class="linenos">40</span>    <span class="nb">print</span><span class="p">(</span><span class="n">shelf</span><span class="p">)</span>
<span class="linenos">41</span>
<span class="linenos">42</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">43</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>What type annotations should we use for the formal parameters of <code class="docutils literal notranslate"><span class="pre">my_replace</span></code>? We can’t use either <code class="docutils literal notranslate"><span class="pre">str</span></code> or <code class="docutils literal notranslate"><span class="pre">list</span></code> because this routine is supposed to work with any sequence that defines the length, slicing, and concatenation operators (i.e., the magic methods <code class="docutils literal notranslate"><span class="pre">__len__</span></code>, <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>, and <code class="docutils literal notranslate"><span class="pre">__add__</span></code>). Well, perhaps we might declare these parameters as of type <code class="docutils literal notranslate"><span class="pre">Sequence</span></code>, whose definition you can import from the <code class="docutils literal notranslate"><span class="pre">typing</span></code> module, as I illustrate in <code class="docutils literal notranslate"><span class="pre">bookshelf1-anno.py</span></code>. Unfortunately, this doesn’t work. Mypy will mark expressions like <code class="docutils literal notranslate"><span class="pre">new_s</span> <span class="pre">+</span> <span class="pre">new</span></code> as an error because not all sequence types in Python support concatenation. That was a design choice in the Python language, and it means that we’re left with no type that’s right for the data abstraction we built in <code class="docutils literal notranslate"><span class="pre">my_replace</span></code>. We either have to: (1) eliminate this abstraction from our code base (and consider every error message from mypy a true error); or (2) keep <code class="docutils literal notranslate"><span class="pre">my_replace</span></code> and decide that we’re going to ignore some of the “errors” flagged by mypy.</p>
<p>While things do get complicated, the main point is that tools exist that can help you to find the bugs that creep into your scripts, and static tools have the amazing power to look for errors in all the possible runs of your script without the need for test inputs. Unfortunately, while powerful and useful, all such tools do have their limitations. Take the time to learn the capabilities of each individual tool and be cognizant of their limitations (or how they put limitations on your coding). If you do, you’ll be able to more easily ring the bugs out of your scripts and more quickly solve the problems that matter to you.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>As Python programmer working in a dynamically-typed language, you can benefit from a tool that performs static type checking. When writing in other programming languages, you’ll want to know how the features of that language provide you with advantages that often are simultaneously a vehicle for common runtime errors. For example, C is often described as a high-level language that allows programmers to operate close to the machine’s hardware. It allows you to manipulate your computer’s memory in ways you cannot in Python, but it also requires you to manage your program’s dynamically allocated memory. C programmers, therefore, would want to invest in a tool that detects memory leaks and memory addressing errors. Python programmers wouldn’t ever use such a tool since memory management is handled completely by the language runtime.</p>
</div>
<p>[Version 20231214]</p>
<hr class="footnotes docutils" />
<aside class="footnote brackets" id="fn1" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Because the type check succeeds, you know that values of type `char` are also values of type `int`. In fact, if you go on to study C, you’ll learn that characters are just 8-bit integers.</p>
</aside>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="chap15.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapter 15: Embrace Runtime Debugging</p>
      </div>
    </a>
    <a class="right-next"
       href="chap17.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 17: Build Prediction Models</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#divide-by-zero-bugs">Divide-by-zero bugs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-silly-coding-error">A silly coding error</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-hidden">What’s hidden</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-compile">Why compile?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-type-errors">Finding type errors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#to-squiggle-or-not">To squiggle or not</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-typing">Dynamic typing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-types-are-interesting">Why types are interesting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#types-versus-values">Types versus values</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-type-checking">Dynamic type checking</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#static-type-checking">Static type checking</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#type-hints">Type hints</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#no-free-lunch">No free lunch</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mike Smith
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023 by Michael D. Smith. All rights reserved.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>