

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Chapter 2: Grab the Dialogue &#8212; Computational Thinking and Problem Solving</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/myfile.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chap02';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Chapter 3: Replace Text With Emoji" href="chap03.html" />
    <link rel="prev" title="Chapter 1: Read a Children’s Book" href="chap01.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="ctps.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/mike_flat.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/mike_flat.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="ctps.html">
                    <no title>
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="welcome.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap01.html">Chapter 1: Read a Children’s Book</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapter 2: Grab the Dialogue</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap03.html">Chapter 3: Replace Text With Emoji</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap04.html">Chapter 4: Query a Web Resource</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap05.html">Chapter 5: Play Guess-a-number</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap06.html">Chapter 6: Do You See My Dog?</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap07.html">Chapter 7: Many But Not Any Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap08.html">Chapter 8: What Is My Problem?</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap09.html">Chapter 9: Find a Phrase</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap10.html">Chapter 10: Build an Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap11.html">Chapter 11: Discover Driving Directions</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap12.html">Chapter 12: Divide and Conquer</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap13.html">Chapter 13: Rewrite the Error Message</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap14.html">Chapter 14: The Dream of Bug Fixing</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap15.html">Chapter 15: Embrace Runtime Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap16.html">Chapter 16: Catch Them Early</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap17.html">Chapter 17: Build Prediction Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap18.html">Chapter 18: Use Generative AI</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="ales.html">Active-Learning Exercises</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="ales-c01.html">Chapter 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c02.html">Chapter 2</a></li>







<li class="toctree-l2"><a class="reference internal" href="ales-c03.html">Chapter 3</a></li>








<li class="toctree-l2"><a class="reference internal" href="ales-c04.html">Chapter 4</a></li>





<li class="toctree-l2"><a class="reference internal" href="ales-c05.html">Chapter 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c06.html">Chapter 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c07.html">Chapter 7</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c08.html">Chapter 8</a></li>
<li class="toctree-l2"><a class="reference internal" href="ales-c09.html">Chapter 9</a></li>



<li class="toctree-l2"><a class="reference internal" href="ales-c10.html">Chapter 10</a></li>


<li class="toctree-l2"><a class="reference internal" href="ales-c12.html">Chapter 12</a></li>



</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/chap02.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 2: Grab the Dialogue</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-the-current-task">What is the current task?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-new-problem">A new problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#splitting-the-problem-into-small-pieces">Splitting the problem into small pieces</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reuse">Reuse</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#switching-between-goals">Switching between goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-state-machines">Finite State Machines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#error-handling-in-fsms">Error handling in FSMs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#encoding-the-state-information">Encoding the state information</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#this-or-that">This or that</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#work-on-a-state">Work on a state</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#strings-as-a-sequence-of-characters">Strings as a sequence of characters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#membership-test">Membership test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coding-a-transition">Coding a transition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#indexing-and-slicing">Indexing and slicing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#for-loops">For-loops</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#string-find">String find</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design-patterns-for-error-handling">Design patterns for error handling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#never-go-too-long-without-testing">Never go too long without testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concatenation-overloading-and-shorthands">Concatenation, overloading, and shorthands</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#off-by-one-and-other-potential-errors">Off-by-one and other potential errors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beware-of-hidden-assumptions">Beware of hidden assumptions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#function-composition">Function composition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstraction-as-information-hiding">Abstraction as information hiding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#there-is-no-character">There is no character</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chapter-2-grab-the-dialogue">
<h1>Chapter 2: Grab the Dialogue<a class="headerlink" href="#chapter-2-grab-the-dialogue" title="Permalink to this heading">#</a></h1>
<p>Did you try running other text files through the script we developed together in the last chapter? If you haven’t, please try. Curiosity and experimentation are attitudes to nurture for they will make you a better problem solver.</p>
<p>Trying this will also solidify in your mind the difference between: (1) solving a particular instance of a problem; and (2) the construction of a script that solves many similar problems. Recall that the last chapter started with the goal of reading a <em>particular</em> book, but partway through the design we adopted a change (which made our script independent of the input book’s length) and then added a Python <code class="docutils literal notranslate"><span class="pre">input</span></code> statement (which asked the user for the book they wanted read). This created a <em>general</em> solution that could read <em>any</em> book of <em>any</em> length.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>There is real art in writing a script that solves a general problem. Throughout this book, we will write scripts that solve more than a single instance of a problem, and this will give you a good feel for the kinds of generality you can add to your scripts. On the other hand, you should not attempt to extend a script with every new “feature” you can imagine. Computer programs, as you have undoubtedly experienced in your life, can become large, buggy, and hard to use as they grow more “featuresome.” Do what seems reasonable and think critically about every feature you include.</p>
</div>
<p>Writing scripts that are useful in a range of situations is what computer scientists strive to do. Under this approach, <em>the solution to our problem is not just the output of our script, but also the script itself</em>. You run the script, feed it the input appropriate for your current instance of the problem, and voilà, the computer follows the script and computes the desired answer.</p>
<section id="what-is-the-current-task">
<p><strong>What is the current task?</strong> In this chapter, we’ll again begin with a script that solves a simple instance of a problem and then expand it to solve a general problem. But there will be a new twist. Instead of having a loop perform a single task (e.g., reading and printing each line in an input file as we did in the last chapter), you’ll learn how to write a loop body that <em>switches between tasks</em> as it executes. We’ll use if-statements to control which statements in a loop’s body we want executed on each iteration, but more importantly, we’ll create and update some <em>program state</em> that helps the script succinctly keep track of its current task.</p>
<div class="tip admonition">
<p class="admonition-title">Terminology</p>
<p>In general, <em>program state</em> is the set of all values known at a particular instant in a script’s execution. As an example of one piece of program state, consider the value of <code class="docutils literal notranslate"><span class="pre">the_line</span></code> after the first iteration of the while-loop from Chapter 1’s <code class="docutils literal notranslate"><span class="pre">seuss.py</span></code> script. This piece of state changes on each loop iteration.</p>
</div>
<p>To solve this chapter’s problem, our script will not only maintain state directly involved in producing its output, but we’ll also have it create and manipulate additional information that the script uses to determine what it should be doing at each instant in its execution. You can think of this like a reminder note. As a busy person who frequently forgets why I walked into a room, I should more frequently make such notes!</p>
<div class="admonition-learning-outcomes admonition">
<p class="admonition-title">Learning Outcomes</p>
<p>In this chapter, you will experience all eight steps in our problem-solving process, and by the end of it, you will be able to:</p>
<ul class="simple">
<li><p>Describe the importance of recognizing similarities and differences between problems when considering which past scripts might help you start writing a new script [design];</p></li>
<li><p>Use finite-state-machine (FSM) diagrams as a widely-useful method for identifying and ordering the tasks your script must perform while processing its input [design and CS concepts];</p></li>
<li><p>Convert FSM diagrams into pseudocode [design];</p></li>
<li><p>Think about strings as a sequence (i.e., an ordered collection of characters), understand the power of this sequence abstraction, and use several common operations on sequences [CS concepts and programming skills];</p></li>
<li><p>Perform string concatenation and understand operator overloading [CS concepts and programming skills];</p></li>
<li><p>Write for-loops that iterate over the items in a sequence [programming skills];</p></li>
<li><p>Become comfortable with all variations of if-statements [programming skills];</p></li>
<li><p>Develop test inputs, and recognize and employ a common design pattern for error handling [programming skills];</p></li>
<li><p>Explain off-by-one errors and recognize where this type of error often occur [CS concepts and programming skills];</p></li>
<li><p>Structure your script development so that you interleave testing and coding, to surface hidden assumptions and never go too long without an understanding of what works and doesn’t [design and programming skills];</p></li>
<li><p>Interpret the two ways of performing function composition in Python [programming skills].</p></li>
</ul>
</div>
</section>
<section id="a-new-problem">
<p><strong>A new problem.</strong> While Chapter 1 and some of its active-learning exercises (ALEs) had us decorate a story around its edges, our new problem-to-be-solved asks that we make the textual output of our script look quite different than its input. In particular, we’ll turn <code class="docutils literal notranslate"><span class="pre">CatInTheHat.txt</span></code> into a theatrical script that a couple of actors — playing the narrator, the Cat, the Fish, Things One and Two, and the Mother — could perform.<a class="footnote-reference brackets" href="#fn1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
<p>What would be the problem specification? It could be something as seemingly simple as: <em>find the dialogue in the story and print it after the name of the character who says it</em>.</p>
</section>
<section id="splitting-the-problem-into-small-pieces">
<p><strong>Splitting the problem into small pieces.</strong> One of the keys to successfully writing a computational script is to break a large problem into small pieces and then write code to solve each of those pieces. Later, you can pull the pieces together in order to create the script that meets the entire specification.</p>
<p>What are the primary pieces in our problem specification? Well, we have to:</p>
<ol class="arabic simple">
<li><p>find a story’s dialogue;</p></li>
<li><p>identify which character says which lines; and</p></li>
<li><p>ideally transform some of the story into stage directions around this dialogue.</p></li>
</ol>
<p>Of these three things, let’s focus on finding the dialogue. Since each line of dialogue is enclosed in easily identifiable double quotes, we can precisely specify what we need to do. As incomplete solutions for the other two problem pieces, we will label the extracted dialogue with “ACTOR:” and skip adding any stage directions.<a class="footnote-reference brackets" href="#fn2" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p>
<p>With these decisions, <a class="reference internal" href="#c02-fig1-ref"><span class="std std-numref">Figure 5</span></a> shows how our script should print the first two pieces of dialogue from <code class="docutils literal notranslate"><span class="pre">CatInTheHat.txt</span></code>.</p>
<figure class="align-default" id="c02-fig1-ref">
<img alt="_images/c02_fig1.png" src="_images/c02_fig1.png" />
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">The start of our script’s output given <code class="docutils literal notranslate"><span class="pre">CatInTheHat.txt</span></code> as the its input.</span><a class="headerlink" href="#c02-fig1-ref" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="reuse">
<p><strong>Reuse.</strong> We just practiced the first four steps of our problem-solving process: specify-imagine-decompose-decide. Step 5 asks if we can jumpstart the writing of our script by reusing anything from a previously written script. To do this well, we have to think about the <em>similarities and differences</em> between our previous problems and this current problem.</p>
<p>Let’s begin with a slightly more robust version<a class="footnote-reference brackets" href="#fn3" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> of our final <code class="docutils literal notranslate"><span class="pre">seuss.py</span></code> script from Chapter 1:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap02/read32.py</span>
<span class="linenos"> 2</span><span class="n">my_book</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;What book would you like to read? &#39;</span><span class="p">)</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;txts/&#39;</span> <span class="o">+</span> <span class="n">my_book</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_open_book</span><span class="p">:</span>
<span class="linenos"> 5</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 6</span>        <span class="n">the_line</span> <span class="o">=</span> <span class="n">my_open_book</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="linenos"> 7</span>        <span class="nb">print</span><span class="p">(</span><span class="n">the_line</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>        <span class="c1"># Check for EOF</span>
<span class="linenos">10</span>        <span class="k">if</span> <span class="n">the_line</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
<span class="linenos">11</span>            <span class="k">break</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The End.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This code queries the user for a book, opens the book, names the open-file object <code class="docutils literal notranslate"><span class="pre">my_open_book</span></code>, loops reading and printing each line from this object, closes the open file when the interpreter leaves the statements indented under the with-as-statement, and finally prints “The End.” Will we need to do similar work in our current problem? Yes. If we are going to find each piece of dialogue in a story, we’ll need to read each line in it. Let’s then keep this script’s first five lines. Of course, we will also need to know when we’ve reached the end of the story and to close the open file, which the if-statement and with-as-statement do for us. Overall, we just need to adjust the <code class="docutils literal notranslate"><span class="pre">input</span></code> prompt and then delete the printing of <code class="docutils literal notranslate"><span class="pre">the_line</span></code>, since our new problem’s output is different. After doing all this, we’re left with the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap02/script1.py</span>
<span class="linenos"> 2</span><span class="n">my_book</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;What book would you like as a script? &#39;</span><span class="p">)</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;txts/&#39;</span> <span class="o">+</span> <span class="n">my_book</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_open_book</span><span class="p">:</span>
<span class="linenos"> 5</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 6</span>        <span class="n">the_line</span> <span class="o">=</span> <span class="n">my_open_book</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="linenos"> 7</span>        
<span class="linenos"> 8</span>        <span class="c1"># Check for EOF</span>
<span class="linenos"> 9</span>        <span class="k">if</span> <span class="n">the_line</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
<span class="linenos">10</span>            <span class="k">break</span>
<span class="linenos">11</span>
<span class="linenos">12</span>        <span class="c1"># new pseudocode goes here</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The End.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="switching-between-goals">
<p><strong>Switching between goals.</strong> I put a comment where we’ll place our new pseudocode—at the bottom of the while-loop body—because we need to do something with <code class="docutils literal notranslate"><span class="pre">the_line</span></code> before we loop back. One way to figure out what we want this pseudocode to do is to think about what our script should be doing when it first starts reading the story. In other words, what is our script’s initial goal?</p>
<p>As the script begins, our initial goal is to find the start of the first piece of dialogue. Once found, our script switches to a new goal: scan to the dialogue’s end and print out what was scanned.</p>
<p>What happens then? We begin again searching to find the start of the next piece of dialogue, and the pattern repeats until the story ends.</p>
</section>
<section id="finite-state-machines">
<p><strong>Finite State Machines.</strong> What we just described is formally called a <em>finite state machine (FSM)</em>. Each <em>state</em> in this FSM describes some work we need done. In switching states, our script looks for <em>events</em>. The script starts in some <em>initial</em> (or <em>start</em>) state and completes its work when it enters one of possibly several <em>final</em> (or <em>end</em>) states.</p>
<p><a class="reference internal" href="#c02-fig2-ref"><span class="std std-numref">Figure 6</span></a> is a diagram of a FSM that solves our problem, where the states are represented as labeled circles (also called <em>nodes</em>) and <em>transitions between states</em> as directed arrows. Each arrow is labeled with the event that causes the transition. The initial state is identified by the special transition labeled <code class="docutils literal notranslate"><span class="pre">Start</span></code>.</p>
<figure class="align-default" id="c02-fig2-ref">
<img alt="_images/c02_fig2.png" src="_images/c02_fig2.png" />
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">A complete FSM diagram for finding dialogue.</span><a class="headerlink" href="#c02-fig2-ref" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Let’s take a moment and make sure we understand this diagram for it will be the template we use to write our script. The script needs to find each line of dialogue in our input file, and we know that dialogue is surrounded by double quotes. As indicated by the start arrow, our script begins in a state <code class="docutils literal notranslate"><span class="pre">S0</span></code>, which specifies that it should be searching the line it read for a double-quote character. If the line doesn’t contain a double-quote character, it should just move to the next line in the story. When the script finds a double-quote character, it has found the start of a line of dialogue, and this event causes a transition to the state labeled <code class="docutils literal notranslate"><span class="pre">S1</span></code>.</p>
<p>State <code class="docutils literal notranslate"><span class="pre">S1</span></code> has our script do a different task: it collects the characters after the double quote, which it will later print as a piece of dialogue. The script continues to read lines and collect characters until it finds the next double-quote character in the story. This character indicates the end of the current piece of dialogue, and this event causes another state transition.</p>
<p>The transition out of state <code class="docutils literal notranslate"><span class="pre">S1</span></code> takes us back to <code class="docutils literal notranslate"><span class="pre">S0</span></code>, since the script’s task is to again search for the start of a piece of dialogue. Our script will keep ping-ponging back and forth between these two states, collecting and printing dialogue, until what happens? Is there any other event to which our script should react?</p>
<p>Yes! Our input story eventually ends (i.e., our script hits the EOF). <a class="reference internal" href="#c02-fig2-ref"><span class="std std-numref">Figure 6</span></a> shows that we expect this event to happen while the script is in state <code class="docutils literal notranslate"><span class="pre">S0</span></code>. Why? What assumption are we making about the input story when this event is a transition from <code class="docutils literal notranslate"><span class="pre">S0</span></code> to the FSM’s designated final state, which is labeled <code class="docutils literal notranslate"><span class="pre">DONE</span></code>?</p>
<p>While you think about this, I’ll tell you that the FSM in <a class="reference internal" href="#c02-fig2-ref"><span class="std std-numref">Figure 6</span></a> is what is formally called a <em>deterministic finite state machine</em>. By deterministic, we mean that there is at most a single transition out of a state for each possible event. State <code class="docutils literal notranslate"><span class="pre">S1</span></code> has two transitions out, but they are labeled with different events. There are also <em>nondeterministic</em> FSMs, and these allow a single event to label multiple transitions out of a state. You’ll encounter them if you continue to study computer science.<a class="footnote-reference brackets" href="#fn4" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a></p>
</section>
<section id="error-handling-in-fsms">
<p><strong>Error handling in FSMs.</strong> Hopefully by now you have realized that the FSM in <a class="reference internal" href="#c02-fig2-ref"><span class="std std-numref">Figure 6</span></a> assumes that the input story is <em>well-formed</em>, and by this I mean that every piece of dialogue in it starts and ends with a double-quote character. The FSM doesn’t have a transition from <code class="docutils literal notranslate"><span class="pre">S1</span></code> on <code class="docutils literal notranslate"><span class="pre">EOF</span></code> because we don’t expect our story to end while we are in the middle of a line of dialogue.</p>
<p>But what if our script is given an input story that isn’t well-formed? We might want our script to react in some predictable manner. We could think about solving this particular issue in the context of our particular FSM, but try for a moment to think about <em>any unexpected condition in any FSM</em>.</p>
<p>The key to doing this is to realize that we can summarize the set of directed arrows in our FSM with a function (technically called a <em>transition function</em>) that maps states and input events to states (i.e., given the current state and an input event, this function returns the next state). For example, a transition function <code class="docutils literal notranslate"><span class="pre">f</span></code> for our FSM would return <code class="docutils literal notranslate"><span class="pre">S1</span></code> when called with <code class="docutils literal notranslate"><span class="pre">f(S0,'&quot;')</span></code>.</p>
<p>Using this formulation, an unexpected condition corresponds to a state-event pair for which the transition function is not defined, e.g., <code class="docutils literal notranslate"><span class="pre">f(S1,EOF)</span></code> in our example. If we want a FSM to react predictably to such a pair, we need to define the transition function’s behavior. A straightforward solution is to create a new state, which signifies that an unexpected condition (or an error) has occurred, and make it the output of the transition function on that input pair.</p>
<p>We have only dipped our toes into the deep topic of FSMs. You will find that they are a great representation for modeling lots of mechanical, biological, and linguistic systems. But enough about the representation, let’s use the diagram we’ve drawn to help us think about the code we want to write.</p>
</section>
<section id="encoding-the-state-information">
<p><strong>Encoding the state information.</strong> When implementing the FSM in <a class="reference internal" href="#c02-fig2-ref"><span class="std std-numref">Figure 6</span></a>, the first thing to note is that it contains only three states, where the third state (<code class="docutils literal notranslate"><span class="pre">DONE</span></code>) represents the termination of our script. This means that our script has only to keep track of which of the first two states (<code class="docutils literal notranslate"><span class="pre">S0</span></code> and <code class="docutils literal notranslate"><span class="pre">S1</span></code>) it is in at any point in time, which we can do with a single <em>Boolean</em> variable.</p>
<p>Let’s call this variable <code class="docutils literal notranslate"><span class="pre">looking_for_open_quote</span></code>, and define its behavior so that it is <code class="docutils literal notranslate"><span class="pre">True</span></code> when the script is in state <code class="docutils literal notranslate"><span class="pre">S0</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span></code> when the script is in <code class="docutils literal notranslate"><span class="pre">S1</span></code>. Then with the frame from <code class="docutils literal notranslate"><span class="pre">script1.py</span></code>, we can write Python code to initialize <code class="docutils literal notranslate"><span class="pre">looking_for_open_quote</span></code> (corresponding to the FSM’s start state) and use that variable to separate the work in state <code class="docutils literal notranslate"><span class="pre">S0</span></code> from that in <code class="docutils literal notranslate"><span class="pre">S1</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap02/script2.py</span>
<span class="linenos"> 2</span><span class="n">my_book</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;What book would you like as a script? &#39;</span><span class="p">)</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;txts/&#39;</span> <span class="o">+</span> <span class="n">my_book</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_open_book</span><span class="p">:</span>
<span class="linenos"> 5</span>    <span class="c1"># Set our FSM to the start state</span>
<span class="linenos"> 6</span>    <span class="n">looking_for_open_quote</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 9</span>       <span class="n">the_line</span> <span class="o">=</span> <span class="n">my_open_book</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="linenos">10</span>        
<span class="linenos">11</span>        <span class="c1"># Check for EOF</span>
<span class="linenos">12</span>        <span class="k">if</span> <span class="n">the_line</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
<span class="linenos">13</span>            <span class="k">break</span>
<span class="linenos">14</span>
<span class="linenos">15</span>        <span class="c1"># new pseudocode goes here</span>
<span class="linenos">16</span>        <span class="k">if</span> <span class="n">looking_for_open_quote</span><span class="p">:</span>   <span class="c1"># in S0</span>
<span class="linenos">17</span>            <span class="c1"># Do some work</span>
<span class="linenos">18</span>        <span class="k">else</span><span class="p">:</span>                        <span class="c1"># in S1</span>
<span class="linenos">19</span>            <span class="c1"># Do other work</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The End.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that the script pulls the processing that every state does (i.e., reading a line of characters from the input file) out of each state’s work. We will talk more, in the next chapter, about the benefits of collecting commonly executed code together in one place.</p>
</section>
<section id="this-or-that">
<p><strong>This or that.</strong> You’ll also notice, in <code class="docutils literal notranslate"><span class="pre">script2.py</span></code>, a new syntactic structure for the Python if-statement. Compare it with the if-statement immediately above it, which is used to check for our infinite while-loop’s exit condition. In checking for EOF, the if-statement protects the break-statement: we either hit this condition or continued on with the loop’s work. In checking for something exceptional like this, the if-block and its controlling condition is all the structure we need.</p>
<p>In testing the value of <code class="docutils literal notranslate"><span class="pre">looking_for_open_quote</span></code>, we need to decide which of two pieces of work we want to do, and we must do the work in one of these two states before continuing on. While we could write an if-statement to check one of the conditions and then follow it with another if-statement checking the other condition, Python provides a form of the if-statement that eliminates this unnecessary second check. In this form, the second if-statement becomes a simple <code class="docutils literal notranslate"><span class="pre">else</span></code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Why is an if-else-block better than two if-statements in this situation? Because the condition we’re checking is either true or false. When it’s not one, it must be the other. If you write two if-statements, you’ll have to correctly write a condition and its complement. The if-else construct removes this unnecessary work (and potential error in logic or typing waiting to happen).</p>
</div>
</section>
<section id="work-on-a-state">
<p><strong>Work on a state.</strong> Let’s work next on the logic in state <code class="docutils literal notranslate"><span class="pre">S0</span></code>. What do we need to do in it? For one thing, it can ignore any line that does not contain a double-quote character. But if the line contains a double-quote character, we know that the line, at least, is the beginning piece of a line of dialogue. I say “at least” because the dialogue that starts on this line may end on this line or extend to one or more following lines.</p>
<p>I want to pause here and highlight the fact that we are using the word “line” in two different contexts that we must keep straight. A line from the file, which is completely contained in the object called <code class="docutils literal notranslate"><span class="pre">the_line</span></code>, and a line of dialogue from the story, which can start anywhere in a file line and continue to an arbitrary point in that or a later file line. For example, the first line of dialogue in <em>The Cat in the Hat</em> starts in the middle of the eighth file line and continues to the end of the ninth file line.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>### Lines 8 and 9 of CatInTheHat.txt
8 And I said, &quot;How I wish
9 We had something to do!&quot;
</pre></div>
</div>
<p>Let’s start to implement these ideas by focusing first on the transition between states while in state <code class="docutils literal notranslate"><span class="pre">S0</span></code>.<a class="footnote-reference brackets" href="#fn5" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">15</span>        <span class="c1">### Part of chap02/script3.py</span>
<span class="linenos">16</span>        <span class="k">if</span> <span class="n">looking_for_open_quote</span><span class="p">:</span>   <span class="c1"># in S0</span>
<span class="linenos">17</span>            <span class="c1"># Do some work</span>
<span class="linenos">18</span>
<span class="linenos">19</span>            <span class="c1"># Part of which is transitioning between states</span>
<span class="linenos">20</span>            <span class="c1"># if found opening double quote</span>
<span class="linenos">21</span>                <span class="c1"># move to s1</span>
<span class="linenos">22</span>            <span class="c1"># else</span>
<span class="linenos">23</span>                <span class="c1"># stay in s0</span>
</pre></div>
</div>
<p>Notice that line 20 uses an if-statement to check for the event that causes the transition from <code class="docutils literal notranslate"><span class="pre">S0</span></code> to <code class="docutils literal notranslate"><span class="pre">S1</span></code>. This event is the presence of a double-quote character in <code class="docutils literal notranslate"><span class="pre">the_line</span></code>. So, how do we check for a double-quote character in the string object named <code class="docutils literal notranslate"><span class="pre">the_line</span></code>?</p>
</section>
<section id="strings-as-a-sequence-of-characters">
<p><strong>Strings as a sequence of characters.</strong> To this point, I’ve been relying on your intuition for what constitutes a string in Python. We created them by defining string literals. We read file lines as strings and compared them against string literals (e.g., to test for EOF). And we printed them out to the terminal. Probably none of this work forced you to think about how we were representing strings in the computer; we simply operated on them as big blobs. However, to ask whether a string contains a particular character, we have to know if Python allows us access to the components of a string object.</p>
<p>Short answer: it does. A string in Python is a <em>sequence</em> of characters. I emphasized sequence in this definition because sequence is a very useful abstraction for lots of different objects that we’ll manipulate in our scripts. The abstraction you should have in your mind for a sequence is <em>an ordered collection of items</em>.</p>
<p>It doesn’t matter if the items in a sequence are of the same type or kind, although in the case of a string, each item in the ordered collection is of the same kind (i.e., a character). We will soon play with the <code class="docutils literal notranslate"><span class="pre">list</span></code> data type in Python, which allows you to create a sequence containing different kinds of things. For example, the objects on my office bookshelf when viewed from left to right could be represented as a Python <code class="docutils literal notranslate"><span class="pre">list</span></code> containing a stuffed animal, a picture of my kids, this course’s textbook, an old compact disk, and then some other books.</p>
</section>
<section id="membership-test">
<p><strong>Membership test.</strong> What makes a sequence a useful <em>abstraction</em> are the commonly used operations that query or manipulate Python sequences without needing to know anything more specific about the actual sequence. For example, we can ask about the length of a sequence, and it doesn’t matter if we’re asking about the number of characters in a string or items in a list. All that matters is that the object whose length we’re interested in acts like a sequence so that Python can answer with a count of the number of items in the collection.</p>
<p>Another commonly used operation on a sequence is a membership test, which asks whether a specified item is a member of the specified sequence. Note that a membership test is exactly what we need to determine whether the string named <code class="docutils literal notranslate"><span class="pre">the_line</span></code> contains a double-quote character. The Python operator for a membership test is <code class="docutils literal notranslate"><span class="pre">in</span></code>, and you start your question with the item you want to know if it is in the sequence. With this, let’s turn our pseudocode if-statement into Python code!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">15</span>        <span class="c1">### Part of chap02/script4.py</span>
<span class="linenos">16</span>        <span class="k">if</span> <span class="n">looking_for_open_quote</span><span class="p">:</span>   <span class="c1"># in S0</span>
<span class="linenos">17</span>            <span class="c1"># Do some work</span>
<span class="linenos">18</span>
<span class="linenos">19</span>            <span class="c1"># Part of which is transitioning between states</span>
<span class="linenos">20</span>            <span class="k">if</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">in</span> <span class="n">the_line</span><span class="p">:</span>
<span class="linenos">21</span>                <span class="c1"># move to s1</span>
<span class="linenos">22</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">23</span>                <span class="c1"># stay in s0</span>
</pre></div>
</div>
<p>If you wanted to know that there was no double quote in <code class="docutils literal notranslate"><span class="pre">the_line</span></code>, you’d write the expression: <code class="docutils literal notranslate"><span class="pre">'&quot;'</span> <span class="pre">not</span> <span class="pre">in</span> <span class="pre">the_line</span></code>. Both <code class="docutils literal notranslate"><span class="pre">in</span></code> and <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">in</span></code> are binary infix operators, and both return <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</section>
<section id="coding-a-transition">
<p><strong>Coding a transition.</strong> To transition from state <code class="docutils literal notranslate"><span class="pre">S0</span></code> to state <code class="docutils literal notranslate"><span class="pre">S1</span></code> (i.e., pseudocode line 21), we simply need to set our state variable<a class="footnote-reference brackets" href="#fn6" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a> appropriately, which in this case means setting <code class="docutils literal notranslate"><span class="pre">looking_for_open_quote</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>. Staying in <code class="docutils literal notranslate"><span class="pre">S0</span></code> is even easier: <code class="docutils literal notranslate"><span class="pre">looking_for_open_quote</span></code> stays <code class="docutils literal notranslate"><span class="pre">True</span></code>, and this means we can delete the entire <code class="docutils literal notranslate"><span class="pre">else</span></code> clause since there’s no work to be done (i.e., it is already <code class="docutils literal notranslate"><span class="pre">True</span></code> in this code block!).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">15</span>        <span class="c1">### Part of chap02/script5.py</span>
<span class="linenos">16</span>        <span class="k">if</span> <span class="n">looking_for_open_quote</span><span class="p">:</span>   <span class="c1"># in S0</span>
<span class="linenos">17</span>            <span class="c1"># Do some work</span>
<span class="linenos">18</span>            
<span class="linenos">19</span>            <span class="c1"># Part of which is transitioning between states</span>
<span class="linenos">20</span>            <span class="k">if</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">in</span> <span class="n">the_line</span><span class="p">:</span>
<span class="linenos">21</span>                <span class="n">looking_for_open_quote</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</section>
<section id="indexing-and-slicing">
<p><strong>Indexing and slicing.</strong> I left the comment “do some work” because transitioning on seeing a double quote is not all we need to do. To print each line of dialogue, we need to capture the characters we read from an opening double quote until its matching ending one. Python makes this work easy with a couple of other common operations on sequences. To illustrate them, I’ll use line 8 of the file <code class="docutils literal notranslate"><span class="pre">CatInTheHat.txt</span></code>, which reads ‘<code class="docutils literal notranslate"><span class="pre">And</span> <span class="pre">I</span> <span class="pre">said,</span> <span class="pre">&quot;How</span> <span class="pre">I</span> <span class="pre">wish</span></code>’.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>### NOT runnable -- turn into a figure!
  +---+---+---+---+---+---+---+---+---+---+---+---+---+---+-   -+---+---+----+
  | A | n | d |   | I |   | s | a | i | d | , |   | &quot; | H | ... | s | h | \n |
  +---+---+---+---+---+---+---+---+---+---+---+---+---+---+-   -+---+---+----+
  0   1   2   3   4   5   6   7   8   9  10  11  12  13  14    21  22  23   24
-24 -23 -22 -21 -20 -19 -18 -17 -16 -14 -13 -12 -11 -10  -9    -3  -2  -1
</pre></div>
</div>
<p>To begin using these operations, you need to understand how Python identifies a sequence item with an index number. Most important in this, Python—like many program languages—starts numbering the items <em>at 0</em>. For instance, <code class="docutils literal notranslate"><span class="pre">the_line[0]</span></code> returns ‘<code class="docutils literal notranslate"><span class="pre">A</span></code>’, the first character in our example string. Asking for <code class="docutils literal notranslate"><span class="pre">the_line[1]</span></code> returns the second character. This use of square brackets is called <em>indexing</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">the_line</span> <span class="o">=</span> <span class="s1">&#39;And I said, &quot;How I wish</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="linenos">2</span><span class="nb">print</span><span class="p">(</span><span class="n">the_line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="linenos">3</span><span class="nb">print</span><span class="p">(</span><span class="n">the_line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition-you-try-it admonition">
<p class="admonition-title">You Try It</p>
<p>Go ahead, and use the interactive Python interpreter to experiment with statements in this section’s code blocks. The more you play the better you’ll understand how indexing works.</p>
</div>
<p>As I mentioned earlier, you can ask for the length of a sequence object. You do it with the Python built-in function <code class="docutils literal notranslate"><span class="pre">len</span></code>. For example, <code class="docutils literal notranslate"><span class="pre">len(the_line)</span></code> returns <code class="docutils literal notranslate"><span class="pre">24</span></code>. Notice that it counts letters, spaces, punctuation, and the special newline character at the end of this string. These are all items in the sequence named <code class="docutils literal notranslate"><span class="pre">the_line</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">len</span><span class="p">(</span><span class="n">the_line</span><span class="p">)</span>
</pre></div>
</div>
<p>While counting from the front of a string is often what you need, sometimes it’s more natural to your problem to count backwards from the end of the string. This is possible in Python by using negative indices. The last character in our <code class="docutils literal notranslate"><span class="pre">the_line</span></code> example is accessed by writing <code class="docutils literal notranslate"><span class="pre">the_line[-1]</span></code>, and the initial capital <code class="docutils literal notranslate"><span class="pre">'A'</span></code> is <code class="docutils literal notranslate"><span class="pre">the_line[-24]</span></code> or <code class="docutils literal notranslate"><span class="pre">the_line[-len(the_line)]</span></code>. You will get an <code class="docutils literal notranslate"><span class="pre">IndexError</span></code> if the index you use for a given string <code class="docutils literal notranslate"><span class="pre">s</span></code> is less than <code class="docutils literal notranslate"><span class="pre">-len(s)</span></code> or greater than or equal to <code class="docutils literal notranslate"><span class="pre">len(s)</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">print</span><span class="p">(</span><span class="n">the_line</span><span class="p">[</span><span class="o">-</span><span class="mi">24</span><span class="p">])</span>             <span class="c1"># prints the first character</span>
<span class="linenos">2</span><span class="nb">print</span><span class="p">(</span><span class="n">the_line</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">the_line</span><span class="p">)])</span>  <span class="c1"># also prints the first character</span>
<span class="linenos">3</span><span class="n">the_line</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">the_line</span><span class="p">)]</span>          <span class="c1"># index out of bounds!</span>
</pre></div>
</div>
<p>Indexing is helpful, but what our problem needs is the ability to grab a subsequence of characters from the full sequence. To do this, we can use Python’s <em>slicing</em> facility, which adds a colon and second index into the square brackets. For example, <code class="docutils literal notranslate"><span class="pre">the_line[6:10]</span></code> returns the string <code class="docutils literal notranslate"><span class="pre">'said'</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nb">print</span><span class="p">(</span><span class="n">the_line</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
<p>Notice that the first index in this expression (i.e., the one before the colon) is the index of <em>the first character of the slice we want</em>, but the second index in this expression is <em>one greater</em> than the index of the last item in our slice. Defining the slicing operation in this manner allows us to write <code class="docutils literal notranslate"><span class="pre">the_line[0:len(the_line)]</span></code> to create a copy of the string object named <code class="docutils literal notranslate"><span class="pre">the_line</span></code>. Since a programmer will often find herself writing <code class="docutils literal notranslate"><span class="pre">0</span></code> as the first index and <code class="docutils literal notranslate"><span class="pre">len(s)</span></code> as the second index in a slice, where <code class="docutils literal notranslate"><span class="pre">s</span></code> is a name for some sequence object, Python will assume you mean <code class="docutils literal notranslate"><span class="pre">0</span></code> as the first index if you elide it and <code class="docutils literal notranslate"><span class="pre">len(s)</span></code> as the second index if you elide it. To copy a string <code class="docutils literal notranslate"><span class="pre">s</span></code>, therefore, you can simply type <code class="docutils literal notranslate"><span class="pre">s[:]</span></code>.</p>
<p>I tell you all this because we want the slice <code class="docutils literal notranslate"><span class="pre">the_line[12:]</span></code> as the start of our dialogue line.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">the_line</span> <span class="o">=</span> <span class="s1">&#39;And I said, &quot;How I wish</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="linenos">2</span><span class="nb">print</span><span class="p">(</span><span class="n">the_line</span><span class="p">[</span><span class="mi">12</span><span class="p">:])</span>
</pre></div>
</div>
<p>But how do we know that the double quote sits at index 12? All that the <code class="docutils literal notranslate"><span class="pre">in</span></code> operator told us was that a double-quote character existed in <code class="docutils literal notranslate"><span class="pre">the_line</span></code>.</p>
</section>
<section id="for-loops">
<p><strong>For-loops.</strong> Programmers ask this type of question often enough that the developers of Python made it easy to answer. But I’m going to divert us for a moment to talk about how, for example, a beginning programmer would solve this problem without using this Python aid. This aside introduces to you the other major looping construct in Python (and many other languages): the <em>for-loop</em>. More importantly, it will help you to understand what takes place behind the scenes in the Python aid that we’ll eventually use.</p>
<p>The following code block fills in more of the work we need done in state <code class="docutils literal notranslate"><span class="pre">S0</span></code>. In particular, it uses a for-loop to find the location of the first double-quote character in <code class="docutils literal notranslate"><span class="pre">the_line</span></code> and then begins capturing the dialogue.<a class="footnote-reference brackets" href="#fn7" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">15</span>        <span class="c1">### Part of chap02/script6.py</span>
<span class="linenos">16</span>        <span class="k">if</span> <span class="n">looking_for_open_quote</span><span class="p">:</span>   <span class="c1"># in S0</span>
<span class="linenos">17</span>            <span class="c1"># Do some work</span>
<span class="linenos">18</span>
<span class="linenos">19</span>            <span class="c1"># Part of which is capturing dialogue</span>
<span class="linenos">20</span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">the_line</span><span class="p">)):</span>
<span class="linenos">21</span>                <span class="k">if</span> <span class="n">the_line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">:</span>
<span class="linenos">22</span>                    <span class="n">dialog</span> <span class="o">=</span> <span class="n">the_line</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
<span class="linenos">23</span>                    <span class="k">break</span>
<span class="linenos">24</span>
<span class="linenos">25</span>            <span class="c1"># Part of which is transitioning between states</span>
<span class="linenos">26</span>            <span class="k">if</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">in</span> <span class="n">the_line</span><span class="p">:</span>
<span class="linenos">27</span>                <span class="n">looking_for_open_quote</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">for</span></code> statement on line 20 iterates over the items in a sequence. The <code class="docutils literal notranslate"><span class="pre">in</span></code> keyword here plays a similar membership role as we saw earlier, but this time, we are asking <code class="docutils literal notranslate"><span class="pre">i</span></code> to name each item in the specified sequence in order, and for each of those values, execute an iteration of the indented block of statements (i.e., the body of the for-loop).</p>
<p>To see this for-loop in action, we need to know what the sequence is in this particular case. We already know what value is produced by <code class="docutils literal notranslate"><span class="pre">len(the_line)</span></code>, and we pass the integer value computed by it to another Python built-in function called <code class="docutils literal notranslate"><span class="pre">range</span></code>. This built-in is quite interesting, but for now we simply need to think of it as computing a sequence object containing the integers from <code class="docutils literal notranslate"><span class="pre">0</span></code> to one less than the integer value passed to <code class="docutils literal notranslate"><span class="pre">range</span></code>.</p>
<p>Let’s now look at the body of the for-loop in the code block above. It asks whether the character at index <code class="docutils literal notranslate"><span class="pre">i</span></code> in <code class="docutils literal notranslate"><span class="pre">the_line</span></code> is a double quote. When it is, the body of the if-statement names the slice of <code class="docutils literal notranslate"><span class="pre">the_line</span></code> from <code class="docutils literal notranslate"><span class="pre">i</span></code> to the end of <code class="docutils literal notranslate"><span class="pre">the_line</span></code> with the variable <code class="docutils literal notranslate"><span class="pre">dialog</span></code>. We end the if-statement body with a <code class="docutils literal notranslate"><span class="pre">break</span></code> because we don’t need the for-loop to continue checking the rest of <code class="docutils literal notranslate"><span class="pre">the_line</span></code> once we’ve found a double quote. (Actually, there are other cases we need to handle, but not for our example from line 8 of <code class="docutils literal notranslate"><span class="pre">CatInTheHat.txt</span></code>.)</p>
<p>Our original if-statement that checked for a double-quote character in <code class="docutils literal notranslate"><span class="pre">the_line</span></code> is now performing redundant work when the for-loop finds a double quote. We can rewrite the work in state <code class="docutils literal notranslate"><span class="pre">S0</span></code> to integrate the transition work into the for-loop.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">15</span>        <span class="c1">### Part of chap02/script7.py</span>
<span class="linenos">16</span>        <span class="k">if</span> <span class="n">looking_for_open_quote</span><span class="p">:</span>   <span class="c1"># in S0</span>
<span class="linenos">17</span>            <span class="c1"># Look for an opening double quote</span>
<span class="linenos">18</span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">the_line</span><span class="p">)):</span>
<span class="linenos">19</span>                <span class="k">if</span> <span class="n">the_line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">:</span>
<span class="linenos">20</span>                    <span class="c1"># Capture dialogue and transition to S1</span>
<span class="linenos">21</span>                    <span class="n">dialog</span> <span class="o">=</span> <span class="n">the_line</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
<span class="linenos">22</span>                    <span class="n">looking_for_open_quote</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">23</span>                    <span class="k">break</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you find the logic hard to follow in the last code block, you’re not alone. While logically correct, the three things we had to do—(1) check for the presence of a double-quote character; (2) start capturing the dialogue if found; and (3) decide whether to stay in one state or transition to the other—are now all muddled together. Sometimes a solution that does a bit more work is better because it is easier to understand and faster to get correct. Unless you know that performance is an issue, don’t prematurely optimize for it.</p>
</div>
</section>
<section id="string-find">
<p><strong>String find.</strong> We don’t have to write a for-loop to find the index of the first occurrence of a double-quote character because the Python language includes a <code class="docutils literal notranslate"><span class="pre">str.find</span></code> method, which does much of the work for us. Notice that I don’t say “all of the work.” The method is a bit tricky in how it lets you know that it didn’t find the substring you sought. When this is what the method needs to communicate, the value it returns is <code class="docutils literal notranslate"><span class="pre">-1</span></code>, which is not an index value but an indication that there’s no index to return. In other words, given a string <code class="docutils literal notranslate"><span class="pre">s</span></code> and a substring <code class="docutils literal notranslate"><span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">s.find(c)</span></code> returns an integer between <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">len(s)-1</span></code> if <code class="docutils literal notranslate"><span class="pre">c</span></code> occurs within <code class="docutils literal notranslate"><span class="pre">s</span></code> and <code class="docutils literal notranslate"><span class="pre">-1</span></code> if not.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">15</span>        <span class="c1">### Part of chap02/script8.py</span>
<span class="linenos">16</span>        <span class="k">if</span> <span class="n">looking_for_open_quote</span><span class="p">:</span>   <span class="c1"># in S0</span>
<span class="linenos">17</span>            <span class="n">i</span> <span class="o">=</span> <span class="n">the_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<span class="linenos">18</span>            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># Was the find successful?</span>
<span class="linenos">19</span>                <span class="c1"># Found an open quote</span>
<span class="linenos">20</span>                <span class="n">dialog</span> <span class="o">=</span> <span class="n">the_line</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
<span class="linenos">21</span>                <span class="n">looking_for_open_quote</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Because the if-statement on line 18 isn’t <em>self-documenting</em> (i.e., it doesn’t look anything like the question we’re asking), I’ve added a comment to explain its purpose. The if-statement on line 16, in contrast, is better at self-documentation. The comment there simply reminds us which state corresponds to looking for an opening double quote. You don’t need to comment every line in your scripts if their purpose is clear, but you should definitely comment those that are confusing (e.g., line 18) and when you want to tie your design work to your code (e.g., line 16).</p>
</div>
</section>
<section id="design-patterns-for-error-handling">
<p><strong>Design patterns for error handling.</strong> When you have been programming long enough, like any practiced skill, you’ll start to see repeated patterns. The special use of the value <code class="docutils literal notranslate"><span class="pre">-1</span></code> is a common one for error handling. A command, function, or method carves out one or more values and distinguishes those values as error conditions. In our current example, <code class="docutils literal notranslate"><span class="pre">find</span></code> needs only the integers in the range <code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">len(s)-1</span></code> to fully accomplish its stated functionality. The person who wrote the implementation of <code class="docutils literal notranslate"><span class="pre">find</span></code> was free to pick any value outside this range of valid results as an error condition. She might have picked several such values to indicate a number of different error conditions.</p>
<p>One of the things you’ll learn as your programming skill grows is that you should always check and handle the error conditions that might occur in the commands, functions, and methods you use. The only reason not to do this is because you have carefully reasoned out why the error condition cannot occur.<a class="footnote-reference brackets" href="#fn8" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a></p>
<p>Unfortunately, just because a design pattern is commonly used doesn’t mean it isn’t without headaches. This pattern requires us to add the statement <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">i</span> <span class="pre">!=</span> <span class="pre">-1:</span></code> to our script, which we are supposed to read as “if <code class="docutils literal notranslate"><span class="pre">find</span></code> returned a valid index into <code class="docutils literal notranslate"><span class="pre">the_line</span></code> then we found an opening double-quote character at index <code class="docutils literal notranslate"><span class="pre">i</span></code>.” Yeah, it doesn’t look much like that to me either (and hence our added comment).</p>
<p>While not an issue with the structure of the logic, many programmers also dislike this design pattern because it can break up a script’s flow with lots of checks for uncommon error conditions. When we are constantly distracted by infrequently-true error checks, it can make it very hard to read the script to understand its primary function. We can solve this headache by using a different design pattern for error handling, which keeps exceptional events out of the main flow of your algorithm. We will talk about this other design pattern in a later problem-to-be-solved.</p>
</section>
<section id="never-go-too-long-without-testing">
<p><strong>Never go too long without testing.</strong> We’ve made great progress on our script, and now we have a choice of how to proceed. On the one hand, we can continue to write code to handle all the cases that might occur in state <code class="docutils literal notranslate"><span class="pre">S0</span></code> (e.g., a piece of dialogue that is completely contained within a file line). Our minds are focused on <code class="docutils literal notranslate"><span class="pre">S0</span></code>, and it may be enticing to continue until we’ve handled every case we can imagine. On the other hand, we could switch and start writing some code for state <code class="docutils literal notranslate"><span class="pre">S1</span></code>. In particular, we could write <code class="docutils literal notranslate"><span class="pre">S1</span></code> code that complements the code we just finished in <code class="docutils literal notranslate"><span class="pre">S0</span></code>. The benefit of this approach is that it would allow us to see if we can get our script to run on some subset of the possible inputs.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When you have the opportunity to test what you’ve written, take it. It’s a good practice to build your script in pieces that you can regularly test. I like the feeling of accomplishment when I get another small piece of my problem to work. Plus, it is often efficient from an overall time perspective if you don’t spend a lot of time coding a design that was doomed to failure based on one of your early design decisions. Regular testing will keep you from wasting a lot of time on doomed designs. The exercises and problem sets that come with this book are structured to encourage you to follow this approach.</p>
</div>
<p>So let’s move toward a script we can test. What do we need to write for state <code class="docutils literal notranslate"><span class="pre">S1</span></code> that integrates with what we just finished writing for <code class="docutils literal notranslate"><span class="pre">S0</span></code>? When our script is in state <code class="docutils literal notranslate"><span class="pre">S1</span></code>, it is looking for the close quote matching the open quote seen in state <code class="docutils literal notranslate"><span class="pre">S0</span></code>. This sounds a lot like the work we just finished.</p>
<p>In both states, we use the <code class="docutils literal notranslate"><span class="pre">find</span></code> method on strings to determine whether <code class="docutils literal notranslate"><span class="pre">the_line</span></code> contains a double-quote character, and if it does, we either start capturing (state <code class="docutils literal notranslate"><span class="pre">S0</span></code>) or finish capturing (state <code class="docutils literal notranslate"><span class="pre">S1</span></code>) the <code class="docutils literal notranslate"><span class="pre">dialog</span></code>. We also include a FSM transition in each case, which involves setting <code class="docutils literal notranslate"><span class="pre">looking_for_open_quote</span></code> appropriately. Finally, we will need to print in state <code class="docutils literal notranslate"><span class="pre">S1</span></code> the dialogue we captured, as the specification required us to do. Here’s that code for states <code class="docutils literal notranslate"><span class="pre">S0</span></code> and <code class="docutils literal notranslate"><span class="pre">S1</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">15</span>        <span class="c1">### Part of chap02/script8.py</span>
<span class="linenos">16</span>        <span class="k">if</span> <span class="n">looking_for_open_quote</span><span class="p">:</span>   <span class="c1"># in S0</span>
<span class="linenos">17</span>            <span class="n">i</span> <span class="o">=</span> <span class="n">the_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<span class="linenos">18</span>            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># Was the find successful?</span>
<span class="linenos">19</span>                <span class="c1"># Found an open quote</span>
<span class="linenos">20</span>                <span class="n">dialog</span> <span class="o">=</span> <span class="n">the_line</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
<span class="linenos">21</span>                <span class="n">looking_for_open_quote</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">22</span>                <span class="c1"># FIXME! Need to handle short dialogue.</span>
<span class="linenos">23</span>
<span class="linenos">24</span>        <span class="k">else</span><span class="p">:</span>                        <span class="c1"># in S1</span>
<span class="linenos">25</span>            <span class="n">i</span> <span class="o">=</span> <span class="n">the_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<span class="linenos">26</span>            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># Was the find successful?</span>
<span class="linenos">27</span>                <span class="c1"># Found a close quote</span>
<span class="linenos">28</span>                <span class="n">dialog</span> <span class="o">+=</span> <span class="n">the_line</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">29</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ACTOR:&quot;</span><span class="p">,</span> <span class="n">dialog</span><span class="p">)</span>
<span class="linenos">30</span>                <span class="n">looking_for_open_quote</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">31</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">32</span>                <span class="n">dialog</span> <span class="o">+=</span> <span class="n">the_line</span>
<span class="linenos">33</span>            <span class="c1"># FIXME! Is this all the work in state S1?</span>
</pre></div>
</div>
</section>
<section id="concatenation-overloading-and-shorthands">
<p><strong>Concatenation, overloading, and shorthands.</strong> Let’s go through the code for state S1, which will highlight an important things: (1) a design difference between the two blocks; and (2) a common shorthand you’ll see in Python code.</p>
<p>First notice that the if-statement on line 26, unlike its sibling on line 18, does something for both the case of finding a double quote in <code class="docutils literal notranslate"><span class="pre">the_line</span></code> and not finding one. When the script finds a closing double quote, it adds the remaining dialogue to the variable <code class="docutils literal notranslate"><span class="pre">dialog</span></code>. By add, I of course mean concatenate. As you learned in Chapter 1’s exercises, the <code class="docutils literal notranslate"><span class="pre">+</span></code> operator concatenates when its operands are strings and adds when its operands are numbers. This is called <em>overloading</em>: the operation of the operator depends on the type of its operands.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">S1</span></code> code also adds all the characters in <code class="docutils literal notranslate"><span class="pre">the_line</span></code> when it doesn’t find a double-quote character. This is because everything in the current file line is part of the running dialogue.</p>
<p>But wait, these two concatenation operations don’t look quite like what we saw in the last chapter. What is the meaning of this <code class="docutils literal notranslate"><span class="pre">+=</span></code> operator where we expect the concatenation we just discussed to occur? Well, <code class="docutils literal notranslate"><span class="pre">+=</span></code> just a shorthand for a concatenation that is really an append. In other words, the statement <code class="docutils literal notranslate"><span class="pre">dialog</span> <span class="pre">+=</span> <span class="pre">the_line</span></code> is equivalent to the statement: <code class="docutils literal notranslate"><span class="pre">dialog</span> <span class="pre">=</span> <span class="pre">dialog</span> <span class="pre">+</span> <span class="pre">the_line</span></code>.</p>
</section>
<section id="off-by-one-and-other-potential-errors">
<p><strong>Off-by-one and other potential errors.</strong> Now look carefully at what we append to <code class="docutils literal notranslate"><span class="pre">dialog</span></code> when the script finds a double-quote character. Do you fully understand why <code class="docutils literal notranslate"><span class="pre">the_line[:i+1]</span></code> includes the ending double quote? If not, you may wish to read the documentation about the string method <code class="docutils literal notranslate"><span class="pre">find</span></code> and review how the indices in slicing work. If you left off the <code class="docutils literal notranslate"><span class="pre">+1</span></code> in <code class="docutils literal notranslate"><span class="pre">the_line[:i+1]</span></code>, this would be an example of what’s called <em>an off-by-one error</em>. They are quite common in programming, and you should train yourself to be alert to situations where they can occur.</p>
<p>As I did for <code class="docutils literal notranslate"><span class="pre">S0</span></code>, I added a comment at the end of the code for state <code class="docutils literal notranslate"><span class="pre">S1</span></code> to remind us that we haven’t carefully considered all the cases that can occur when looking for dialogue. We have neither tested on a lot of different examples nor carefully thought through the cases we might encounter. But that’s ok for now, since we simply want to see if we can get the script to work for the cases we think we have covered!</p>
</section>
<section id="testing">
<p><strong>Testing.</strong> Typically, you start testing with small inputs to see if your script operates as you expect. This is a great method for incrementally learning what works and clearly seeing what doesn’t. Being methodical may not be your style, but it makes testing and debugging less of a nightmare.</p>
<p>Here’s the full script we’ve developed to this point:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap02/script8.py</span>
<span class="linenos"> 2</span><span class="n">my_book</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;What book would you like as a script? &#39;</span><span class="p">)</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;txts/&#39;</span> <span class="o">+</span> <span class="n">my_book</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_open_book</span><span class="p">:</span>
<span class="linenos"> 5</span>    <span class="c1"># Set our FSM to the start state</span>
<span class="linenos"> 6</span>    <span class="n">looking_for_open_quote</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 9</span>        <span class="n">the_line</span> <span class="o">=</span> <span class="n">my_open_book</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="linenos">10</span>
<span class="linenos">11</span>        <span class="c1"># Check for EOF</span>
<span class="linenos">12</span>        <span class="k">if</span> <span class="n">the_line</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
<span class="linenos">13</span>            <span class="k">break</span>
<span class="linenos">14</span>
<span class="linenos">15</span>        <span class="c1"># new pseudocode goes here</span>
<span class="linenos">16</span>        <span class="k">if</span> <span class="n">looking_for_open_quote</span><span class="p">:</span>   <span class="c1"># in S0</span>
<span class="linenos">17</span>            <span class="n">i</span> <span class="o">=</span> <span class="n">the_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<span class="linenos">18</span>            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># Was the find successful?</span>
<span class="linenos">19</span>                <span class="c1"># Found an open quote</span>
<span class="linenos">20</span>                <span class="n">dialog</span> <span class="o">=</span> <span class="n">the_line</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
<span class="linenos">21</span>                <span class="n">looking_for_open_quote</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">22</span>                <span class="c1"># FIXME! Need to handle short dialogue.</span>
<span class="linenos">23</span>
<span class="linenos">24</span>        <span class="k">else</span><span class="p">:</span>                        <span class="c1"># in S1</span>
<span class="linenos">25</span>            <span class="n">i</span> <span class="o">=</span> <span class="n">the_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<span class="linenos">26</span>            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># Was the find successful?</span>
<span class="linenos">27</span>                <span class="c1"># Found a close quote</span>
<span class="linenos">28</span>                <span class="n">dialog</span> <span class="o">+=</span> <span class="n">the_line</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">29</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ACTOR:&quot;</span><span class="p">,</span> <span class="n">dialog</span><span class="p">)</span>
<span class="linenos">30</span>                <span class="n">looking_for_open_quote</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">31</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">32</span>                <span class="n">dialog</span> <span class="o">+=</span> <span class="n">the_line</span>
<span class="linenos">33</span>            <span class="c1"># FIXME! Is this all the work in state S1?</span>
<span class="linenos">34</span>
<span class="linenos">35</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The End.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Our first test input is <code class="docutils literal notranslate"><span class="pre">Talkative1.txt</span></code>, which contains two paragraphs from the Indian fairy tale titled <em>The Talkative Tortoise</em>. When you run <code class="docutils literal notranslate"><span class="pre">script8.py</span></code> and tell it to read <code class="docutils literal notranslate"><span class="pre">Talkative1.txt</span></code>, it should work as we expect: The single line of dialogue (across multiple file lines) is printed. That’s not what will probably happen on most of your first test runs, but one can always hope!</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When testing a script that repetitively does something, first test with an input that requires only one iteration of your repetitive action. This is what <code class="docutils literal notranslate"><span class="pre">Talkative1.txt</span></code> did; it caused our script to visit state <code class="docutils literal notranslate"><span class="pre">S0</span></code>, then state <code class="docutils literal notranslate"><span class="pre">S1</span></code>, and then exit. Once one iteration works, try an input that causes two iterations. Proceeding like this separates the testing of the work <em>within an iteration</em> from the work a script does <em>to move from one iteration to the next</em>.</p>
</div>
<p>Let’s now try our script on a test input file containing two lines of dialogue. Run <code class="docutils literal notranslate"><span class="pre">script8.py</span></code> on <code class="docutils literal notranslate"><span class="pre">Talkative2.txt</span></code>. Success again!</p>
<p>So far so good, but I said we had skipped the case of a story with a line of dialogue fully contained on one line of the input file. The file <code class="docutils literal notranslate"><span class="pre">HomeView3.txt</span></code> contains this case, which is a paragraph from the first chapter of <em>Five Little Peppers</em> by Margaret Sidney (a pseudonym for Harriett Lothrop). Run <code class="docutils literal notranslate"><span class="pre">script8.py</span></code> on this input and let’s see if we really need extra code to handle this case.</p>
<p>Hmmm, I guess we do. This test run failed to do what we expected; it prints a bunch of text that isn’t dialogue and ends at the start of the second quote in the input file.</p>
</section>
<section id="beware-of-hidden-assumptions">
<p><strong>Beware of hidden assumptions.</strong> Our script is short enough that we can probably analyze our problem with <code class="docutils literal notranslate"><span class="pre">HomeView3.txt</span></code> by thinking through the script’s operation. This will not always be the case, and we will soon learn how to use print statements to help us understand the state of our script at any point in its execution.</p>
<p>Consider what happens when our script grabs line 1 of <code class="docutils literal notranslate"><span class="pre">HomeView3.txt</span></code>, i.e., the variable <code class="docutils literal notranslate"><span class="pre">the_line</span></code> holds the string: <code class="docutils literal notranslate"><span class="pre">'&quot;Oh</span> <span class="pre">dear!&quot;</span> <span class="pre">exclaimed</span> <span class="pre">Polly</span> <span class="pre">as</span> <span class="pre">she</span> <span class="pre">sat</span> <span class="pre">over</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">corner</span> <span class="pre">by</span> <span class="pre">the</span> <span class="pre">window\n'</span></code>. Since the script just started, it is <code class="docutils literal notranslate"><span class="pre">looking_for_open_quote</span></code>, and it finds one at index <code class="docutils literal notranslate"><span class="pre">0</span></code> of <code class="docutils literal notranslate"><span class="pre">the_line</span></code> (i.e., the variable <code class="docutils literal notranslate"><span class="pre">i</span></code> will be <code class="docutils literal notranslate"><span class="pre">0</span></code>). Because <code class="docutils literal notranslate"><span class="pre">0</span></code> is not equal to <code class="docutils literal notranslate"><span class="pre">-1</span></code>, the script then sets the variable <code class="docutils literal notranslate"><span class="pre">dialog</span></code> to the contents of <code class="docutils literal notranslate"><span class="pre">the_line</span></code> (since <code class="docutils literal notranslate"><span class="pre">the_line[0:]</span></code> makes a copy the entire string). It also sets <code class="docutils literal notranslate"><span class="pre">looking_for_open_quote</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>, indicating a transition to state <code class="docutils literal notranslate"><span class="pre">S1</span></code>, and proceeds to the next iteration of the while-loop not realizing that it missed the close quote. While in state <code class="docutils literal notranslate"><span class="pre">S1</span></code>, it mistakenly recognizes the double quote on file line 3 as the missing close quote, and it thus prints much more than the actual first piece of dialogue. It then switches back to state <code class="docutils literal notranslate"><span class="pre">S0</span></code>, in which it finds the last double quote in the input file, but it prints nothing more because it finds the end of the file before any other double quotes.</p>
<p>The design issue here is a subtle one. Our FSM diagram from earlier says that we should transition from state <code class="docutils literal notranslate"><span class="pre">S0</span></code> to state <code class="docutils literal notranslate"><span class="pre">S1</span></code> on seeing a double-quote character, but this FSM also assumes that events come <em>one at a time</em> during our processing. In <code class="docutils literal notranslate"><span class="pre">HomeView3.txt</span></code>, <code class="docutils literal notranslate"><span class="pre">the_line</span></code> contained <em>two</em> events. We cannot blithely consider that we are done with the processing of <code class="docutils literal notranslate"><span class="pre">the_line</span></code> once we’ve found <em>a</em> double-quote character since that’s not what our FSM diagram says to do. It says to start processing the input in state <code class="docutils literal notranslate"><span class="pre">S1</span></code> on the character immediately following an opening double quote. It doesn’t say to not check the characters in <code class="docutils literal notranslate"><span class="pre">the_line</span></code> beyond the opening double quote for one or more other double-quote characters.</p>
<p>Now that we know what we did wrong, we can fix this problem in at least two different ways. We could faithfully adhere to our FSM diagram and write some code that enters state <code class="docutils literal notranslate"><span class="pre">S1</span></code> using what remains in <code class="docutils literal notranslate"><span class="pre">the_line</span></code> after an open quote, or we could check in state <code class="docutils literal notranslate"><span class="pre">S0</span></code> for short lines of dialogue and skip the transition to <code class="docutils literal notranslate"><span class="pre">S1</span></code> in these cases.</p>
<p>Sometimes one choice is better than the other, but in this case, there’s probably not much difference. Let’s maintain our current loop structure that processes file lines and decide to no longer adhere to our (initially helpful) FSM diagram.</p>
<p>Yes, this is a choice! The FSM diagram was meant to help us think about the problem. It was not meant to constrain our implementation.</p>
</section>
<section id="function-composition">
<p><strong>Function composition.</strong> Once we have thought through the problem and outlined a sensible solution, implementing it is fairly straightforward. In <code class="docutils literal notranslate"><span class="pre">script9.py</span></code>, I’ve protected the transition to state <code class="docutils literal notranslate"><span class="pre">S1</span></code> (within the <code class="docutils literal notranslate"><span class="pre">S0</span></code> work) with an if-statement that makes sure that the rest of the file line (i.e., <code class="docutils literal notranslate"><span class="pre">dialog[1:]</span></code>) does not contain a double-quote character. If it does, we slice out the short line of dialogue, print it, and stay in state <code class="docutils literal notranslate"><span class="pre">S0</span></code> looking for the next open quote (i.e., the body of the new <code class="docutils literal notranslate"><span class="pre">else</span></code> within the <code class="docutils literal notranslate"><span class="pre">S0</span></code> work).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap02/script9.py</span>
<span class="linenos"> 2</span><span class="n">my_book</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;What book would you like as a script? &#39;</span><span class="p">)</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;txts/&#39;</span> <span class="o">+</span> <span class="n">my_book</span><span class="p">)</span> <span class="k">as</span> <span class="n">my_open_book</span><span class="p">:</span>
<span class="linenos"> 5</span>    <span class="c1"># Set our FSM to the start state</span>
<span class="linenos"> 6</span>    <span class="n">looking_for_open_quote</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 9</span>        <span class="n">the_line</span> <span class="o">=</span> <span class="n">my_open_book</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="linenos">10</span>
<span class="linenos">11</span>        <span class="c1"># Check for EOF</span>
<span class="linenos">12</span>        <span class="k">if</span> <span class="n">the_line</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
<span class="linenos">13</span>            <span class="k">break</span>
<span class="linenos">14</span>
<span class="linenos">15</span>        <span class="c1"># new pseudocode goes here</span>
<span class="linenos">16</span>        <span class="k">if</span> <span class="n">looking_for_open_quote</span><span class="p">:</span>   <span class="c1"># in S0</span>
<span class="linenos">17</span>            <span class="n">i</span> <span class="o">=</span> <span class="n">the_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<span class="linenos">18</span>            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># Was the find successful?</span>
<span class="linenos">19</span>                <span class="c1"># Found an open quote</span>
<span class="linenos">20</span>                <span class="n">dialog</span> <span class="o">=</span> <span class="n">the_line</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
<span class="linenos">21</span>                <span class="k">if</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dialog</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
<span class="linenos">22</span>                    <span class="n">looking_for_open_quote</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">23</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">24</span>                    <span class="c1"># Grab entire dialog from this line ...</span>
<span class="linenos">25</span>                    <span class="n">short_dialog</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">26</span>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ACTOR: &quot;</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">short_dialog</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<span class="linenos">27</span>                    <span class="c1"># ... and stay in state S0</span>
<span class="linenos">28</span>
<span class="linenos">29</span>        <span class="k">else</span><span class="p">:</span>                        <span class="c1"># in S1</span>
<span class="linenos">30</span>            <span class="n">i</span> <span class="o">=</span> <span class="n">the_line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<span class="linenos">31</span>            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># Was the find successful?</span>
<span class="linenos">32</span>                <span class="c1"># Found a close quote</span>
<span class="linenos">33</span>                <span class="n">dialog</span> <span class="o">+=</span> <span class="n">the_line</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="linenos">34</span>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ACTOR:&quot;</span><span class="p">,</span> <span class="n">dialog</span><span class="p">)</span>
<span class="linenos">35</span>                <span class="n">looking_for_open_quote</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">36</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">37</span>                <span class="n">dialog</span> <span class="o">+=</span> <span class="n">the_line</span>
<span class="linenos">38</span>            <span class="c1"># FIXME! Is this all the work in state S1?</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The End.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The syntax on the righthand side of the <code class="docutils literal notranslate"><span class="pre">=</span></code> operator where we set <code class="docutils literal notranslate"><span class="pre">short_dialog</span></code> (line 25) is a bit intimidating, and let’s take a moment and make sure we understand exactly what it does. The key to understanding is to remember that <em>the Python order of computations takes place left to right</em>.</p>
<p>With that in mind, we can read <code class="docutils literal notranslate"><span class="pre">dialog[1:].split('&quot;')[0]</span></code> as saying: Take the object named <code class="docutils literal notranslate"><span class="pre">dialog</span></code> and treat it as a sequence. We want every item in this sequence except the first (i.e., excluding the 0th item), as specified by the slice <code class="docutils literal notranslate"><span class="pre">dialog[1:]</span></code>. Next, split this result into a list of subsequences using the double-quote character as the splitting points, as specified by <code class="docutils literal notranslate"><span class="pre">.split('&quot;')</span></code>. The double-quote character is not included in the resulting subsequences, and the list returned by <code class="docutils literal notranslate"><span class="pre">split</span></code> is itself a sequence. We index into this list to grab the first item (i.e., at index <code class="docutils literal notranslate"><span class="pre">0</span></code>), which turns out to be everything in <code class="docutils literal notranslate"><span class="pre">the_line</span></code> between the opening double quote and the ending double quote! And this explains why the subsequent <code class="docutils literal notranslate"><span class="pre">print</span></code> concatenates opening and closing double-quote characters back onto the <code class="docutils literal notranslate"><span class="pre">short_dialog</span></code> as we print it.</p>
<p>The righthand side of the <code class="docutils literal notranslate"><span class="pre">short_dialog</span></code> assignment statement is an example of <em>function composition</em>, and we will see it used often. In fact, we saw an earlier example in our for-loop code (i.e., <code class="docutils literal notranslate"><span class="pre">range(len(the_line))</span></code>). This example looks a lot like function composition in mathematics, where you evaluate the stuff in the innermost pair of parentheses first and then work your way out to the outermost parentheses. Overall, try not to let either of these different forms of function composition overwhelm or intimidate you. When you come across them, just take them a step at a time. You’ll eventually come to appreciate that<a class="footnote-reference brackets" href="#fn9" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">dialog</span> <span class="o">=</span> <span class="s1">&#39;&quot;At least I</span><span class="se">\&#39;</span><span class="s1">ll try.&quot;&#39;</span> 
<span class="linenos">2</span><span class="n">short_dialog</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">3</span><span class="n">short_dialog</span>
</pre></div>
</div>
<p>is easier to read <em>and comprehend</em> than</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="n">dialog</span> <span class="o">=</span> <span class="s1">&#39;&quot;At least I</span><span class="se">\&#39;</span><span class="s1">ll try.&quot;&#39;</span> 
<span class="linenos">2</span><span class="n">dialog_and_other_stuff</span> <span class="o">=</span> <span class="n">dialog</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="linenos">3</span><span class="n">list_of_dialog_and_other_stuff</span> <span class="o">=</span> <span class="n">dialog_and_other_stuff</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<span class="linenos">4</span><span class="n">short_dialog</span> <span class="o">=</span> <span class="n">list_of_dialog_and_other_stuff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">5</span><span class="n">short_dialog</span>
</pre></div>
</div>
<p>Function composition removes the need to give names to the intermediate results, and without names, our attention is not drawn to this work, which is necessary for the computation but not really important to the big picture. This point is important. For human readers, your script should be like a good story: It highlights the main action while hiding the details of exactly how the characters interact and get from place to place. But unlike a literary story, your script does contain these details, through the mechanism of function composition. The Python interpreter needs to know these details, since it does only what it is exactly told to do. Function composition keeps humans from being distracted by the details the interpreter needs to know.</p>
</section>
<section id="abstraction-as-information-hiding">
<p><strong>Abstraction as information hiding.</strong> Another example of where we hid details to help with human understanding, recall how we replaced a for-loop and its associated code with an invocation of the <code class="docutils literal notranslate"><span class="pre">find</span></code> method on a string. Both computed a similar result, but we preferred the <code class="docutils literal notranslate"><span class="pre">find</span></code> string method over the for-loop implementation because it was both more concise and more expressive of what this step in our script was doing. In the next chapter, we will see how we can create our own compact representations—abstract away the details—so that each line of our script more closely resembles each step in the pseudocode we are trying to implement.</p>
</section>
<section id="there-is-no-character">
<p><strong>There is no character.</strong> Before we go, I want to correct something you may have come to believe. While I have used the term “character” to describe single items in the sequence known as a Python string, there is no distinguished thing that is a character in Python. What we think of as a character is just a Python string of length 1. In other words, when I earlier wrote that <code class="docutils literal notranslate"><span class="pre">the_line[0]</span></code> returns <code class="docutils literal notranslate"><span class="pre">'A'</span></code>, I was careful to write the result as a Python string. Go ahead and see what <code class="docutils literal notranslate"><span class="pre">type(the_line[0])</span></code> tells you about the type of the object returned from the string index method. We will talk more about types when we reach Act II.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>### Run the highlighted statements in the interactive interpreter
<span class="hll">&gt;&gt;&gt; the_line = &#39;And said, &quot;At least I\&#39;ll try.&quot;&#39; 
</span><span class="hll">&gt;&gt;&gt; type(the_line[0])
</span>&lt;class &#39;str&#39;&gt;
</pre></div>
</div>
<p>[Version 20240719]</p>
<hr class="footnotes docutils" />
<aside class="footnote brackets" id="fn1" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>There’s one other actor in the story—the narrator’s sister, Sally—but she never speaks.</p>
</aside>
<aside class="footnote brackets" id="fn2" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>It’s quite hard to solve the second two pieces of our problem, and we won’t attempt them in this chapter.</p>
</aside>
<aside class="footnote brackets" id="fn3" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>This version pulls its input text file from the `txts` directory; you’ll learn how to read and specify file paths in Chapter 13. The script also uses Python’s with-as-statement to robustly open and close files. Please see ALE 1.3 on the companion website for a detailed description of this statement’s syntax and function.</p>
</aside>
<aside class="footnote brackets" id="fn4" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p>For those who love formal definitions, both deterministic and nondeterministic FSMs are mathematical models of computation. They are defined by the quintuple: an alphabet of events; the set of all states; the initial state; a transition function, and a set of (possibly empty) final sets. The initial state and final states are included in (i.e., are a subset of) the set of all states.</p>
</aside>
<aside class="footnote brackets" id="fn5" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">5</a><span class="fn-bracket">]</span></span>
<p>As our scripts grow, I won’t always include all of the current one in the displayed code block. A clue to this happening is that a code block’s line numbering won’t start at 1. When this happens, you can find the full context in the filename mentioned in the opening a triple-hash comment.</p>
</aside>
<aside class="footnote brackets" id="fn6" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">6</a><span class="fn-bracket">]</span></span>
<p>The variable that records which state the FSM is working in.</p>
</aside>
<aside class="footnote brackets" id="fn7" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">7</a><span class="fn-bracket">]</span></span>
<p>Here is <a class="reference external" href="https://www.wired.com/story/why-you-hate-media-technically-speaking/">a fun article</a> on the difference between dialogue and dialog. I use the first when I’m talking about what we want to capture and the second as the variable by which we capture the first.</p>
</aside>
<aside class="footnote brackets" id="fn8" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">8</a><span class="fn-bracket">]</span></span>
<p>You might know, for example, that the error condition is impossible because of some processing you did immediately prior.</p>
</aside>
<aside class="footnote brackets" id="fn9" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">9</a><span class="fn-bracket">]</span></span>
<p>The string literal in this example illustrates how you can escape a quote character. In this way, the apostrophe in the contraction is not recognized by the Python interpreter as the literal’s closing single quote.</p>
</aside>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="chap01.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapter 1: Read a Children’s Book</p>
      </div>
    </a>
    <a class="right-next"
       href="chap03.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 3: Replace Text With Emoji</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-the-current-task">What is the current task?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-new-problem">A new problem</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#splitting-the-problem-into-small-pieces">Splitting the problem into small pieces</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reuse">Reuse</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#switching-between-goals">Switching between goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-state-machines">Finite State Machines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#error-handling-in-fsms">Error handling in FSMs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#encoding-the-state-information">Encoding the state information</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#this-or-that">This or that</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#work-on-a-state">Work on a state</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#strings-as-a-sequence-of-characters">Strings as a sequence of characters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#membership-test">Membership test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coding-a-transition">Coding a transition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#indexing-and-slicing">Indexing and slicing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#for-loops">For-loops</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#string-find">String find</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#design-patterns-for-error-handling">Design patterns for error handling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#never-go-too-long-without-testing">Never go too long without testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concatenation-overloading-and-shorthands">Concatenation, overloading, and shorthands</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#off-by-one-and-other-potential-errors">Off-by-one and other potential errors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beware-of-hidden-assumptions">Beware of hidden assumptions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#function-composition">Function composition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstraction-as-information-hiding">Abstraction as information hiding</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#there-is-no-character">There is no character</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mike Smith
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023 by Michael D. Smith. All rights reserved.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>